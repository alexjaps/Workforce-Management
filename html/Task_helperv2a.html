<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<title>Project Management - Workspace</title>
	<!-- https://www.sitepoint.com/7-reasons-to-use-a-cdn/  These are the reasons yo keep some links with CDN sources -->

	<!-- SANDBOX_MARK_PRODUCTION -->

	<script>
		const WF_MODE_TESTING = false;
		const WF_MODE_NORMAL = true;

		var WF_DEBUG = true;
		var WF_DEBUG_AJAX = false;
		var WF_LOADER_LEVEL = 0;
		var WF_LOADER_AUTO = false;
		var WORKFORCE_MODE = WF_MODE_NORMAL; // Set to WF_MODE_NORMAL then save the changes..
		var WorkForce_Obj = {};
		var userIP;
		var delimiterdates = '\t';
		var arrayFilters = [];
		
		const ViewStyle = 'OLD1';

		// Write HTML_element based on environment...
		function WF_wh(sbx_elem, prd_elem) {
			if (WorkForce_Obj.Env == 'SANDBOX')
				document.write(sbx_elem);
			else
				document.write(prd_elem);
		}

		// Get HTML_element based on environment...
		function WF_whs(sbx_elem, prd_elem) {
			if (WorkForce_Obj.Env == 'SANDBOX')
				return sbx_elem;
			else
				return prd_elem;
		}

		//Dictation...
		function startDictation(tableType) {
			$('.talknow').fadeIn();
			if (window.hasOwnProperty('webkitSpeechRecognition')) {
				$('input[type="search"]').val('');
				var recognition = new webkitSpeechRecognition();
				recognition.continuous = false;
				recognition.interimResults = false;
				if ($('#custpage_whatlang').val() == 'en') {
					recognition.lang = "en-US";
				} else {
					recognition.lang = "es-ES";
				}
				recognition.start();
				recognition.onresult = function(e) {
					if (tableType == 'salesorder') {
						$('.tabsalesorder-content input:eq(0)').val(e.results[0][0].transcript);
					}
					if (tableType == 'mytblTasks') {
						$('#mytblTasks_wrapper input').val(e.results[0][0].transcript);
					}
					if (tableType == 'Customsalesorder') {
						$('#Customsalesorder_wrapper input').val(e.results[0][0].transcript);
					}
					$('.talknow').fadeOut();
					recognition.stop();
					//document.getElementById('labnol').submit();
					$('input[type="search"]').trigger('keyup');
				};
				recognition.onerror = function(e) {
					recognition.stop();
				}
			}
		}
	</script>
</head>

<body>
<script>
(function() {
	    var stats = new MemoryStats();

	    var elem = stats.domElement;
	    elem.style.position = 'fixed';
	    elem.style.right    = '0px';
	    elem.style.bottom   = '0px';
	    elem.style.zIndex   = 100000;

	    requestAnimationFrame(function rAFloop(){
	      stats.update();
	      requestAnimationFrame(rAFloop);
	    });
	})();
</script>
	<div class="image-container1" style="display:none" onclick="clickimageContainer.call(this)">
		<div class="image-container2"> </div>
	</div>
	<div class="loader">...loader...</div>
	<div class="talknow" style="display: none"></div>
	<span id="msgSalesOrdersClick"></span>
	<span id="msgSalesOrdersClick2" style="display: none">Scroll down...</span>
	
<script>
if (ViewStyle != 'OLD') {
document.write('<style\>\
	.maincontainer { width:100%; }\
	.maincontainer ul {  margin-left: 0px; /*background: #EFEFEF; padding:2px;*/}\
	.maincontainer ul li {  background: #EEE; }\
	.maincontainer label { font-weight: 400; }\
	.wftabhead { width:100%; }\
	.filterbar { width:100%; background:#DDD; margin-top:3px; padding:12px; min-height:64px; }\
	.filtersDividers { display: inline-block; padding: 0 8px; }\
	.filterButton {\
			position: relative;\
			padding: 4px 18px;\
			margin-left: 9px;\
			border-radius: 8px;\
			font-family: \'Helvetica\', cursive;\
			font-size: 14px;\
			color: #FFF;\
			text-decoration: none;\
			background-color: #3498DB;\
			border-bottom: 4px solid #cccccc;\
			text-shadow: 0px -2px #2980B9;\
			/* Animation */\
			transition: all 0.1s;\
			-webkit-transition: all 0.1s;\
			cursor: pointer;\
			width: 80px;\
			text-align: center;\
		}\
	.filterButton:hover,\
	.filterButton:focus {\
		text-decoration: none;\
		border-bottom: 4px solid #333;\
	}\
	.basicFilters {display: inline-block;}\
	.loader {\
		position: fixed;\
		left: 40%;\
		bottom: 25px;\
		width: 400px;\
		height: 100px;\
		z-index: 9999;\
		/*background: url(\'/core/media/media.nl?id=6519192&c=3461650&h=f2681d85a34d7de8bdb8\') 50% 50% no-repeat rgba(249, 249, 249, 0);*/\
		background: url(\'/core/media/media.nl?id=6564234&c=3461650&h=4e4ecafd97e44b0c4d00\') 50% 50% no-repeat rgba(249, 249, 249, 0);\
		background-size: contain;\
	}\
</style>');

document.write('<div class="maincontainer" style="background:#FFF;">\
	\
	<p id="msgAdminSalesOrdersTab" class="text-success pull-right"></p>\
	<div id="wftabhead" class="wftabhead">	\
		<ul class="nav nav-tabs">\
			<li><a href="#tab1" data-toggle="tab">My Work</a></li>\
			<li><a href="#tab2" data-toggle="tab">My Sales Orders</a></li>\
			<li class="active"><a href="#tab3" data-toggle="tab">Workspace</a></li>\
			<li><a href="#tab4" data-toggle="tab">Sales Orders</a></li>\
		</ul>\
		\
		<div class="tab-content" style="background:#FDFDFD; border:1px solid #999; padding:6px;">\
			<div class="tab-pane" id="tab1">\
				<!-- mywork> -->\
				<div class="filterbar"> <!-- filtersBar START -->\
					<div id="filtersGroupOS1" class="cols-sm-12">\
						<div class="col-sm-9">\
							<label>Filter by Task Status:</label>\
							<select id="multipleSelectStatus" title="Click to select status of task\'s " data-placeholder="Select Status" class="selectpicker" multiple>\
								<option value="1" selected>Active</option>\
								<option value="2" >Complete</option>\
								<option value="3" >Defered</option>\
								<option value="4">Cancelled</option>\
								<option value="1001" >Acknowledge</option>\
								<option value="1002" >Without Acknowledge</option>\
							</select>\
						</div>\
						<div class="filtersDividers">\
							<script\> \
								WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
									"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
							<\/script> \
						</div>\
						<div class="basicFilters">\
							<div id="filterTaskStatus" class="filterButton">Filter</div>\
						</div>\
						<div class="filtersDividers">\
							<script\> \
								WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
									"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
							<\/script>\
						</div>\
					</div>\
				</div> <!-- filtersBar END -->\
				\
				<div align="right"><h6 id="AllRegistersMyWorkH1">...</h6></div>\
				<table id="AllMyWork" class="display">\
					<thead>\
						<tr>\
							<th width="15%">Customer</th>\
							<th width="10%">Sales Order</th>\
							<th width="20%">Task</th>\
							<th width="10%">Assigned</th>\
							<th width="5%"> ACK</th>\
							<th width="10%">Status</th>\
							<th width="10%">Start Date</th>\
							<th width="10%">Due Date</th>\
							<th width="5%">Work on Weekends</th>\
							<th width="5%">Duration</th>\
						</tr>\
					</thead>\
					<tbody></tbody>\
					<tfoot></tfoot>\
				</table>\
				<div align="right" style="margin-top:12px;"><h6 id="AllRegistersMyWorkH2">...</h6></div>\
				<button id="ButtonLoadMoreAllWork" title="Loads 50 more records dynamically..." type="button" class="btn btn-info btn-transparent" data-slice="50">Load More...</button>\
				<!-- <button id="ButtonLoadAllMyWork" title="Load all records from my work" type="button" class="btn btn-info btn-transparent"> Load All </button> -->\
				<!-- mywork< -->  \
			</div>\
			\
			\
			<div class="tab-pane" id="tab2">\
				<!-- mySalesOrders START -->\
			    <div class="filterbar"> <!-- filtersBar START -->\
					<div id="filtersGroupOS2" class="cols-sm-12">\
						<div class="col-sm-9">\
							<label>Filter by SO Status: </label>\
							<select id="multipleSelectSalesOrders" title="Click here to select any of the provided options" data-placeholder="Select Type of Sales Order" class="selectpicker" multiple>\
								<option value="SalesOrd:A">Pending Approval</option>\
								<option value="SalesOrd:B" selected>Pending Fulfillment</option>\
								<option value="SalesOrd:C">Cancelled</option>\
								<option value="SalesOrd:D" selected>Partially Fulfilled</option>\
								<option value="SalesOrd:E" selected>Pending Billing/Partially Fulfilled</option>\
								<option value="SalesOrd:F">Pending Billing</option>\
								<option value="SalesOrd:G">Billed</option>\
								<option value="SalesOrd:H">Closed</option>\
							</select>\
						</div>\
						<div class="filtersDividers">\
							<script\>\
								WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
									"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
							<\/script>\
						</div>\
						<div class="basicFilters">\
							<div id="filterButtonSO" class="filterButton">Filter</div>\
						</div>\
						<div class="filtersDividers">\
							<script\>\
								WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
									"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
							<\/script>\
						</div>\
					</div>\
				</div> <!-- filtersBar END -->\
				\
				<div id="show_salesorder_table">\
						<table id="salesorder" class="display">\
							<thead>\
								<tr>\
									<th width="9%">Sales Order</th>\
									<th width="9%">Customer</th>\
									<th width="9%">Status</th>\
									<th width="13%">Description</th>\
									<th width="5%">Items</th>\
									<th width="5%">Locations</th>\
									<th width="5%">Days Since Approved</th>\
									<th width="5%">Project Manager</th>\
									<th width="5%">Sales Rep</th>\
									<th width="5%">Provisioning Engineer</th>\
									<th width="5%">MRR</th>\
									<th width="5%">NRR</th>\
									<th width="8%">Estimated Delivery Date</th>\
									<th width="7%">Pending MRR</th>\
									<th width="7%">Pending NRR</th>\
									<th width="1%"  style="display: none">Address Cities</th>\
								</tr>\
							</thead>\
							<tfoot>\
								<tr>\
									<th></th>\
									<th></th>\
									<th></th>\
									<th></th>\
									<th></th>\
									<th></th>\
									<th></th>\
									<th></th>\
									<th></th>\
									<th></th>\
									<th></th>\
									<th></th>\
									<th></th>\
									<th></th>\
									<th></th>\
									<th style="display: none;" ></th>\
								</tr>\
							</tfoot>\
							<tbody></tbody>\
						</table>\
\
						<button id="ButtonLoadMore_salesorder" type="button" class="btn btn-info btn-transparent" data-slice="-1">Load More...</button>\
					</div>\
				\
				<!-- mySalesOrders END -->	\
			</div>\
			\
		    <div class="tab-pane active" id="tab3">\
	    		<div id="filtersFirstBar" class="filterbar">\
					<div id="filtersMyTeam" class="cols-sm-12">\
						<div class="col-sm-9">\
							<label class="ToMyTeam">Staff: </label>\
						</div>\
					</div>\
				</div>\
				<div>\
					<table id="Customsalesorder" class="display">\
						<thead>\
							<tr>\
								<th width="16%" title="Sales Order">Sales Order</th>\
								<th width="10%">Customer</th>\
								<th width="10%">Status</th>\
								<th width="10%">Description</th>\
								<th width="10%">Items</th>\
								<th width="5%">Locations</th>\
								<th width="10%">Days Since Approved</th>\
								<th width="5%">Project Manager</th>\
								<th width="10%">Sales Rep</th>\
								<th width="5%">Provisioning Engineer</th>\
								<th width="5%"> MRR </th>\
								<th width="5%"> NRR </th>\
								<th width="8%">Estimated Delivery Date</th>\
								<th width="8%">Pending MRR</th>\
								<th width="8%">Pending NRR</th>\
								<th width="1%" style="display: none">Address Cities</th>\
							</tr>\
						</thead>\
						<tfoot>\
							<tr>\
								<th></th>\
								<th></th>\
								<th></th>\
								<th></th>\
								<th></th>\
								<th></th>\
								<th></th>\
								<th></th>\
								<th></th>\
								<th></th>\
								<th></th>\
								<th></th>\
								<th></th>\
								<th></th>\
								<th></th>\
								<th style="display: none"></th>\
							</tr>\
						</tfoot>\
						<tbody></tbody>\
					</table>\
\
					<button id="ButtonLoadMore_Customsalesorder" type="button" class="btn btn-info btn-transparent" data-slice="-1">Load More...</button>\
				</div>\
			</div>\
			\
			\
			\
			<div class="tab-pane" id="tab4">\
				<div class="filterbar"> <!-- filtersBar START -->\
				<p id="m1sgAdminSalesOrdersTab"></p>\
				<div id="filtersGroupOS3" class="cols-sm-12">\
					<div class="col-sm-9">\
						<label>Filter by SO Status: </label>\
						<select id="multipleSelectSalesOrders2" title="Click here to select any of the provided options" data-placeholder="Select Type of Sales Order" class="selectpicker" multiple>\
							<option value="SalesOrd:A">	Pending Approval</option>\
							<option value="SalesOrd:B" selected> Pending Fulfillment</option>\
							<option value="SalesOrd:C">	Cancelled</option>\
							<option value="SalesOrd:D" selected> Partially Fulfilled</option>\
							<option value="SalesOrd:E" selected> Pending Billing/Partially Fulfilled</option>\
							<option value="SalesOrd:F">	Pending Billing</option>\
							<option value="SalesOrd:G">	Billed</option>\
							<option value="SalesOrd:H">	Closed</option>\
						</select>\
					</div>\
					<div class="filtersDividers">\
						<script>\
							WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
								"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
						<\/script>\
					</div>\
					<div class="basicFilters" style="display: inline-block;">\
						<div id="filterButtonALLSO2" class="filterButton">Filter</div>\
					</div>\
					<div class="filtersDividers">\
						<script>\
							WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
								"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
						<\/script>\
					</div>\
				</div>\
			</div>\
			<!-- End of filtersBar -->\
	\
			<div align="right"><h6 id="AllRegistersSalesH1">...</h6></div>\
			<table id="allsalesorder" class="table table-hover">\
				<!--  This class was removed from here table-bordered -->\
				<thead>\
					<tr>\
						<th width="16%" title="Sales Order">Sales Order</th>\
						<th width="10%">Customer</th>\
						<th width="10%">Status</th>\
						<th width="10%">Description</th>\
						<th width="10%">Items</th>\
						<th width="5%">Locations</th>\
						<th width="10%">Days Since Approved</th>\
						<th width="5%">Project Manager</th>\
						<th width="10%">Sales Rep</th>\
						<th width="5%">Provisioning Engineer</th>\
						<th width="5%"> MRR </th>\
						<th width="5%"> NRR </th>\
						<th width="8%">Estimated Delivery Date</th>\
						<th width="8%">Pending MRR</th>\
						<th width="8%">Pending NRR</th>\
						<th width="1%" style="display: none">Address Cities</th>\
					</tr>\
				</thead>\
				<tfoot>\
					<tr>\
						<th ></th>\
						<th ></th>\
						<th ></th>\
						<th ></th>\
						<th ></th>\
						<th ></th>\
						<th ></th>\
						<th ></th>\
						<th ></th>\
						<th ></th>\
						<th ></th>\
						<th ></th>\
						<th ></th>\
						<th ></th>\
						<th ></th>\
						<th style="display: none" ></th>\
					</tr>\
				</tfoot>\
				<tbody> </tbody>\
			</table>\
			<div align="right">\
				<h6 id="AllRegistersSalesH2">...</h6></div>\
			<br/>\
			<br/>\
			<button id="ButtonLoadMore_allsalesorder" type="button" class="btn btn-info btn-transparent" data-slice="-1">Load More...</button>\
			<!-- <button id="ButtonLoadAllMyWork" title="Load all records from my work" type="button" class="btn btn-info btn-transparent"> Load All </button> -->\
		</div>\
	\
	</div>\
			</div>\
			\
		</div>\
	</div>\
</div>');

document.write(' \
	<style>\
	#NameSalesorderBySpan {\
		font-size: 140%;\
		color: #004C66;\
		text-align: left;\
		font-weight: bold;\
		padding: 18px 17px;\
	}\
	</style>\
	<div style="height:18px; width:100%">&nbsp;</div>\
	 <div class="maincontainer">\
		<div id="salesorderdetail" style="display:none; background:#FFF; border:1px solid blue;">\
			<!--Table content to generated starts here  -->\
			<!-- Tables for Services and Service Addresses -->\
			<p class="nivela">&nbsp;</p>\
			<span id="IdSalesorderBySpan" style="display:block"></span>\
			<div id="NameSalesorderBySpan"></div>\
			<!-- We add Tabs here-->\
			<div id="tabs_salesorderdetail" class="wftabhead">\
				<ul class="nav nav-tabs">\
					<li class="active"><a href="#tabtogant1">Table View</a></li>\
					<li><a href="#tabtogant2" class="dtab2">Task Tree View</a></li>\
					<!-- <li><a href="#tabtogant3" class="dtab3">Gantt View</a></li> -->\
					<li><a id="tabtogant3" href="" target="_blank" class="dtab3">Gantt View</a></li>\
				</ul>\
				<!-- Tabs Content -->\
				<div class="tab-content">\
					<div id="tabtogant1" class="tab-pane active">\
						<div class="filterbar">\
							<div id="filtersGroupTbl" class="cols-sm-12">\
								<div class="col-sm-9">\
									<div class="div-selectassigned basicFilters" style="display: none;"></div>\
									<div class="div-selectdepartment basicFilters" style="display: none;"></div>\
									<div class="div-selecttaskstatus basicFilters" style="display: none;"></div>\
									<div class="div-selectStartDate basicFilters" style="display: none;">Start Date\
										<input type="text" onchange="" id="filterStartDate" class="toDatePickerFilter"> </div>\
									<div class="div-selectDueDate basicFilters" style="display: none;">Due Date\
										<input type="text" onchange="" id="filterDueDate" class="toDatePickerFilter"> </div>\
									<div class="div-selectWoW basicFilters" title="Work on Weekend" style="display: none;">Work on Weekends\
										<input type="checkbox" onchange="" id="filterWoW" name="filterWoW" class="filterWoW"> </div>\
									<div class="div-selectDuration basicFilters" style="display: none;">Duration from\
										<input type="text" size="6" onchange="" id="filterDurationStart" name="filterDurationStart" class="filterDurationStart" value=""> to\
										<input type="text" size="6" onchange="" id="filterDurationEnd" name="filterDurationEnd" class="filterDurationEnd" value="">\
									</div>\
									<div class="div-labelServices basicFilters" style="display: inline-block;">\
										<select id="selServices" class="div-selServices basicFilters" style="height:32px; display: inline-block;"> </select>\
										<select id="selAdresses" class="div-selAdresses basicFilters" style="height:32px; display: inline-block;"></select>\
									</div>\
								</div>\
								<div class="filtersDividers">\
									<script>\
										WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
											"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
									<\/script>\
								</div>\
								<div class="div-selectDuration basicFilters" style="display: inline-block;">\
									<div onclick="Reset.call(this)" id="filterReset" class="filterButton">Reset</div>\
								</div>\
								<div class="div-selectDuration basicFilters" style="display: inline-block;">\
									<div id="filterButtonG" class="filterButton">Filter</div>\
								</div>\
								<div class="filtersDividers">\
									<script>\
										WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
											"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
									<\/script>\
								</div>\
							</div>\
							<div class="col-sm-12" style="margin:6px;">&nbsp;</div>\
						</div>\
\
						<table id="myUpdatedSA" class="display">\
							<thead>\
								<tr>\
									<th align="center" width="10%" class="rounded-th-left">Service(s)</th>\
									<th align="center" width="1%">Capacity</th>\
									<th align="center" width="5%">UoM</th>\
									<th align="center" width="19%">Location A</th>\
									<th align="center" width="15%">Address A</th>\
									<th align="center" width="19%">Location Z</th>\
									<th align="center" width="15%">Address Z</th>\
									<th align="center" width="10%">Delivery Date *</th>\
									<th align="center" width="15%" class="rounded-th-right">Subscription</th>\
								</tr>\
							</thead>\
							<tbody></tbody>\
						</table>\
						<p class="nivela1">&nbsp;</p>\
						<table id="myUpdatedServicesAddresses" class="display">\
							<thead>\
								<tr>\
									<th align="center" width="10%" class="rounded-th-left">Address Name</th>\
									<th align="center" width="33%">Address</th>\
									<th align="center" width="14%">City</th>\
									<th align="center" width="14%">Type</th>\
									<th align="center" width="14%">Status</th>\
									<th class="rounded-th-right" width="14%">Last Mile Type</th>\
								</tr>\
							</thead>\
							<tbody></tbody>\
						</table>\
						<p class="nivela2">&nbsp;</p>\
						<!-- Add Filters Bar -->\
\
						<!-- 222222222 -->\
						<div align="right"><h6 id="RegistersfromTaskTable1">...</h6></div>\
						<!-- End of filtersBar -->\
						<!-- In this table we draw the tasks of the user/all tasks -->\
						<table id="mytblTasks" class="display">\
							<thead>\
								<tr>\
									<th width="20%" align="center" valign="middle"><strong>Task</strong></th>\
									<th width="10%" align="center" valign="middle"><strong>Assigned</strong></th>\
									<th width="8%" align="center" valign="middle" class="centerth"><strong> ACK</strong></th>\
									<th width="8%" align="center" valign="middle" class="centerth"><strong>Status</strong></th>\
									<th width="10%" align="center" valign="middle" class="centerth"><strong>Start\
										Date</strong></th>\
									<th width="10%" align="center" valign="middle" class="centerth"><strong>Due\
										Date</strong></th>\
									<th width="7%" align="center" valign="middle" class="centerth"><strong>Work on Weekends</strong></th>\
									<th width="5%" align="center" valign="middle" class="centerth"><strong>Duration</strong></th>\
									<!-- <th width="2%" align="center" valign="middle" class="centerth"><strong>Save</strong></th> -->\
								</tr>\
							</thead>\
							<tbody></tbody>\
						</table>\
						<div align="right">\
							<h6 id="RegistersfromTaskTable2">...</h6></div>\
						<button id="ButtonLoadMoreTasks" title="Loads 50 more registers..." type="button" class="btn btn-info btn-transparent" data-slice="-1" data-function="1">Load More...</button>\
\
					</div>\
					<!-- End of Tab 1 tabtogant1 ACTIVE -->\
\
					<div id="tabtogant2" class="tab-pane">\
						<div class="tab2Container">\
							<div class="tskStatusColorContainer">\
								<div class="tskStatusColor tskGreen">&nbsp;</div><span class="spTskStatus">Completed</span>\
								<div class="tskStatusColor tskGray">&nbsp;</div><span class="spTskStatus">Cancelled</span>\
								<div class="tskStatusColor tskBlue">&nbsp;</div><span class="spTskStatus">Normal</span>\
								<div class="tskStatusColor tskRed">&nbsp;</div><span class="spTskStatus">Outdate</span>\
								<div class="tskStatusColor tskCream">&nbsp;</div><span class="spTskStatus">Duration</span>\
								<div class="tskStatusColor tskDarkGray">&nbsp;</div><span class="spTskStatus">Range</span>\
							</div>\
							<br/><br/>\
							<div id="treeTasks" style="width:50%;min-height: 530px;display:inline-block; border: 1px solid #999;"></div>\
							<div id="Task" class="right">\
								<div id="goToTranstelco" class="preimageTasks">\
									<script>\
										WF_wh("<img src=\'/core/media/media.nl?id=6522405&c=3461650&h=c18776f0221b9a84e485\' title=\'logo Transtelco\' />",\
											"<img src=\'/core/media/media.nl?id=8153909&c=3461650&h=b6b56279e0c20b8efaba\' title=\'logo Transtelco\' />");\
									<\/script>\
								</div>\
								<div class="todoScroll">\
									<table id="tableTask" class="tbl-task-details" style="width:100%; border:none; display: none">\
										<thead>\
											<tr>\
												<th colspan="2" align="center" valign="left"><strong>Title</strong></th>\
											</tr>\
										</thead>\
										<tbody></tbody>\
									</table>\
								</div>\
							</div>\
						</div>\
					</div>\
				</div>\
			</div>\
			<!--End of Tabs here-->\
			<div>\
			\
				<!-- Large modal -->\
				<div style="display: none">\
					<button id="play" type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg">Large modal</button>\
				</div>\
				<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">\
					<div class="modal-dialog modal-lg" role="document">\
						<div class="modal-content">\
							<!--End of Tabs here-->\
							<p class="nivela">&nbsp;</p>\
							<table id="myUpdatedTasks" class="" class1="myUpdatedTasks" style="width:100%; borders=none;">\
								<thead>\
									<tr>\
										<th width="20%" align="center" valign="middle"><strong>Title</strong></th>\
										<th width="5%" align="center" valign="middle"><strong>Assigned</strong></th>\
										<th width="5%" align="center" valign="middle"><strong>Ack</strong></th>\
										<th width="10%" align="center" valign="middle"><strong>Status</strong></th>\
										<th width="10%" align="center" valign="middle" class="centerth"><strong>OLD Start Date</strong></th>\
										<th width="15%" align="center" valign="middle" class="centerth"><strong>OLD Due	Date</strong></th>\
										<th width="10%" align="center" valign="middle" class="centerth"><strong>Start Date</strong></th>\
										<th width="10%" align="center" valign="middle" class="centerth"><strong>Due Date</strong></th>\
										<th width="10%" align="center" valign="middle" class="centerth"><strong>Work on Weekends</strong></th>\
										<th width="5%" align="center" valign="middle" class="centerth"><strong>Duration</strong></th>\
									</tr>\
								</thead>\
								<tbody> </tbody>\
							</table>\
							<br/>\
							<br/>\
							<button id="closeTskBtn" type="button" class="btn btn-default" data-dismiss="modal">Close</button>\
						</div>\
					</div>\
				</div>\
			</div>\
		</div>\
	</div>\
	<br/>\
');
}
</script>


<script>
if (ViewStyle == 'OLD') {
document.write('<link href="/core/media/media.nl?id=6566302&c=3461650&h=d53c0719bbe01a649ab8&_xt=.css" type="text/css" media="screen" rel="stylesheet">');
document.write('<!-- ORIGINAL CODE -->\
\
	<div class="t1blsalesorders" style="display:block">\
		<div class="thetabsalesorders" style="display: block; background-color:#FFF; width:100%;">\
\
			<!-- Tabs Headers -->\
			<ul class="tabtogsales-links">\
				<li id="tabone" class="tabso1"> <a href="#tabsalesord1"> My Work</a></li>\
				<li id="tabtwo" class="tabso2"> <a href="#tabsalesord2" id="tabtwo2"> My Sales Orders</a></li>\
				<!-- 	<li id="tabthree" class="tabso3" style="display: none"><a href="#tabsalesord3">	My Team</a></li> -->\
				<li id="tabfour" class="tabso4 active"><a href="#tabsalesord4"> Workspace</a></li>\
				<li id="tabfive" class="tabso5" style="display: none"><a href="#tabsalesord5">Sales Orders</a></li>\
			</ul>\
\
			<!-- Tabs Content -->\
			<div class="tabsalesorder-content">\
\
\
				<div id="tabsalesord1" class="tabsalesord">\
					<div class="filtersBar4OrderSales">\
						<div id="filtersGroupOS1a" class="cols-sm-12" style="padding:20px 0;">\
							<div class="col-sm-9">\
								<label>Filter by Task Status:</label>\
								<select id="multipleSelectStatus" title="Click here to select any of the provided options" data-placeholder="Select Status" class="selectpicker" multiple>\
									<option value="1" selected>Active</option>\
									<option value="2" >Complete</option>\
									<option value="3" >Defered</option>\
									<option value="4">Cancelled</option>\
									<option value="1001" >Acknowledge</option>\
									<option value="1002" >Without Acknowledge</option>\
								</select>\
							</div>\
\
							<div class="filtersDividers">\
								<script>\
									WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
										"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
								<\/script>\
							</div>\
\
							<div class="basicFilters" style="display: inline-block;">\
								<div id="filterTaskStatus" class="filterButtonSO">Filter</div>\
							</div>\
\
							<div class="filtersDividers">\
								<script>\
									WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
										"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
								<\/script>\
							</div>\
\
						</div>\
\
					</div>\
					<!-- End of filtersBar -->\
\
\
\
\
					<div align="right">\
						<h6 id="AllRegistersMyWorkH1">...</h6></div>\
					<table id="AllMyWork" class="" cellspacing="0" style="width:100%;">\
						<thead>\
							<tr>\
								<th width="15%" align="center" valign="middle"><strong>Customer</strong></th>\
								<th width="10%" align="center" valign="middle"><strong>Sales Order</strong></th>\
								<th width="20%" align="center" valign="middle"><strong>Task</strong></th>\
								<th width="10%" align="center" valign="middle"><strong>Assigned</strong></th>\
								<th width="5%" align="center" valign="middle" class="centerth"><strong> ACK</strong></th>\
								<th width="10%" align="center" valign="middle" class="centerth"><strong>Status</strong></th>\
								<th width="10%" align="center" valign="middle" class="centerth"><strong>Start Date</strong></th>\
								<th width="10%" align="center" valign="middle" class="centerth"><strong>Due Date</strong></th>\
								<th width="5%" align="center" valign="middle" class="centerth"><strong>Work on Weekends</strong></th>\
								<th width="5%" align="center" valign="middle" class="centerth"><strong>Duration</strong></th>\
								<!-- <th width="0%" align="center" valign="middle" class="centerth"><strong>Save</strong></th> -->\
							</tr>\
						</thead>\
						<tbody></tbody>\
						<tfoot></tfoot>\
					</table>\
					<div align="right" style="margin-top:12px;">\
						<h6 id="AllRegistersMyWorkH2">...</h6></div>\
					<button id="ButtonLoadMoreAllWork" title="Loads 50 more records dynamically..." type="button" class="btn btn-info btn-transparent" data-slice="50">Load More...</button>\
					<!-- <button id="ButtonLoadAllMyWork" title="Load all records from my work" type="button" class="btn btn-info btn-transparent"> Load All </button> -->\
				</div>\
				<!-- End of Tab My Work -->\
\
\
\
\
				<!-- Tab for My Sales Orders -->\
				<div id="tabsalesord2" class="tabsalesord">\
					<div class="filtersBar4OrderSales">\
						<div id="filtersGroupOS2" class="cols-sm-12" style="padding:20px 0;">\
							<div class="col-sm-9">\
								<label>Filter by SO Status: </label>\
								<select id="multipleSelectSalesOrders" title="Click here to select any of the provided options" data-placeholder="Select Type of Sales Order" class="selectpicker" multiple>\
									<option value="SalesOrd:A">Pending Approval</option>\
									<option value="SalesOrd:B" selected>Pending Fulfillment</option>\
									<option value="SalesOrd:C">Cancelled</option>\
									<option value="SalesOrd:D" selected>Partially Fulfilled</option>\
									<option value="SalesOrd:E" selected>Pending Billing/Partially Fulfilled</option>\
									<option value="SalesOrd:F">Pending Billing</option>\
									<option value="SalesOrd:G">Billed</option>\
									<option value="SalesOrd:H">Closed</option>\
								</select>\
							</div>\
\
							<div class="filtersDividers">\
								<script>\
									WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
										"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
								<\/script>\
							</div>\
\
							<div class="basicFilters" style="display: inline-block;">\
								<div id="filterButtonSO" class="filterButtonSO">Filter</div>\
							</div>\
\
							<div class="filtersDividers">\
								<script>\
									WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
										"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
								<\/script>\
							</div>\
\
						</div>\
\
					</div>\
					<!-- End of filtersBar -->\
					\
					<div id="show_salesorder_table">\
						<table id="salesorder" class="table table-hover">\
							<thead>\
								<tr>\
									<th width="9%" title="Sales Order">Sales Order</th>\
									<th width="9%" >Customer</th>\
									<th width="9%" >Status</th>\
									<th width="13%" >Description</th>\
									<th width="5%" >Items</th>\
									<th width="5%" >Locations</th>\
									<th width="5%" >Days Since Approved</th>\
									<th width="5%" >Project Manager</th>\
									<th width="5%" >Sales Rep</th>\
									<th width="5%" >Provisioning Engineer</th>\
									<th width="5%" >MRR</th>\
									<th width="5%" >NRR</th>\
									<th width="8%" >Estimated Delivery Date</th>\
									<th width="7%" >Pending MRR</th>\
									<th width="7%" >Pending NRR</th>\
									<th width="1%"  style="display: none">Address Cities</th>\
								</tr>\
							</thead>\
							<tfoot>\
								<tr>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th style="display: none;" ></th>\
								</tr>\
							</tfoot>\
							<tbody></tbody>\
						</table>\
\
						<button id="ButtonLoadMore_salesorder" type="button" class="btn btn-info btn-transparent" data-slice="-1">Load More...</button>\
					</div>\
				</div>\
				<!-- End of Tab 1 tabsalesord1 ACTIVE -->\
				\
				\
				\
				\
				\
				<div id="tabsalesord3" class="tabsalesord">\
					<!-- My Team content here -->\
					<div class="container">\
						<br/><br/>\
						<!-- First Table -->\
						<table id="tableSOcount" class="table table-hover" cellspacing="0" style="width:100%; display:none">\
							<thead>\
								<tr>\
									<th >USER</th>\
									<th  align="right">SALES ORDERS WITH TASKS</th>\
									<th  align="right">SERVICES</th>\
									<th  align="right">ADDRESSES</th>\
									<th  align="right">PLANNING</th>\
								</tr>\
							</thead>\
							<tfoot>\
								<tr>\
									<th ></th>\
									<th  align="right"></th>\
									<th  align="right"></th>\
									<th  align="right"></th>\
									<th  align="right"></th>\
								</tr>\
							</tfoot>\
							<tbody></tbody>\
						</table>\
						<br/><br/>\
						<!-- Name of PM - Project Manager -->\
						<div id="secondPanel_all" class="panel panel-primary" style="display:none">\
							<div id="secondPanel" class="panel-heading" style="font-size: 16px; display:none"></div>\
						</div>\
						<div id="allSecondPanel" style="display:none">\
							<!-- Second Table -->\
							<div id="secondDiv">\
								<div style="width:100%">\
									<ul id="ulListdpto" class="list-group" style="display:none;list-style:none;margin-left:0px">\
										<li class="list-group-item">\
											<span class="badge">14</span>\
										</li>\
									</ul>\
								</div>\
							</div>\
							<!-- Third Table -->\
							<div id="thirdDiv" style="display:none" class="right_team">\
								<div id="treeTasksMyTeam" style="width:100%;height:450px;display:inline-block"></div>\
							</div>\
						</div>\
					</div>\
				</div>\
				<!-- End of Tab 2 tabsalesord2 - Task Tree -->\
				\
				\
				\
				\
				<div id="tabsalesord4" class="tabsalesord active">\
					<div class="filtersFirstBar" style="display: none">\
						<table id="filtersGroupTbl" class="filtersGroupTbl" style="width:100%; border:none; display: block">\
							<tr align="center">\
								<td class="ToMyTeam">\
								</td>\
							</tr>\
						</table>\
					</div>\
					<br/>\
					<div>\
						<table id="Customsalesorder" class="table table-hover">\
							<!--  This class was removed from here table-bordered -->\
							<thead>\
								<tr>\
									<th width="16%" title="Sales Order">Sales Order</th>\
									<th width="10%">Customer</th>\
									<th width="10%">Status</th>\
									<th width="10%">Description</th>\
									<th width="10%">Items</th>\
									<th width="5%">Locations</th>\
									<th width="10%">Days Since Approved</th>\
									<th width="5%">Project Manager</th>\
									<th width="10%">Sales Rep</th>\
									<th width="5%">Provisioning Engineer</th>\
									<th width="5%"> MRR </th>\
									<th width="5%"> NRR </th>\
									<th width="8%">Estimated Delivery Date</th>\
									<th width="8%">Pending MRR</th>\
									<th width="8%">Pending NRR</th>\
									<th width="1%" style="display: none">Address Cities</th>\
								</tr>\
							</thead>\
							<tfoot>\
								<tr>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th ></th>\
									<th style="display: none" ></th>\
								</tr>\
							</tfoot>\
							<tbody> </tbody>\
						</table>\
\
						<button id="ButtonLoadMore_Customsalesorder" type="button" class="btn btn-info btn-transparent" data-slice="-1">Load More...</button>\
					</div>\
					<!-- <p style="text-align"><img src="http://cdn.kaptestglobal.com/images/icons/man-grey.png" alt=\'\' /></p> -->\
				</div>\
				<!-- End of Tab 3 tabsalesord3 - Task Tree -->\
				\
				\
				\
				<div id="tabsalesord5" class="tabsalesord">\
					<div class="filtersBar4OrderSales">\
						<p id="msgAdminSalesOrdersTab"></p>\
\
						<div id="filtersGroupOS3" class="cols-sm-12" style="padding:20px 0;">\
							<div class="col-sm-9">\
								<label>Filter by SO Status: </label>\
								<select id="multipleSelectSalesOrders2" title="Click here to select any of the provided options" data-placeholder="Select Type of Sales Order" class="selectpicker" multiple>\
									<option value="SalesOrd:A">	Pending Approval</option>\
									<option value="SalesOrd:B" selected> Pending Fulfillment</option>\
									<option value="SalesOrd:C">	Cancelled</option>\
									<option value="SalesOrd:D" selected> Partially Fulfilled</option>\
									<option value="SalesOrd:E" selected> Pending Billing/Partially Fulfilled</option>\
									<option value="SalesOrd:F">	Pending Billing</option>\
									<option value="SalesOrd:G">	Billed</option>\
									<option value="SalesOrd:H">	Closed</option>\
								</select>\
							</div>\
\
							<div class="filtersDividers">\
								<script>\
									WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
										"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
								<\/script>\
							</div>\
\
							<div class="basicFilters" style="display: inline-block;">\
								<div id="filterButtonALLSO2" class="filterButtonALLSO">Filter</div>\
							</div>\
\
							<div class="filtersDividers">\
								<script>\
									WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
										"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
								<\/script>\
							</div>\
\
						</div>\
\
					</div>\
					<!-- End of filtersBar -->\
\
					<br/>\
					<br/>\
					<div align="right">\
						<h6 id="AllRegistersSalesH1">...</h6></div>\
					<table id="allsalesorder" class="table table-hover">\
						<!--  This class was removed from here table-bordered -->\
						<thead>\
							<tr>\
								<th width="16%"  title="Sales Order">Sales Order</th>\
								<th width="10%" >Customer</th>\
								<th width="10%" >Status</th>\
								<th width="10%" >Description</th>\
								<th width="10%" >Items</th>\
								<th width="5%" >Locations</th>\
								<th width="10%" >Days Since Approved</th>\
								<th width="5%" >Project Manager</th>\
								<th width="10%" >Sales Rep</th>\
								<th width="5%" >Provisioning Engineer</th>\
								<th width="5%" > MRR </th>\
								<th width="5%" > NRR </th>\
								<th width="8%" >Estimated Delivery Date</th>\
								<th width="8%" >Pending MRR</th>\
								<th width="8%" >Pending NRR</th>\
								<th width="1%"  style="display: none">Address Cities</th>\
							</tr>\
						</thead>\
						<tfoot>\
							<tr>\
								<th ></th>\
								<th ></th>\
								<th ></th>\
								<th ></th>\
								<th ></th>\
								<th ></th>\
								<th ></th>\
								<th ></th>\
								<th ></th>\
								<th ></th>\
								<th ></th>\
								<th ></th>\
								<th ></th>\
								<th ></th>\
								<th ></th>\
								<th style="display: none" ></th>\
							</tr>\
						</tfoot>\
						<tbody> </tbody>\
					</table>\
					<div align="right">\
						<h6 id="AllRegistersSalesH2">...</h6></div>\
					<br/>\
					<br/>\
					<button id="ButtonLoadMore_allsalesorder" type="button" class="btn btn-info btn-transparent" data-slice="-1">Load More...</button>\
					<!-- <button id="ButtonLoadAllMyWork" title="Load all records from my work" type="button" class="btn btn-info btn-transparent"> Load All </button> -->\
				</div>\
\
			</div>\
		</div>\
		<!--End of Tabs Sales Orders-->\
		\
		\
		\
		<div class="selecttab">\
			<!--Table content to generated starts here  -->\
			<!-- Tables for Services and Service Addresses -->\
			<p class="nivela">&nbsp;</p>\
			<!-- We add Tabs here-->\
			<div class="thetabtogants" style="display: none;">\
				<span style="display:none" id="IdSalesorderBySpan"></span>\
				<div id="NameSalesorderBySpan"></div>\
				<ul class="tabtogant-links">\
					<li class="active"><a href="#tabtogant1">Table View</a></li>\
					<li><a href="#tabtogant2" class="dtab2">Task Tree View</a></li>\
					<!-- <li><a href="#tabtogant3" class="dtab3">Gantt View</a></li> -->\
					<li><a id="tabtogant3" href="" target="_blank" class="dtab3">Gantt View</a></li>\
				</ul>\
				<!-- Tabs Content -->\
				<div class="tabtogant-content">\
					<div id="tabtogant1" class="tabtogant active">\
						<div class="filtersBar" style="display:none;">\
							<div id="filtersGroupTbl" class="cols-sm-12" style="padding:20px 0 40px 0;">\
								<div class="col-sm-9">\
									<div class="div-selectassigned basicFilters" style="display: none;"></div>\
									<div class="div-selectdepartment basicFilters" style="display: none;"></div>\
									<div class="div-selecttaskstatus basicFilters" style="display: none;"></div>\
									<div class="div-selectStartDate basicFilters" style="display: none;">Start Date\
										<input type="text" onchange="" id="filterStartDate" class="toDatePickerFilter"> </div>\
									<div class="div-selectDueDate basicFilters" style="display: none;">Due Date\
										<input type="text" onchange="" id="filterDueDate" class="toDatePickerFilter"> </div>\
									<div class="div-selectWoW basicFilters" title="Work on Weekend" style="display: none;">Work on Weekends\
										<input type="checkbox" onchange="" id="filterWoW" name="filterWoW" class="filterWoW"> </div>\
									<div class="div-selectDuration basicFilters" style="display: none;">Duration from\
										<input type="text" size="6" onchange="" id="filterDurationStart" name="filterDurationStart" class="filterDurationStart" value=""> to\
										<input type="text" size="6" onchange="" id="filterDurationEnd" name="filterDurationEnd" class="filterDurationEnd" value="">\
									</div>\
									<div class="div-labelServices basicFilters" style="display: inline-block;">\
										<select id="selServices" class="div-selServices basicFilters" style="height:32px; display: inline-block;"> </select>\
										<select id="selAdresses" class="div-selAdresses basicFilters" style="height:32px; display: inline-block;"></select>\
									</div>\
								</div>\
\
								<div class="filtersDividers">\
									<script>\
										WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
											"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
									<\/script>\
								</div>\
\
								<div class="div-selectDuration basicFilters" style="display: inline-block;">\
									<div onclick="Reset.call(this)" id="filterReset" class="filterButton">Reset</div>\
								</div>\
\
								<div class="div-selectDuration basicFilters" style="display: inline-block;">\
									<div id="filterButtonG" class="filterButton">Filter</div>\
								</div>\
\
								<div class="filtersDividers">\
									<script>\
										WF_wh("<img src=\'/core/media/media.nl?id=6520865&c=3461650&h=b1508371f29e451d2a01\' alt=\'\' />",\
											"<img src=\'/core/media/media.nl?id=8153905&c=3461650&h=b22aec6399c3c7a0e99c\' alt=\'\' />");\
									<\/script>\
								</div>\
\
							</div>\
							<div class="col-sm-12" style="margin:6px;">&nbsp;</div>\
\
						</div>\
\
\
\
\
						<table id="myUpdatedSA" class="myUpdatedSA" style="display:none">\
							<thead>\
								<tr>\
									<th align="center" width="10%" class="rounded-th-left">Service(s)</th>\
									<th align="center" width="1%">Capacity</th>\
									<th align="center" width="5%">UoM</th>\
									<th align="center" width="19%">Location A</th>\
									<th align="center" width="15%">Address A</th>\
									<th align="center" width="19%">Location Z</th>\
									<th align="center" width="15%">Address Z</th>\
									<th align="center" width="10%">Delivery Date *</th>\
									<th align="center" width="15%" class="rounded-th-right">Subscription</th>\
								</tr>\
							</thead>\
							<tbody></tbody>\
						</table>\
						<p class="nivela">&nbsp;</p>\
						<table id="myUpdatedServicesAddresses" class="myUpdatedServicesAddresses" style="display:none">\
							<thead>\
								<tr>\
									<th align="center" width="10%" class="rounded-th-left">Address Name</th>\
									<th align="center" width="33%">Address</th>\
									<th align="center" width="14%">City</th>\
									<th align="center" width="14%">Type</th>\
									<th align="center" width="14%">Status</th>\
									<th class="rounded-th-right" width="14%">Last Mile Type</th>\
								</tr>\
							</thead>\
							<tbody> </tbody>\
						</table>\
						<p class="nivela">&nbsp;</p>\
						<!-- Add Filters Bar -->\
\
						<!-- 222222222 -->\
						<div align="right">\
							<h6 id="RegistersfromTaskTable1">...</h6></div>\
						<!-- End of filtersBar -->\
						<br/>\
						<br/>\
						<!-- In this table we draw the tasks of the user/all tasks -->\
						<table id="mytblTasks" class="mytblTasks" style="width:100%; border:none; display: none">\
							<thead>\
								<tr>\
									<th width="20%" align="center" valign="middle"><strong>Task</strong></th>\
									<th width="10%" align="center" valign="middle"><strong>Assigned</strong></th>\
									<th width="8%" align="center" valign="middle" class="centerth"><strong> ACK</strong></th>\
									<th width="8%" align="center" valign="middle" class="centerth"><strong>Status</strong></th>\
									<th width="10%" align="center" valign="middle" class="centerth"><strong>Start\
										Date</strong></th>\
									<th width="10%" align="center" valign="middle" class="centerth"><strong>Due\
										Date</strong></th>\
									<th width="7%" align="center" valign="middle" class="centerth"><strong>Work on Weekends</strong></th>\
									<th width="5%" align="center" valign="middle" class="centerth"><strong>Duration</strong></th>\
									<!-- <th width="2%" align="center" valign="middle" class="centerth"><strong>Save</strong></th> -->\
								</tr>\
							</thead>\
							<tbody></tbody>\
						</table>\
\
						<br/>\
						<br/>\
						<div align="right">\
							<h6 id="RegistersfromTaskTable2">...</h6></div>\
						<button id="ButtonLoadMoreTasks" title="Loads 50 more registers..." type="button" class="btn btn-info btn-transparent" data-slice="-1" data-function="1">Load More...</button>\
\
					</div>\
					<!-- End of Tab 1 tabtogant1 ACTIVE -->\
					<div id="tabtogant2" class="tabtogant">\
						<div class="tab2Container">\
							<div class="tskStatusColorContainer">\
								<div class="tskStatusColor tskGreen">&nbsp;</div><span class="spTskStatus">Completed</span>\
								<div class="tskStatusColor tskGray">&nbsp;</div><span class="spTskStatus">Cancelled</span>\
								<div class="tskStatusColor tskBlue">&nbsp;</div><span class="spTskStatus">Normal</span>\
								<div class="tskStatusColor tskRed">&nbsp;</div><span class="spTskStatus">Outdate</span>\
								<div class="tskStatusColor tskCream">&nbsp;</div><span class="spTskStatus">Duration</span>\
								<div class="tskStatusColor tskDarkGray">&nbsp;</div><span class="spTskStatus">Range</span>\
							</div>\
							<br/><br/>\
							<div id="treeTasks" style="width:50%;min-height: 530px;display:inline-block; border: 1px solid #999;"></div>\
							<div id="Task" class="right">\
								<div id="goToTranstelco" class="preimageTasks">\
									<script>\
										WF_wh("<img src=\'/core/media/media.nl?id=6522405&c=3461650&h=c18776f0221b9a84e485\' title=\'logo Transtelco\' />",\
											"<img src=\'/core/media/media.nl?id=8153909&c=3461650&h=b6b56279e0c20b8efaba\' title=\'logo Transtelco\' />");\
									<\/script>\
								</div>\
								<div class="todoScroll">\
									<table id="tableTask" class="tbl-task-details" style="width:100%; border:none; display: none">\
										<thead>\
											<tr>\
												<th colspan="2" align="center" valign="left"><strong>Title</strong></th>\
											</tr>\
										</thead>\
										<tbody></tbody>\
									</table>\
								</div>\
							</div>\
						</div>\
					</div>\
					<!-- <div id="tabtogant3" class="tabtogant">\
					<div style="position: relative;width: 1450px;overflow: scroll;overflow-x: auto;overflow-y: hidden;">\
						<br/><br/><br/>\
						<a id="viewSOLink" href="" target="_blank" class="ganttBtn"><span>Open Gantt Window</span></a>\
					</div>\
				</div> -->\
				</div>\
			</div>\
			<!--End of Tabs here-->\
			<div>\
				<!-- Large modal -->\
				<div style="display: none">\
					<button id="play" type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg">Large modal</button>\
				</div>\
				<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">\
					<div class="modal-dialog modal-lg" role="document">\
						<div class="modal-content">\
							<!--End of Tabs here-->\
							<p class="nivela">&nbsp;</p>\
							<table id="myUpdatedTasks" class="" class1="myUpdatedTasks" style="width:100%; borders=none;">\
								<thead>\
									<tr>\
										<th width="20%" align="center" valign="middle"><strong>Title</strong></th>\
										<th width="5%" align="center" valign="middle"><strong>Assigned</strong></th>\
										<th width="5%" align="center" valign="middle"><strong>Ack</strong></th>\
										<th width="10%" align="center" valign="middle"><strong>Status</strong></th>\
										<th width="10%" align="center" valign="middle" class="centerth"><strong>OLD Start Date</strong></th>\
										<th width="15%" align="center" valign="middle" class="centerth"><strong>OLD Due	Date</strong></th>\
										<th width="10%" align="center" valign="middle" class="centerth"><strong>Start Date</strong></th>\
										<th width="10%" align="center" valign="middle" class="centerth"><strong>Due Date</strong></th>\
										<th width="10%" align="center" valign="middle" class="centerth"><strong>Work on Weekends</strong></th>\
										<th width="5%" align="center" valign="middle" class="centerth"><strong>Duration</strong></th>\
									</tr>\
								</thead>\
								<tbody> </tbody>\
							</table>\
							<br/>\
							<br/>\
							<button id="closeTskBtn" type="button" class="btn btn-default" data-dismiss="modal">Close</button>\
						</div>\
					</div>\
				</div>\
			</div>\
		</div>\
	</div>\
	<br/>\
	<br/>');
}
</script>

	<!-- GANTT
<script src="/core/media/media.nl?id=5879979&c=3461650&h=8be1a3c98517f2b0ad3b&_xt=.js"></script>
dhtmlxgantt_tooltip.js
<script src="/core/media/media.nl?id=5880037&c=3461650&h=8a8dd26e8a30deca440c&_xt=.js" type="text/javascript" charset="utf-8"></script>
dhtmlxgantt_auto_scheduling.js
<script src="/core/media/media.nl?id=5880028&c=3461650&h=efe7b1336a22fe56e323&_xt=.js" type="text/javascript" charset="utf-8"></script>
 dhtmlxgantt_critical_path.js
<script src="/core/media/media.nl?id=5880029&c=3461650&h=b8aee7db43fa27f4b1ff&_xt=.js" type="text/javascript" charset="utf-8"></script>
 Calling select2.js
<script src="/core/media/media.nl?id=6514726&c=3461650&h=96e6333ea6e0d850234c&_xt=.js"></script>
-->
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/js/bootstrap-select.min.js"></script>

	<!-- (Optional) Latest compiled and minified JavaScript translation files -->
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/js/i18n/defaults-*.min.js"></script> -->

	<!-- Ajax functions to update, move, change tasks information -->
	<script>
		var CurrentIP;

		window.getColorTaskValidate = function(setColortoRedOutDated, yellow, status) {
			var colors_by_state = {
				'Normal': '',
				'RedA': " style='background: #990000; opacity:0.1;' ",
				'Red': " style='background-color: rgba(255,0,0,0.7); text-decoration: through;' ",
				'Yellow': " style='background: #FF9900;' ",
				'CompletedA': " style='background: #39AC39;' ",
				'Completed': " style='background-color: rgba(3,250,3,0.7);' ",
				'Cancelled': " style='text-decoration: line-through;' "
			};

			var flagColorRedRow = 'Normal';
			if (setColortoRedOutDated) flagColorRedRow = 'Red';
			if (yellow) flagColorRedRow = 'Yellow';
			if (status == '2') flagColorRedRow = 'Completed';
			if (status == '4') flagColorRedRow = 'Cancelled';

			return colors_by_state[flagColorRedRow];
		}
		
		function ShowHideSaleOrderDetail(swhd){
			if(WF_DEBUG)
				console.info('ShowHideSaleOrderDetail',((swhd)?'true':'false'));
			if (ViewStyle != 'OLD') {
				if(swhd)
					$("#salesorderdetail").show();
				else
					$("#salesorderdetail").hide();
			} else {
				if(swhd){
					$("div.thetabtogants").show();
					$("table#myUpdatedSA").show();
					$("table#myUpdatedServicesAddresses").show();
					$("table#mytblTasks").show();
				} else {
					$("div.thetabtogants").hide();
					$("table#myUpdatedSA").hide();
					$("table#myUpdatedServicesAddresses").hide();
					$("table#mytblTasks").hide();
				}
			}
		}
		
		function hideTablesDivs(swhd){
			if(WF_DEBUG)
				console.info('hideTablesDivs',((swhd)?'true':'false'));
			if (ViewStyle != 'OLD') {
				//if(swhd)
					//jQuery("#salesorderdetail").show();
				//else
					//$("#salesorderdetail").hide();
			} else {
				if(swhd){
					// Show Tables
					$("table#myUpdatedSA").show();
					$("table#myUpdatedServicesAddresses").show();
					$(".filtersBar").show();
					$(".div-selectassigned").show();
					$(".div-selectdepartment").show();
					$(".div-selecttaskstatus").show();
					$(".div-selectStartDate").show();
					$(".div-selectDueDate").show();
					$(".div-selectWoW").show();
					$(".div-selectDuration").show();
					$("table#mytblTasks").show();
					
				} else {
					// Hide Tables
					$("table#myUpdatedSA").hide();
					$("table#myUpdatedServicesAddresses").hide();
					$(".filtersBar").hide();
					$(".div-selectassigned").hide();
					$(".div-selectdepartment").hide();
					$(".div-selecttaskstatus").hide();
					$(".div-selectStartDate").hide();
					$(".div-selectDueDate").hide();
					$(".div-selectWoW").hide();
					$(".div-selectDuration").hide();
					$("table#mytblTasks").hide();
					
				}
			}
		}

		$(document).ready(function() {
			$.getJSON("https://api.ipify.org?format=json", function(data) {
				CurrentIP = data.ip;
			});
			// var arrayFilters = [];
			var GlobalEditing = false;
			var GlobalStartDate = 0;
			var GlobalDueDate = 0;
			var GlobalLastStatus = 0;
			var GlobalSalesOrderTbl;
			var GlobalSalesOrderTbl2;
			var Global_myTreeViewTask;
			var Global_collapseFirst = [];
			var Pm = false;
			var whichSOFilters = 'SalesOrd:B,SalesOrd:D,SalesOrd:E';
			var whichSOFilters2 = 'SalesOrd:B,SalesOrd:D,SalesOrd:E';
			var whichStatusFilters = '1';
			window.flat1 = null;
			$("#gantt1").hide();

			function getUrl() {
				if (WorkForce_Obj.Env == 'SANDBOX') {
					return {
						'RT-Old': '/app/site/hosting/restlet.nl?script=1386&deploy=1',
						'RT2-Old': '/app/site/hosting/restlet.nl?script=1413&deploy=1',		
						'RT': '/app/site/hosting/scriptlet.nl?script=1481&deploy=1',
						'BSL': '/app/site/hosting/scriptlet.nl?script=1481&deploy=1',
						'RT2': '/app/site/hosting/scriptlet.nl?script=1481&deploy=1',
						'RT3': '/app/site/hosting/restlet.nl?script=1427&deploy=1',
						'wrike': '/app/site/hosting/scriptlet.nl?script=1393&deploy=1',
						'Common': "/app/site/hosting/scriptlet.nl?script=837&deploy=1"
					}
				} else {
					return {
						'RT-Old': '/app/site/hosting/restlet.nl?script=1307&deploy=1', // Old RT
						'RT': '/app/site/hosting/scriptlet.nl?script=1346&deploy=1',
						'BSL': '/app/site/hosting/scriptlet.nl?script=1346&deploy=1',
						'RT2': '/app/site/hosting/scriptlet.nl?script=1346&deploy=1',
						'RT3': '/app/site/hosting/restlet.nl?script=1344&deploy=1',
						'wrike': '/app/site/hosting/scriptlet.nl?script=1246&deploy=1',
						'Common': '/app/site/hosting/scriptlet.nl?script=837&deploy=1'
					}
				}
			}

			function CleanResponseData(data) {
				// if(WF_DEBUG)
				// 	console.info('newData', data);
				var newData = String(data).split('<!--');
				return JSON.parse(newData[0]);
			}

			// Enable common function for ajax...
			$(document).ajaxStart(function() {
				if (WF_LOADER_AUTO) return;
				WF_LOADER_LEVEL++;
				if (WF_DEBUG)
					console.log('WF_LOADER_LEVEL', WF_LOADER_LEVEL);
				$('.loader').show();
			});

			$(document).ajaxComplete(function() {
				//..console.log('loader HIDE');
				//$('.loader').css("display", "none");
				WF_LOADER_LEVEL--;

				if (WF_DEBUG)
					console.log('WF_LOADER_LEVEL', WF_LOADER_LEVEL);

				if (WF_LOADER_LEVEL < 1) {
					$('.loader').hide();
					WF_LOADER_AUTO = false;
				}
			});
			// Helper functions....
			window.WorkForce_turnOffDebug = function() {
				WF_DEBUG = false;
			}
			window.WorkForce_turnOnDebug = function() {
				WF_DEBUG = true;
			}
			window.WorkForce_getDebugStatus = function() {
				return WF_DEBUG;
			}
			window.WorkForce_turnOffAjaxDebug = function() {
				WF_DEBUG_AJAX = false;
			}
			window.WorkForce_turnOnAjaxDebug = function() {
				WF_DEBUG_AJAX = true;
			}
			window.WorkForce_getAjaxDebugStatus = function() {
				return WF_DEBUG_AJAX;
			}
			window.WorkForce_getMode = function() {
					return WORKFORCE_MODE ? 'NORMAL' : 'TESTING';
			}
	//------

			window.setLevelLoader = function setLevelLoader(level) {
				WF_LOADER_LEVEL = level;
				WF_LOADER_AUTO = true;
				$('.loader').show();
				if (WF_DEBUG)
					console.log('setLevelLoader() WF_LOADER_LEVEL:', WF_LOADER_LEVEL, 'WF_LOADER_AUTO:', WF_LOADER_AUTO);
			}

			window.turnOffLoader = function turnOffLoader() {
				if (WF_DEBUG)
					console.log('turnOffLoader() WF_LOADER_LEVEL:', WF_LOADER_LEVEL, 'WF_LOADER_AUTO:', WF_LOADER_AUTO);

				$('.loader').hide();
				WF_LOADER_LEVEL = 0;
				WF_LOADER_AUTO = false;
			}
//-----

			// We read the content of the variable from suitelet | Takes the SO of the user and puts them in custpage_salesorderofuser
			var selOrderSalesOfUser = $('input#custpage_salesorderofuser').val();
			// We make the Order Sales Status select element functionality
			// Select processor of Sales Orders
			// $('[id^=multipleSelectSalesOrders]').select2();
			$('[id^=multipleSelectSalesOrders]').on('change', function() {
				whichSOFilters = ($(this).val());
			});

			//$('[id^=multipleSelectSalesOrders2]').select2();
			$('[id^=multipleSelectSalesOrders2]').on('change', function() {
				whichSOFilters2 = ($(this).val());
			});

			// $('[id^=multipleSelectStatus]').select2();
			$('[id^=multipleSelectStatus]').on('change', function() {
				whichStatusFilters = ($(this).val());
			});

			// initialized picker
			$("input[id^=s2id_]").hide();

			// Obtains team members if there are any
			var MyTeamLength = $('input#custpage_selectmyteam').val();
			//console.log(MyTeamLength);
			var MyTeam = $.parseHTML(MyTeamLength);
			MyTeamLength = MyTeam[0].length;
			$(MyTeam).appendTo(".ToMyTeam");
			$('input#custpage_selectmyteam').show();
			if (MyTeamLength > 1) {
				$('#filtersFirstBar').css("display", "block");
				$('.tabso2').css("display", "block");
				$('.tabso3').css("display", "block");
				$('.tabso4').css("display", "block");
				//$('.tabso5').css("display" , "block");
				// Pm = true;
			}
			var newRole = $('input#custpage_userrole').val();
			newRole = Math.round(newRole);
			//console.log ('The role of this user is '  +  newRole);

			var txtRole;
			if (newRole == 3) {
				txtRole = 'Administrator';
			} else if (newRole == 18) {
				txtRole = 'Full Access';
				Pm = true;
			} else if (newRole == 1023) {
				txtRole = 'Sales Director';
			} else if (newRole == 1022) {
				txtRole = 'Project Manager';
				Pm = true;
			}
			// alert(newRole);
			if (newRole == 3 || newRole == 18 || newRole == 1023 || newRole == 1022) {
				//alert('Hi! you are a valid user able to see the Sales Order Tab; for now only Administrators, Full Access and Sales Director will be able to see it.');
				$('p#msgAdminSalesOrdersTab').html('As ' + txtRole + ' role, you can see this General View of Sales Orders');
				$('.tabso5').css("display", "block");
			}

			$(".dhxtreeview_cont").css('width', '100%');
			$(".dhxtreeview_cont").css('height', '100%');
			// End of team function
			
			/* Run in main  */
			// setLevelLoader(2);
			GetSalesOrdersbyID('Customsalesorder', 'CurrentUser', 'SomeSOStatus',true);

			//console.log(selOrderSalesOfUser);
			// Block to get Sales Orders assigned to the user
			var WhichSalesOrder = '';
			var date = new Date();
			var day = date.getDate();
			var month = date.getMonth() + 1;
			var year = date.getFullYear();
			// Set correct format for date.. in a string way
			if (month < 10) month = "0" + month;
			if (day < 10) day = "0" + day;
			var today = year + "-" + month + "-" + day;
			//var today = month + "/" + day + "/" + year;
			$('#filterStartDate').attr("value", today);
			$('#filterDueDate').attr("value", today);
			var lstEmployeeSelect = $('input#custpage_selectempselect').val();

			$('.div-selectassigned').css({
				'font-weight': 'normal',
				'height': '32px'
			});
			$('.div-selectdepartment').css('font-weight', 'normal');

			// This variable will be used to fill the main task status filter
			var lstTaskStatusFilter = $('input#custpage_selectstatustask').val();
			var regexTask = new RegExp("selectTaskStatus", "g");
			lstTaskStatusFilter = lstTaskStatusFilter.replace(regexTask, 'filterTask');
			lstTaskStatusFilter = lstTaskStatusFilter.replace('selTaskStatus', 'filterTask');
			lstTaskStatusFilter = lstTaskStatusFilter.replace('class="filterTask">', 'class="filterTask" style="height:32px"><option value="notstatus">- Filter by Task Status -</option>');
			lstTaskStatusFilter = lstTaskStatusFilter.replace('onchange="changeselTaskStatus.call(this)"', 'onchange=""');
			//lstTaskStatusFilter = lstTaskStatusFilter.replace('changeselTaskStatus', 'changeLoadStatusTasks');
			lstTaskStatusFilter = $('.div-selecttaskstatus').html(lstTaskStatusFilter);
			var lstStatusSelect = $('input#custpage_selectstatustask').val();
			// Global Variables
			var WorkWeekend; // Stores if the selected row/taks has set if the Employee will work on Weekends
			var taskID; // Stores the task ID displayed for each row
			var targetTasks;
			
			hideTablesDivs(false);
			
			$('select.div-salesorder').change(function() {
				var targetTasks = $(this).val();
				if (targetTasks == 'showalltasks') {
					targetTasks = 'showalltasks';
					$('select[mytag="***"]').closest("tr").show();
					$('select[mytag="+++"]').closest("tr").show();
					// In case you want to have alternate row backgrounds use these lines
					//$("#mytblTasks tr:odd").children('td').css("background-color","#ffffff");
					//$("#mytblTasks tr:even").children('td').css("background-color","#f2f2f2");
				} else {
					targetTasks = 'showonlymytasks';
					$('select[mytag="+++"]').closest("tr").hide();
					$('select[mytag="***"]').closest("tr").show();
				}
			});




//---GetAllMyWork>
			function getAllMyWork(slice, status, fromFilter) {
				if (WF_DEBUG)
					console.info('getAllMyWork(slice, status, fromFilter)', slice, status, fromFilter);
				if (!status)
					status = 1;
				// tamSlice asigns the number of records to get and be added to the correspondant table
				var tamSlice = 50;
				$.ajax({
					url: getUrl().RT,
					data: {
						'action': 'getAllMyWork',
						'statusId': status
					},
					// dataType: 'json',
					dataType: 'text',
					async: true,
					beforeSend: function(data) {
						$('#AllMyWork').DataTable().destroy();
						$('#AllMyWork > tbody > tr').remove();
					},
					complete: function(data) {
						setTimeout(function() {
							if ($.fn.dataTable.isDataTable('#AllMyWork')) {
								$('#AllMyWork').DataTable().destroy();
							}
							$('#AllMyWork').DataTable({
								//	"scrollY": "600px"
								"scrollCollapse": true,
								"bInfo": false,
								"paging": false,
								"info": true,
								"deferRender": true,
								"order": [
									[4, "asc"]
								],
								"columnDefs": [{
									"width": "10",
									"targets": 8
								}]
							});
							$('table#AllMyWork td:nth-child(11)').hide();
							$('table#AllMyWork th:nth-child(11)').hide();
							//	var flat1 = flatpickr('.toDatePicker');

							flat1 = flatpickr('.toDatePicker', {
								dateFormat: CalendarInputFormat
							}); // initialized picker
						}, 1000);
					},
					success: function(data) {
						//console.info('dataWork', data);
						data = CleanResponseData(data);
						//console.info('data String',data);
						//	data = JSON.parse(data);
						//	console.info('data Obj',data);
						//33333333333
						var AllRows = 0;
						var moreslice = tamSlice;
						data.forEach(function(e) {
							AllRows++;
						});

						if (slice == "all") {
							$("#AllMyWork > tbody > tr ").remove();
							slice = 0;
							moreslice = AllRows;
						} else if (slice != undefined) {
							moreslice = parseInt(slice) + tamSlice;
						} else {
							$("#AllMyWork > tbody > tr ").remove();
							slice = 0;
						}

						if (moreslice < AllRows) {
							$('#AllRegistersMyWorkH1').text(moreslice + " / " + AllRows + " tasks");
							$('#AllRegistersMyWorkH2').text(moreslice + " / " + AllRows + " tasks");
							$('#ButtonLoadMoreAllWork').prop('disabled', false);
						} else {
							$('#AllRegistersMyWorkH1').text(AllRows + " / " + AllRows + " tasks");
							$('#AllRegistersMyWorkH2').text(AllRows + " / " + AllRows + " tasks");
							$('#ButtonLoadMoreAllWork').prop('disabled', true);
						}
						var row;
						var count = 0;
						var ancount = 0; // slice;
							//data.slice(slice,moreslice).forEach(function (d) {
						data.slice(0, moreslice).forEach(function(d) {
							GlobalStartDate = d.GlobalStartDate;
							GlobarDueDate = d.GlobalDueDate;
							// We get the logged user ID
							var loggedUserID = $('input#custpage_userid').val();
							if (loggedUserID == '') {
								alert('Undetermined user, please login');
							}
							//  console.log(d);
							// We collect the user ID which is current in the active session
							loggedUserID = Math.round(loggedUserID);
							//  This variable will set the suffix for the iterative row on course.
							ancount++;
							count = "myWork" + ancount;
							// Assigment of Work on Weekend status for current task
							WorkWeekend = d.taskWorkWeekend;
							var WorkWeekendDisplay;
							// We save the Work on Weekend state here
							var WorkWeekend = d.taskWorkWeekend;

							// If the employee works on Weekends then make the check input to be marked
							if (WorkWeekend) {
								// This will input something like: $("input[id='WorkOnWeekends_7']").attr('checked', true)
								WorkWeekendDisplay = "<input type='checkbox' onchange='changeWorkOnWeekends.call(this)' id='WorkOnWeekends_" + count + "' name='check' class='check' checked /><p style='font-size:0px;position:absolute;'>true</p>"
							} else {
								WorkWeekendDisplay = "<input type='checkbox' onchange='changeWorkOnWeekends.call(this)' id='WorkOnWeekends_" + count + "' name='check' class='check' /><p style='font-size:0px;position:absolute;'>false</p>"
							}
							var BoolAck;
							if (d.taskAck) {
								BoolAck = "<input type='checkbox' onchange='changeAck.call(this)' id='Ack_" + count + "' name='check' disabled class='check' checked />"
							} else {
								BoolAck = "<input type='checkbox' onchange='changeAck.call(this)' id='Ack_" + count + "' name='check' class='check' />"
							}
							var vFilteredEmployeesList = lstEmployeeSelect.replace(d.taskAssignedID, d.taskAssignedID + ' selected');

							var vFilteredStatusList = lstStatusSelect;
							if (d.taskStatus) {
								vFilteredStatusList = lstStatusSelect.replace(d.taskStatus, d.taskStatus + " selected");
							}

							var vFilteredStatusList = vFilteredStatusList.replace('class="selectTaskStatus"', 'class="selectTaskStatus" title="You won\'t be able to update this task once the status changes to "completed/cancelled"');
							var vFilteredStatusList = vFilteredStatusList.replace('id="selTaskStatus"', 'id="selTaskStatus' + count + '"');
							var StatusTareaTexto = '';
							var StatusTaskLabel = ['', 'Active', 'Completed', 'Deferred', 'Cancelled'];
							StatusTareaTexto = StatusTaskLabel[d.taskStatus];

							var vFilteredStatusList = vFilteredStatusList.replace('</select>', '</select><p  class="kiko" style="font-size:0px;position:absolute;">' + StatusTareaTexto + '</p>');
							//console.log("Status "+count + " : "+d.taskStatus)
							// Impersoned Logged user
							//loggedUserID = 21562;
							// Disable Start Date and Due Date if user ID don't match for the current row
							dtaskStartDate = d.taskStartDate;
							dtaskDueDate = d.taskDueDate;
							dtaskDuration = "<input id='idTask_Duration_" + count + "' onblur='blurDuration.call()' onkeyup='changeDuration.call(this)' data-dependency='" + d.taskDependency + "' data-task='true' data-predecessor='" + d.taskPredecessor +
								"' type='text' size='3' value=" + d.taskDuration + " data-wrikeid='" + d.WrikeID + "' data-salesorder='" + d.SalesOrderID + "'>";
							//dtaskUpdateIcon = "<div id='dico" + count + "' class='GoUpdateDisabled'></div>";
							dtaskUpdateIcon = "<div onclick='clickdico.call(this)' data-task='true' id='dico" + count + "' class='GoUpdateDisabled'></div>";
							//console.log('count = ' + count + ' loggedUserID = ' + loggedUserID + ' d.taskAssignedID = ' +  d.taskAssignedID);
							//console.log('dtaskStarte: ' + dtaskStartDate);
							//console.log("PM : "+Pm);
							if (Pm == false) {
								if ((loggedUserID != d.taskAssignedID) || (d.taskStatus == 2) || (d.taskStatus == 4)) {
									//console.log(vFilteredEmployeesList);
									// Disable Asigned field if user ID don't match for the current row
									vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="+++" disabled id');
									vFilteredStartDate = dtaskStartDate.replace('input type', 'input disabled type');
									vFilteredDueDate = dtaskDueDate.replace('input type', 'input disabled type');
									WorkWeekendDisplay = WorkWeekendDisplay.replace('input type', 'input disabled type');
									BoolAck = BoolAck.replace('input type', 'input disabled type');
									vFilteredStatusList = vFilteredStatusList.replace('select name', 'select disabled name'); //selTaskStatus
									dtaskDuration = dtaskDuration.replace('input id', 'input disabled id');
									dtaskUpdateIcon = "<div onclick='clickdico.call(this)' data-task='true' id='dico" + count + "' class='GoUpdateDisabled'></div>";
									//dtaskUpdateIcon = "<div id='dico" + count + "' ><button onclick='clickdico()'>Go</button></div>";
								} else {
									vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="***" id');
									vFilteredStartDate = d.taskStartDate;
									vFilteredDueDate = d.taskDueDate;
								}
							} else {
								if ((d.taskStatus == 2) || (d.taskStatus == 4)) {
									//console.log(vFilteredEmployeesList);
									// Disable Asigned field if user ID don't match for the current row
									vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="+++" disabled id');
									vFilteredStartDate = dtaskStartDate.replace('input type', 'input disabled type');
									vFilteredDueDate = dtaskDueDate.replace('input type', 'input disabled type');
									WorkWeekendDisplay = WorkWeekendDisplay.replace('input type', 'input disabled type');
									BoolAck = BoolAck.replace('input type', 'input disabled type');
									vFilteredStatusList = vFilteredStatusList.replace('select name', 'select disabled name'); //selTaskStatus
									dtaskDuration = dtaskDuration.replace('input id', 'input disabled id');
									dtaskUpdateIcon = "<div onclick='clickdico.call(this)' data-task='true' id='dico" + count + "' class='GoUpdateDisabled'></div>";
									//dtaskUpdateIcon = "<div id='dico" + count + "' ><button onclick='clickdico()'>Go</button></div>";
								} else {
									vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="***" id');
									vFilteredStartDate = d.taskStartDate;
									vFilteredDueDate = d.taskDueDate;
								}
							}
							if (d.taskDependency == "startToStart") { // Si la dependencia es startToStart, se desabilita el picker StartDate
								vFilteredStartDate = dtaskStartDate.replace('input type', 'input disabled type');
							} else if (d.taskDependency == "startToFinish" || d.taskDependency == "finishToFinish") {
								vFilteredDueDate = dtaskDueDate.replace('input type', 'input disabled type');
							}
							//  vFilteredEmployeesList = vFilteredEmployeesList.replace('selectAsignee"', 'selectAsignee" data-rowid="' + count+'"');
							vFilteredEmployeesList = vFilteredEmployeesList.replace('selectAsignee', 'selectAsignee' + count);
							vFilteredEmployeesList = vFilteredEmployeesList.replace('selected >', 'selected>');
							var fTx = vFilteredEmployeesList.split("selected>").pop();
							fTx = fTx.substring(0, fTx.indexOf('<'));

							flagColorRedRow = getColorTaskValidate(d.setColortoRedOutDated, d.yellow, d.taskStatus);


							vFilteredEmployeesList = vFilteredEmployeesList.replace('</label>', '</label><p style="font-size:0px;position:absolute;">' + fTx + '</p>');
							
							row += "<tr id='" + count + "' data-id=" + d.taskId + " data-userid=" + d.taskAssignedID + " data-toshow='" + d.taskKpiLine + "_" + d.taskKpiItem + "' data-toshowaddress='" + d.taskKpiAddress + "'>" +
								"<td class='gradCell'><b>" + ancount + "</b> - " + d.company + "</td>" +
								"<td align='center' class='gradCell'><a href='#' class='idClickToSalesOrder' data-salesorderID='" + d.SalesOrderID + "'>" + d.SalesOrder + "</a></td>" +
								"<td class='styleToId'" + flagColorRedRow + " align='left'><span id='vtaskID" + count + "' style='display:none'>" + d.taskId + "</span><a href='#' data-taskid='" + d.taskId + "' data-wrikeid='" + d.WrikeID +
								"' class='toOpenWrike'> " + d.taskTitle + "</a></td>" +
								"<td class='styleToEntity' title='" + loggedUserID + " vs " + d.taskAssignedID + "' " + flagColorRedRow + ">" + vFilteredEmployeesList + "</td>" +
								"<td align='center' id='TaskAck_" + count + "' " + flagColorRedRow + ">" + BoolAck + "</td>" +
								"<td id='TaskStatus_" + count + "' " + flagColorRedRow + ">" + vFilteredStatusList + "</td>" +
								"<td " + flagColorRedRow + ">" + vFilteredStartDate + "</td>" +
								"<td " + flagColorRedRow + ">" + vFilteredDueDate + "</td>" +
								"<td align='center' " + flagColorRedRow + ">" + WorkWeekendDisplay + "</td>" +
								"<td align='center' " + flagColorRedRow + ">" + "<p style='font-size:0px;position:absolute;'>" + d.taskDuration + "</p>" + dtaskDuration + "</td>" +
								// +"<td align='center' "+flagColorRedRow+" display='none'>"+dtaskUpdateIcon+"</td>"
								"</tr>";
								
								
							// if(WF_DEBUG) console.info('vFilteredStartDate', vFilteredStartDate );
							// if(WF_DEBUG) console.info('vFilteredDueDate', vFilteredDueDate );
						});
						$("#AllMyWork > tbody").append(row);
					},
					error: function(e) {
						console.info(CleanResponseData(e));
						//alert("Ocurrio un error, vuelva a intentarlo! ");
						//console.error("GetAllMyWork() error ", (e.responseText));
						console.error("GetAllMyWork() error ");
					}
				});
			} // End of GetAllMyWork function
//---GetAllMyWork<



//--- PageSalesOrder>

			function PageSalesOrder(IdSalesOrder){
				var currentStep = $('#ButtonLoadMore_'+IdSalesOrder).attr('data-slice');
				console.info('currentStep1',currentStep);
				currentStep++;

				console.info('currentStep2',currentStep);
				$('#ButtonLoadMore_'+IdSalesOrder).attr('data-slice',currentStep);
				return currentStep;
			}

//--- PageSalesOrder<


//---GetSalesOrdersbyID>
			function GetSalesOrdersbyID(IDTable, idUser, SOStatus, fromfilter,slice) {
				if (WF_DEBUG)
					console.info('GetSalesOrdersbyID(IDTable, idUser, SOStatus, slice)', IDTable, idUser, SOStatus, slice);

				if (SOStatus === null && typeof SOStatus === "object") {
					SOStatus = 'AllSOStatus'
					if (WF_DEBUG)
						console.log('SOStatus = AllSOStatus');
				}
				SOStatus = String(SOStatus)
					//	console.log('SOStatus has been received with the value **: ' + SOStatus + ' of type: ' + typeof (SOStatus));
					//$("table#"+IDTable+"").find('tr:not(:first)').each(function () {
					//$(this).remove();
					//});
				var rtotItems = 0,
					rtotLocations = 0,
					rtotMRR = 0.0,
					rtotNRR = 0.0;
				var formatter = new Intl.NumberFormat('en-US', {
					style: 'currency',
					currency: 'USD',
					minimumFractionDigits: 2,
				});

				var AllRows = 0;
				var row = '';
				var moreslice = 100;

				if (WF_DEBUG_AJAX)
					console.info("ajax action: getMySalesOrders", getUrl().RT);

				var pagesel = PageSalesOrder(IDTable);
				// Function to get Sales Orders at beggining of execution
				$.ajax({
					url: getUrl().RT,
					data: {
						'action': 'getMySalesOrders',
						'IdUser': idUser,
						'SOStatus': SOStatus,
						'isPm': Pm,
						'PageSelected': pagesel
					}
					//, async: true
					,
					// dataType: 'json',
					dataType: 'text',
					complete: function() {
						//console.log ('You are firing the method GetSalesOrdersbyID on this table: #' + IDTable);
						$('.dataTables_scrollFoot').hide();
						//--$(".loader").fadeOut();

						setTimeout(function() {
							if ($.fn.dataTable.isDataTable('#' + IDTable)) {
								$('#' + IDTable).DataTable().destroy();
							}
							table = $('#' + IDTable + '').DataTable({
								"scrollY": "380px",
								// "bInfo": false,
								"scrollCollapse": true,
								"paging": false,
								"responsive": true,
								"order": [
									[11, "desc"]
								],
								"footerCallback": function(row, data, start, end, display) {

									var apiCustom = this.api(),
										data;
									// Remove the formatting to get integer data for summation
									var intVal = function(i) {
										return typeof i === 'string' ?
											i.replace(/[\$,]/g, '') * 1 :
											typeof i === 'number' ?
											i : 0;
									};

									pageTotal = apiCustom.column(4, {
										page: 'current'
									}).data().reduce(function(a, b) {
										return intVal(a) + intVal(b);
									}, 0);
									if (WF_DEBUG)
										console.log("Page Total: " + pageTotal);
									$(apiCustom.column(4).footer()).html('<span class="badge">' + pageTotal + '</span>');
									pageTotal = apiCustom.column(5, {
										page: 'current'
									}).data().reduce(function(a, b) {
										return intVal(a) + intVal(b);
									}, 0);
									$(apiCustom.column(5).footer()).html('<span class="badge">' + pageTotal + '</span>');
									pageTotal = apiCustom.column(10, {
										page: 'current'
									}).data().reduce(function(a, b) {
										return intVal(a) + intVal(b);
									}, 0);
									$(apiCustom.column(10).footer()).html('<span class="badge">' + formatter.format(pageTotal) + '</span>');
									pageTotal = apiCustom.column(11, {
										page: 'current'
									}).data().reduce(function(a, b) {
										return intVal(a) + intVal(b);
									}, 0);
									$(apiCustom.column(11).footer()).html('<span class="badge">' + formatter.format(pageTotal) + '</span>');
									pageTotal = apiCustom.column(13, {
										page: 'current'
									}).data().reduce(function(a, b) {
										return intVal(a) + intVal(b);
									}, 0);
									$(apiCustom.column(13).footer()).html('<span class="badge">' + formatter.format(pageTotal) + '</span>');
									pageTotal = apiCustom.column(14, {
										page: 'current'
									}).data().reduce(function(a, b) {
										return intVal(a) + intVal(b);
									}, 0);
									$(apiCustom.column(14).footer()).html('<span class="badge">' + formatter.format(pageTotal) + '</span>');
									$('.dataTables_scrollFoot').show();

								},
								"oLanguage": {
					        //  "sInfo": "Showing 1 to "+((pagesel+1)*20)+" of "+AllRows+" entries"
					         "sInfo": "Showing 1 to _END_ of "+AllRows+" entries"
					       }

							});

							$('[id^=selTaskStatus]').qtip({
								style: {
									classes: 'myCustomClass'
								}
							});
							$('input[type="search"]').attr("placeholder", " SO/Task/Date/Text");
							$('input[type="search"]').css('height', '50%');
							$('input[type="search"]').css('display', 'inline-block');
							$('.select2-search__field').attr("placeholder", " Filter by status of the Sales Orders by clicking on this field");

							var DoWeHaveRecords = $("#salesorder td.dataTables_empty").html();
							if (DoWeHaveRecords == 'No data available in table') {
								$("#salesorder td.dataTables_empty").html('<span style="font-size: 16px;">   No records found with this filter, try with another...   </span>');
							}
							//}
						}, 100); //Was 1000... ariel
						//} // End of if IDTable == 'salesorder'


						// setTimeout(function () {
						// 		// Readjust the Sales Order table width
						// 		//$('#salesorder_wrapper').css('display','block');
						// 		/* $('.dataTables_scrollHeadInner').css('width','1450px');
						// 		$('.dataTables_scrollFootInner').css('width','1450px'); */
						//
						//
						//
						// 	}, 500);
					},
					beforeSend: function(data) {
						//--$(".loader").fadeIn();
						$('#' + IDTable).DataTable().destroy();
						if(fromfilter)
							$('#' + IDTable + ' tbody tr').remove();
						$('.dataTables_scrollFoot').hide();
					},
					success: function(data) {
						data = CleanResponseData(data);

						WithoutReturnedRecords = data.length;

						//console.log ('En la tabla '+IDTable+' contamos con '+WithoutReturnedRecords+' registros');

						if (slice != undefined) {
							moreslice = parseInt(slice) + 50;
						}
						if (slice == undefined) {
							slice = 0;
						}
						//console.log("slice ="+slice +" moreslice="+moreslice );
						if (IDTable == 'allsalesorder') {
							data.forEach(function(e) {
								AllRows++;
							});
							//console.log("Hay: "+AllRows+"Registros en "+IDTable+"Alex");

						}
						//$('#salesorder_wrapper').css("display", "block");
						//$('#salesorder').css("display", "block");
						data[1].forEach(function(d) {
							//data.slice(slice,moreslice).forEach(function (d) {
							//	var NumItem = NumberOfItems(d.internalid);
							//	var NumSerAddress = NumberOfServiceAddresses(d.internalid);
							//var NumItem = 0;
							//var NumSerAddress = 0;
							var standardDate = formatDatebyNetsuiteDate(d.soDueDate);
							//console.log('d.sostatus: ' + d.sostatus);
							var colStatus = '';
							var colStatusLabels = {
								'SalesOrd:A': 'Pending Approval',
								'SalesOrd:B': 'Pending Fulfillment',
								'SalesOrd:C': 'Cancelled',
								'SalesOrd:D': 'Partially Fulfilled',
								'SalesOrd:E': 'Pending Billing/Partially Fulfilled',
								'SalesOrd:F': 'Pending Billing',
								'SalesOrd:G': 'Billed',
								'SalesOrd:H': 'Closed'
							};
							//console.log('d.sostatus:',d.sostatus,' Label:'+colStatusLabels[d.sostatus]);
							colStatus = colStatusLabels[d.sostatus];

							img_url = WF_whs('id=6521300&c=3461650&h=58f8ca4c67fada1f48d0',
								'id=8153908&c=3461650&h=4dfa99e3b987f3f8aad9');

							row += "<tr data-id=" + d.internalid + " data-so='" + d.tranid + "' data-osstatus='" + d.sostatus + "'>" +
								"<td align='middle' class='styleToId' style='vertical-align: middle;'>" +
								// "<a href='/app/accounting/transactions/salesord.nl?id=" + d.internalid + "&whence=' title='Click here to edit this sales order' target='_blank' style='z-index:900;'>" +
								// "<img src='/core/media/media.nl?"+img_url+"' />" + "</a><br/><span style='font-size:11px;'>" + d.tranid + "</span></td>" +

								//"<img src='/core/media/media.nl?" + img_url + "' style='margin:3px; padding:3px; border:1px solid #CCC;' onClick=\"window.open('/app/accounting/transactions/salesord.nl?id=" + d.internalid + "&whence=', '_blank');\" />" +
								//"<br/><span style='font-size:11px;'>" + d.tranid + "</span></td>" +

								"<div style=\"padding:3px;width:100%; heigth:100%; background-color:#EEE;\" onmouseover=\"this.style.background='#DDD';\" onmouseout=\"this.style.background='#EEE';\" "+
								"onClick=\"window.open('/app/accounting/transactions/salesord.nl?id=" + d.internalid + "&whence=', '_blank'); return false\">"+
								"<img src='/core/media/media.nl?"+img_url+"' style='margin:3px; padding:3px; border:1px solid #CCC;' />" + "<br/><span style='font-size:11px;'>" + d.tranid + "</span><div></td>" +


								"<td style='vertical-align: middle;'>" + d.customer + "</td>" +
								"<td>" + colStatus + "</td>" +
								"<td align='justify' style='vertical-align: middle;'>" + d.description + "</td>" +
								"<td class='rowDataSd' align='center' style='vertical-align: middle;'>" + d.soItems + " </td>" +
								"<td class='rowDataSd' align='center' style='vertical-align: middle;'>" + d.soSA + "</td>" +
								"<td align='middle'>" + d.DaysSinceApproved + "</td>" +
								"<td style='vertical-align: middle;'>" + d.ProjectManager + "</td>" + "<td style='vertical-align: middle;'>" + d.SalesRep + "</td>" +
								"<td style='vertical-align: middle;'>" + d.provengineer + "</td>" +
								"<td class='rowDataSd' title='Monthly Recurring Revenue' align='right' style='vertical-align: middle;'>" + formatter.format(d.MRR) + "</td>" +
								"<td class='rowDataSd' title='Non Recurring Revenue' align='right' style='vertical-align: middle;'>" + formatter.format(d.NRR) + "</td>" +
								"<td style='vertical-align: middle;'>" + dateToStringNetsuite(new Date(standardDate)) + "</td>" +
								"<td style='vertical-align: middle;text-align: right'>" + formatter.format(d.PendingMRR) + "</td>" +
								"<td style='vertical-align: middle;text-align: right'>" + formatter.format(d.PendingNRR) + "</td>" +
								"<td align='justify' style='vertical-align: middle;display:none'> " + d.addrcities + "</td>" +
								"</tr>";


							if (WF_DEBUG)
								console.log("Status " + d.sostatus);
						});
						// console.log(row);
						//console.log("ID TABLE  _______________  "+IDTable);
						$("table#" + IDTable + " > tbody").append(row);
						// console.log("make Append");
						//$("#salesorder.table > tbody").append(row);
						AllRows = data[0];
						moreslice = (pagesel+1)*20;
						if (moreslice < AllRows) {
							$('#AllRegistersSalesH1').text(moreslice + " / " + AllRows);
							$('#AllRegistersSalesH2').text(moreslice + " / " + AllRows);
							$('#ButtonLoadMore_'+IDTable).prop('disabled', false);
						} else {
							$('#AllRegistersSalesH1').text(AllRows + " / " + AllRows);
							$('#AllRegistersSalesH2').text(AllRows + " / " + AllRows);
							$('#ButtonLoadMore_'+IDTable).prop('disabled', true);
						}

						if(fromfilter)
							$('#ButtonLoadMore_'+IDTable).attr('data-slice',-1);
					},
					error: function(err) {
						if (WF_DEBUG)
							console.log('err', err);
					}
				}); // End of Ajax
			}
//---GetSalesOrdersbyID<



//GetSalesOrdersbyID('allsalesorder','NotUser', 'SomeSOStatus',0); // Obtener Todas las Sales Orders;
//GetSalesOrdersbyID('salesorder','CurrentUser', 'OnPageLoad'); // Obtener Mis Sales orders (CurrentUser);

// Function to  list Services Addresses: myUpdatedServicesAddresses




//---ChangeTableServiceAddresses>
			function ChangeTableServiceAddresses(WhichSalesOrder) {
				if (WF_DEBUG)
					console.info('ChangeTableServiceAddresses(WhichSalesOrder)', WhichSalesOrder);

				if (WF_DEBUG_AJAX)
					console.info("ajax action: getServiceAddresses", getUrl().BSL);

				$.ajax({
					//url: '/app/site/hosting/restlet.nl?script=1386&deploy=1'
					url: getUrl().BSL,
					data: {
						'action': 'getServiceAddresses',
						'SO': WhichSalesOrder
					},
					async: false,
					// dataType: 'json',
					dataType: 'text',
					success: function(data) {
						var toSelect = '<option value=""> Select Adresss </option>';
						data = CleanResponseData(data);
						var row = '';
						if (WF_DEBUG)
							console.log("data", data);
						//console.log('Data stream All Services: ' + data[0]);
						data.forEach(function(d) {
							toSelect += "<option value='" + d.id + "' >" + d.name + "</option>";
							row += "<tr data-toshow='" + d.id + "'>" +
								// "<td align='justify'><input type='checkbox' onchange='SetFilterToTasks.call(this)'/></td>" +
								"<td align='left' class='styleToId' style='vertical-align: middle;'>" + d.name + "</td>" +
								"<td style='vertical-align: middle;'>" + d.address + "</td>" +
								"<td align='justify'>" + d.city + "</td>" +
								"<td align='left'>" + d.type + "</td>" +
								"<td align='left'>" + d.status + "</td>" +
								"<td align='left'>" + d.lmt + "</td>" +
								"</tr>";
							//console.log( d);
						});
						$("table#myUpdatedServicesAddresses").find('tr:not(:first)').each(function() {
							$(this).remove();
						});
						$("table#myUpdatedServicesAddresses > tbody").append(row);
						$('#selAdresses').children().remove();
						$('#selAdresses').append(toSelect);

					},
					error: function(err) {
						console.log("error", err);
					}
				});
			}
//---ChangeTableServiceAddresses<




// Function to  get how many Services Addresses are in the selected sales order
//---NumberOfServiceAddresses>
			function NumberOfServiceAddresses(WhichSalesOrder) {
				if (WF_DEBUG)
					console.info('NumberOfServiceAddresses(WhichSalesOrder)', WhichSalesOrder);

				if (WF_DEBUG_AJAX)
					console.info("ajax action: getNumServiceAddresses", getUrl().RT);

				var NumberOfSAFound;
				$.ajax({
					url: getUrl().RT,
					data: {
						'action': 'getNumServiceAddresses',
						'SO': WhichSalesOrder
					},
					async: false,
					//dataType: 'json',
					dataType: 'text',
					success: function(data) {
						data = CleanResponseData(data);
						var MyNumberServiceAddresses;
						//console.log('Data stream Number of Services Addr: ');
						//console.log(data);
						NumberOfSAFound = data;
					},
					error: function(data) {
						return 0;
					}
				});
				return NumberOfSAFound;
			}
//---NumberOfServiceAddresses<




// Function to  get how many ITEMS are in the selected sales order
//---NumberOfItems>
			function NumberOfItems(WhichSalesOrder) {
				if (WF_DEBUG)
					console.info('NumberOfItems(WhichSalesOrder)', WhichSalesOrder);

				if (WF_DEBUG_AJAX)
					console.info("ajax action: getNumAllServices", getUrl().RT);

				var NumberOfItemsFound;
				$.ajax({
					url: getUrl().RT,
					data: {
						'action': 'getNumAllServices',
						'SO': WhichSalesOrder
					},
					async: false,
					// dataType: 'json',
					dataType: 'text',
					success: function(data) {
						data = CleanResponseData(data);
						// var MyNumberServiceAddresses;
						//console.log('Data stream Number of Items: ');
						//console.log(data);
						NumberOfItemsFound = data;
					},
					error: function(data) {
						return 0;
					}
				});
				return NumberOfItemsFound;
			}
//---NumberOfItems<





// Task Tree Start
//--------------------------------------------------------------
//---GetTaskTree>
			function GetTaskTree(WhichSalesOrder) {
				if (WF_DEBUG)
					console.info('GetTaskTree(WhichSalesOrder)', WhichSalesOrder);

				var resFinAdd = [],
					resFinItem = [],
					resFinPla = [];
				var dateFirst = [],
					dateFirstStart = [];
				var dateSecond = [],
					dateSecondStart = [];
				var dateThird = [],
					dateThirdStart = [];
				var dateFourth = [],
					dateFourthStart = [];
				var firstCat = [],
					secondCat = [],
					thirdCat = [],
					secondCatInd = [],
					thirdCatInd = [],
					fourthCatInd = [];
				var objArrays = {
					'firstCat': firstCat,
					'secondCat': secondCat,
					'thirdCat': thirdCat,
					'secondCatInd': secondCatInd,
					'thirdCatInd': thirdCatInd,
					'fourthCatInd': fourthCatInd
				};
				//Call ajax

				if (WF_DEBUG_AJAX)
					console.info("ajax action: getTasksTableTree", getUrl().BSL);

				$.ajax({
					url: getUrl().BSL,
					data: {
						'action': 'getTasksTableTree',
						'WhichSalesOrder': WhichSalesOrder
					},
					//	dataType: 'json',
					dataType: 'text',
					success: function(data) {
						var results = CleanResponseData(data);
						if (WF_DEBUG)
							console.info("Results", results);
						//console.log('WhichSalesOrder Adentro: ' + WhichSalesOrder);
						resFinAdd = callcategories(results.arrayAddress, 'taskKpiAddressCon', WhichSalesOrder, 'A');
						resFinItem = callcategories(results.arrayItem, 'taskKpiItemCon', WhichSalesOrder, 'I');
						resFinPla = callcategories(results.arrayPlan, 'taskPro', WhichSalesOrder, 'P');
						//Draw tree with all information
						//var drawTreeArr = resFinAdd.concat(resFinItem,resFinPla);
						/*
						resFinAdd = [
									 {id: 1, text: "Books", open: 1, items:
										 [
											{id: 2, text: "Turned at Dark / C. C. Hunter",items:
												[{id: 7, text: "Otro Valor"}]
											},
											{id: 3, text: "Daire Meets Ever / Alyson Nol"},
											{id: 4, text: "Socs and Greasers / Rob Lowe"},
											{id: 5, text: "Privacy and Terms.pdf"},
											{id: 6, text: "Licence Agreement.pdf"}
										 ],open:0
									 }
								 ];
						*/
						var drawTreeArr = resFinAdd.concat(resFinItem, resFinPla);
						//return drawTreeArr;
						Global_myTreeViewTask = new dhtmlXTreeView({
							parent: "treeTasks",
							multiselect: true,
							items: drawTreeArr
						});
						Global_myTreeViewTask.attachEvent("onSelect", function(id, mode) {
							var id = Global_myTreeViewTask.getSelectedId();
							//console.log('id Selected: ' + id);
						});
						//Functions
						//Call Type of tree
						function callcategories(arraCat, fieldCat, WhichSalesOrder, typeCat) {
							var executeArrays = (typeCat == 'A' || typeCat == 'I') ? getArrays(arraCat, fieldCat) : getArraysPlan(arraCat, fieldCat);
							//console.log(firstCat,secondCat,thirdCat,secondCatInd,thirdCatInd,fourthCatInd);
							objArrays = {
								'firstCat': firstCat,
								'secondCat': secondCat,
								'thirdCat': thirdCat,
								'secondCatInd': secondCatInd,
								'thirdCatInd': thirdCatInd,
								'fourthCatInd': fourthCatInd
							};
							var result = createArray(objArrays, typeCat, WhichSalesOrder);
							Global_collapseFirst.push(firstCat);
							resetArrays(objArrays);
							return result;
						}
						//resetArrays
						function resetArrays(objArrays) {
							firstCat = [];
							secondCat = [];
							secondCatInd = [];
							thirdCat = [];
							thirdCatInd = [];
							fourthCatInd = [];
						}
						//getArrays
						function getArrays(arrayAddress, field) {
							arrayAddress.forEach(function(task, index) {
								var taskKpiAddressCon = task[field];
								if (firstCat.indexOf(taskKpiAddressCon) == -1) {
									firstCat.push(taskKpiAddressCon);
								}
								//Second Array - second Category
								var taskPro = task.taskPro;
								var taskSubProTask = task.taskSubProTask;
								if (taskPro != '') {
									if (secondCat.indexOf(taskPro) == -1) {
										secondCat.push(taskPro);
									}
								} else {
									secondCatInd.push(taskSubProTask);
								}
								//Third Array - Third Category
								var taskSubPro = task.taskSubPro;
								if (taskSubPro != '') {
									if (thirdCat.indexOf(taskSubPro) == -1) {
										thirdCat.push(taskSubPro);
									}
									fourthCatInd.push(taskSubProTask);
								} else {
									thirdCatInd.push(taskSubProTask);
								}
							});
						}
						//getArraysPlan
						function getArraysPlan(arrayAddress, field) {
							arrayAddress.forEach(function(task, index) {
								var taskKpiAddressCon = task[field];
								if (firstCat.indexOf(taskKpiAddressCon) == -1) {
									firstCat.push(taskKpiAddressCon);
								}
								var taskSubPro = task.taskSubPro;
								var taskSubProTask = task.taskSubProTask;
								if (taskSubPro != '') {
									if (secondCat.indexOf(taskSubPro) == -1) {
										secondCat.push(taskSubPro);
									}
									thirdCat.push(taskSubProTask);
								} else {
									secondCatInd.push(taskSubProTask);
								}
								//--------------------------------------------
							});
						}
					},
					error: function(e) {
							console.log("Someting happend 1778! ", e);
						}
						//	},error: function (data){console.log(data);}
				});
			} // End Tree
//---GetTaskTree<



			if (WF_DEBUG)
				console.info("Window.dateformat", window.dateformat);

			window.CalendarInputFormat = "F j, Y";



//---StringNetsuiteDateToDate>
			window.StringNetsuiteDateToDate = function(s) {

					if (typeof s === 'string') {

					} else {
						return s;
					}

					if (WF_DEBUG)
						console.info('StringNetsuiteDateToDate ()',s,'NetSuite-Format',window.dateformat)
					// var monthName = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
					var months = window.datetime_short_months;
					var newDate = new Date(); // Default result...

					// console.info("Window.dateformat",window.dateformat)
					switch (window.dateformat) {
						case 'MM/DD/YYYY':
							var parts = s.split('/');
							newDate = new Date(parts[2], parts[0] - 1, parts[1], 0, 0, 0, 0);
							break;
						case 'MM.DD.YYYY':
							var parts = s.split('.');
							newDate = new Date(parts[2], parts[0] - 1, parts[1], 0, 0, 0, 0);
							break;
						case 'DD/MM/YYYY':
							var parts = s.split('/');
							newDate = new Date(parts[2], parts[1] - 1, parts[0], 0, 0, 0, 0);
							break;
						case 'DD.MM.YYYY':
							var parts = s.split('.');
							newDate = new Date(parts[2], parts[1] - 1, parts[0], 0, 0, 0, 0);
							break;
						case 'YYYY/MM/DD':
							var parts = s.split('/');
							newDate = new Date(parts[0], parts[1] - 1, parts[2], 0, 0, 0, 0);
							break;
						case 'YYYY-MM-DD':
							var parts = s.split('-');
							newDate = new Date(parts[0], parts[1] - 1, parts[2], 0, 0, 0, 0);
							break;
						case 'YYYY.MM.DD':
							var parts = s.split('.');
							newDate = new Date(parts[0], parts[1] - 1, parts[2], 0, 0, 0, 0);
							break;
						case 'DD.Mon.YYYY':
							var parts = s.split('.');
							newDate = new Date(parts[2], months.indexOf(parts[1]), parts[0], 0, 0, 0, 0);
							break;
						case 'DD-Mon-YYYY':
							var parts = s.split('-');
							newDate = new Date(parts[2], months.indexOf(parts[1]), parts[0], 0, 0, 0, 0);
							break;
						case 'DD-Month-YYYY':
							var parts = s.split('-');
							newDate = new Date(parts[2], months.indexOf(parts[1].substring(0, 3)), parts[0], 0, 0, 0, 0);
							break;
						case 'DD-MONTH-YYYY':
							var parts = s.split('-');
							newDate = new Date(parts[2], months.indexOf(parts[1].substring(0, 1).toUpperCase() + parts[1].substring(1, 3).toLowerCase()), parts[0], 0, 0, 0, 0);
							break;
						case 'DD,MONTH,YYYY':
							var parts = s.split(',');
							newDate = new Date(parts[2], months.indexOf(parts[1].substring(0, 1).toUpperCase() + parts[1].substring(1, 3).toLowerCase()), parts[0], 0, 0, 0, 0);
							break;
						case 'DD MONTH, YYYY':
							var parts = s.split(' ');
							newDate = new Date(parts[2], months.indexOf(parts[1].substring(0, 1).toUpperCase() + parts[1].substring(1, 3).toLowerCase()), parts[0], 0, 0, 0, 0);
							break;
					}
					return newDate;
				}
//---StringNetsuiteDateToDate<




//---YMDToDate>
			window.YMDToDate = function(s) {

				if (typeof s === 'string') {

				} else {
					return s;
				}
				// var monthName = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
				var months = window.datetime_short_months;
				// console.info("Window.dateformat",window.dateformat)
				switch (window.dateformat) {
					case 'MM/DD/YYYY':
						var parts = s.split('/');
						return newDate = new Date(parts[2], parts[0] - 1, parts[1]);
						break;
					case 'MM.DD.YYYY':
						var parts = s.split('.');
						return newDate = new Date(parts[2], parts[0] - 1, parts[1]);
						break;
					case 'DD/MM/YYYY':
						var parts = s.split('/');
						return newDate = new Date(parts[2], parts[1] - 1, parts[0]);
						break;
					case 'DD.MM.YYYY':
						var parts = s.split('.');
						return newDate = new Date(parts[2], parts[1] - 1, parts[0]);
						break;
					case 'YYYY/MM/DD':
						var parts = s.split('/');
						return newDate = new Date(parts[0], parts[1] - 1, parts[2]);
						break;
					case 'YYYY-MM-DD':
						var parts = s.split('-');
						return newDate = new Date(parts[0], parts[1] - 1, parts[2]);
						break;
					case 'YYYY.MM.DD':
						var parts = s.split('.');
						return newDate = new Date(parts[0], parts[1] - 1, parts[2]);
						break;
					case 'DD.Mon.YYYY':
						var parts = s.split('.');
						return newDate = new Date(parts[2], months.indexOf(parts[1]), parts[0]);
						break;
					case 'DD-Mon-YYYY':
						var parts = s.split('-');
						return newDate = new Date(parts[2], months.indexOf(parts[1]), parts[0]);
						break;
					case 'DD-Month-YYYY':
						var parts = s.split('-');
						return newDate = new Date(parts[2], months.indexOf(parts[1].substring(0, 3)), parts[0]);
						break;
					case 'DD-MONTH-YYYY':
						var parts = s.split('-');
						return newDate = new Date(parts[2], months.indexOf(parts[1].substring(0, 1).toUpperCase() + parts[1].substring(1, 3).toLowerCase()), parts[0]);
						break;
					case 'DD,MONTH,YYYY':
						var parts = s.split(',');
						return newDate = new Date(parts[2], months.indexOf(parts[1].substring(0, 1).toUpperCase() + parts[1].substring(1, 3).toLowerCase()), parts[0]);
						break;
					case 'DD MONTH, YYYY':
						var parts = s.split(' ');
						return newDate = new Date(parts[2], months.indexOf(parts[1].substring(0, 1).toUpperCase() + parts[1].substring(1, 3).toLowerCase()), parts[0]);
						break;
						//Format Date = (YYYY,MM,DD)
				}
			}
//---YMDToDate<




//---setCalendarFormatInput>
			function setCalendarFormatInput() {

				switch (window.dateformat) {
					case 'MM/DD/YYYY':
						CalendarInputFormat = "m/d/Y";
						break;
					case 'MM.DD.YYYY':
						CalendarInputFormat = "m.d.Y";
						break;
					case 'DD/MM/YYYY':
						CalendarInputFormat = "d/m/Y";
						break;
					case 'DD.MM.YYYY':
						CalendarInputFormat = "d/m/Y";
						break;
					case 'YYYY/MM/DD':
						CalendarInputFormat = "Y/m/d";
						break;
					case 'YYYY-MM-DD':
						CalendarInputFormat = "Y-m-d";
						break;
					case 'YYYY.MM.DD':
						CalendarInputFormat = "Y.m.d";
						break;
					case 'DD.Mon.YYYY':
						CalendarInputFormat = "d.M.Y";
						break;
					case 'DD-Mon-YYYY':
						CalendarInputFormat = "d-M-Y";
						break;
					case 'DD-Month-YYYY':
						CalendarInputFormat = "d-F-Y";
						break;
					case 'DD-MONTH-YYYY':
						CalendarInputFormat = "d-F-Y";
						break;
					case 'DD,MONTH,YYYY':
						CalendarInputFormat = "d,F,Y";
						break;
					case 'DD MONTH, YYYY':
						CalendarInputFormat = "d F, Y";
						break;
						//Format Date = (YYYY,MM,DD)
				}
			}
//---setCalendarFormatInput<




//---dateToStringNetsuite>
			function dateToStringNetsuite(datei) {
				if (WF_DEBUG)
					console.info("dateToStringNetsuite params:", datei);

				if (typeof datei == 'string') {

					return false;
				}
				var d = datei.getDate(),
					m = datei.getMonth(),
					y = datei.getFullYear();
				var delim = '/';
				var monthsName = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
				var months = window.datetime_short_months;
				var strdate = '';
				m1 = m;
				d1 = d;
				m = m + 1;
				d = (d <= 9 ? '0' + d : d);
				m = (m <= 9 ? '0' + m : m);

				switch (window.dateformat) {
					case 'MM/DD/YYYY':
					  delim = '/';
						strdate = '' + m + delim + d + delim + y;
						break;
					case 'MM.DD.YYYY':
						delim = '.';
						strdate = '' + m + delim + d + delim + y;
						break;
					case 'DD/MM/YYYY':
						delim = '/';
						strdate = '' + d + delim + m + delim + y;
						break;
					case 'DD.MM.YYYY':
						delim = '.';
						strdate = '' + d + delim + m + delim + y;
						break;
					case 'YYYY/MM/DD':
						delim = '/';
						strdate = '' + y + delim + m + delim + d;
						break;
					case 'YYYY-MM-DD':
						delim = '-';
						strdate = '' + y + delim + m + delim + d;
						break;
					case 'YYYY.MM.DD':
						delim = '.';
						strdate = '' + y + delim + m + delim + d;
						break;
					case 'DD.Mon.YYYY':
						delim = '.';
						strdate = '' + d + delim + months[m1] + delim + y;
						break;
					case 'DD-Mon-YYYY':
						delim = '-';
						strdate = '' + d + delim + months[m1] + delim + y;
						break;
					case 'DD-Month-YYYY':
						delim = '-';
						strdate = '' + d + delim + monthsName[m1] + delim + y;
						break;
					case 'DD-MONTH-YYYY':
						delim = '-';
						strdate = '' + d + delim + monthsName[m1].toUpperCase() + delim + y;
						break;
					case 'DD,MONTH,YYYY':
						delim = ',';
						strdate = '' + d + delim + monthsName[m1].toUpperCase() + delim + y;
						break;
					case 'DD MONTH, YYYY':
						delim = ' ';
						strdate = '' + d + delim + monthsName[m1].toUpperCase() + ',' + delim + y;
						break;
						//Format Date = (YYYY,MM,DD)
				}
				if (WF_DEBUG)
					console.info("dateToStringNetsuite return:", strdate);
				return strdate;
			}
//---dateToStringNetsuite<



			setCalendarFormatInput();



//---createArray>
			window.createArray = function createArray(objArrays, typeArr, WhichSalesOrder) {
					var tree = 'tree';
					//function sortDates

					//function convertDate
					function convertDate(fechas) {
						var arrayFechas = [];
						fechas.forEach(function(fecha, ind) {
							arrayFechas.push(StringNetsuiteDateToDate(fecha));
						});
						return arrayFechas;
					};
					//function formatDate
					function formatDate(date) {
						//	console.log(date);
						if (typeof date === 'string') {

							var d = new Date(StringNetsuiteDateToDate(date));
						} else {
							var d = new Date(date);
						}

						var month = '' + (d.getMonth()),
							day = '' + d.getDate(),
							year = d.getFullYear();
						//year = year.toString().substr(2,2);
						var monthName = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
						//if (month.length < 2) month = '0' + month;
						month = monthName[month];
						if (day.length < 2) day = '0' + day;
						return [day, month, year].join('-');
					}



					function sortDates(fechas, typesort) {
						var date_sort_asc = function(date1, date2) {
							if (date1 > date2) return 1;
							if (date1 < date2) return -1;
							return 0;
						};
						var date_sort_desc = function(date1, date2) {
							if (date1 > date2) return -1;
							if (date1 < date2) return 1;
							return 0;
						};
						//	console.info("fechas",fechas);
						if (typesort == 'desc') {
							rdt = convertDate(fechas).sort(date_sort_desc);
							// var rdt = fechas.sort(date_sort_desc);
							//
							// console.info("SortDates Dec ",rdt);
						} else {
							rdt = convertDate(fechas).sort(date_sort_asc);
							// var rdt = fechas.sort(date_sort_asc);
							//
							// console.info("SortDates ASC",rdt);

						}
						//console.info("rdt",rdt);
						return rdt;
					}


					//function changeDateformat
					function changeDateformat(date) {
						var fechas = [];
						fechas.push(date);
						var returnDate = sortDates(fechas, 'desc');
						var lastdate = formatDate(returnDate[0]);
						return lastdate;
					}
					//End Functions
					var firstCat = objArrays.firstCat;
					var secondCat = objArrays.secondCat;
					var secondCatInd = objArrays.secondCatInd;
					var thirdCat = objArrays.thirdCat;
					var thirdCatInd = objArrays.thirdCatInd;
					var fourthCatInd = objArrays.fourthCatInd;
					var resulFinal = [];
					var startValue = "";
					var endValue = "";
					var colorClass = "primary'";

					firstCat.forEach(function(taskDraw) {
						var arraySec = [];
						dateSecond = [];
						dateSecondStart = [];
						var obj = {};
						var textName = '';
						var sepPro = taskDraw.split('~');
						textName = (typeArr == 'A' || typeArr == 'P') ? sepPro[1] : (typeArr == 'I') ? searchitemlocation(WhichSalesOrder, sepPro[0]) : '';
						obj['id'] = sepPro[0];
						obj['text'] = textName;
						obj['open'] = 0;
						//Second----------------------------------------------------
						secondCat.forEach(function(secondCate) {
							//	console.info("secondCat",secondCate)
							var segunda = secondCate.split('~');
							var idAdd = segunda[0];
							var idPro = segunda[1];
							var idName = segunda[2];

							//console.log ('secondCate vale ' + secondCate);
							if (idAdd == sepPro[0]) {
								var obj2 = {};
								obj2['id'] = idAdd + '-' + idPro;
								obj2['text'] = idName;
								obj2['open'] = 0;
								//Third-------------------------------------------------------------------------------
								var arrayThird = [];
								dateThird = []; //reset arrays dates
								dateThirdStart = []; //reset arrays dates
								thirdCat.forEach(function(thirdCate) {
									//	console.info("thirdCat",thirdCate);
									var tercera = [];
									dateFourth = []; //reset arrays dates
									dateFourthStart = []; //reset arrays dates
									startValue = "";
									endValue = "";
									colorClass = "primary'";
									tercera = thirdCate.split('~');
									var idAddT = tercera[0];
									var idProT = tercera[1];
									var idSubproT = tercera[2];

									//console.log ('thirdCate 1 vale ' + thirdCate);
									if (typeArr == 'P') {
										var separete = tercera[3].split('|');
										var titleFirst = separete[0];
										var dateInformation = separete[1].split(delimiterdates);
										//var startDate 		= changeDateformat(dateInformation[0]); //call function changeDateformat
										//var dueDate 		= changeDateformat(dateInformation[1]); //call function changeDateformat
										var startDate = formatDate(dateInformation[0]); //call function changeDateformat
										var dueDate = formatDate(dateInformation[1]); //call function changeDateformat
										var cantDuration = dateInformation[2];
										var statusTask = dateInformation[3];
										//console.log ('statusTask es: ' + statusTask);
										var idDesTask = dateInformation[4];
										if (statusTask == 'Yes' || statusTask == 'YesCancel') {
											startValue = "<s>";
											endValue = "</s>";
											var cancelMode = (statusTask == 'YesCancel') ? " style='background-color:#cccccc'" : "";
											colorClass = "success'" + cancelMode;
										}
										//								else if( idDesTask == 'Yes' ){
										//									colorClass		= "danger unog'";
										//								}

										//console.log ('Tree Task View startDate es: ' + startDate);
										// console.log(separete);

										//	var RawStartDate = new Date(Number(separete[2])).getTime();
										//var RawDueDate = new Date(Number(separete[3])).getTime();
										var RawStartDate = new Date((dateInformation[0]));
										var RawDueDate = new Date((dateInformation[1]));

										var today = new Date().setHours(0, 0, 0, 0);
										//console.log ('today es ' + today);

										if (RawStartDate.getTime() <= today) {
											colorClass = "danger'";
										}

										if (statusTask <= 'Completed') {
											colorClass = "completed'";
										}

										if (statusTask == 'Yes' || statusTask == 'YesCancel') {
											startValue = "<s>";
											endValue = "</s>";
											var cancelMode = (statusTask == 'YesCancel') ? " style='background-color:#cccccc'" : "";
											colorClass = "success'" + cancelMode;
										}


										//***********************/
										dateThirdStart.push(dateInformation[0]);
										dateThird.push(dateInformation[1]);
										//***********************/

										// var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
										// var ConstructedStartDate = RawStartDate.getDate()+'-'+monthNames[RawStartDate.getMonth()]+'-'+RawStartDate.getFullYear();
										//
										// var ConstructedDueDate = RawDueDate.getDate()+'-'+monthNames[RawDueDate.getMonth()]+'-'+RawDueDate.getFullYear();


										var ConstructedStartDate = startDate;
										var ConstructedDueDate = dueDate;
										//console.log(ConstructedStartDate);
										// console.log("raw " + RawStartDate)
										// console.log("cons" + ConstructedStartDate);

										var idNameT = startValue + "<a onclick='showTask(" + idSubproT + ",\"tree\");''>" + titleFirst + "</a>&nbsp<span class='label label-" + colorClass + ">" + ConstructedStartDate + " - " + ConstructedDueDate +
											"</span>&nbsp<span class='label label-warning'>" + cantDuration + "</span>" + endValue;
									} else {
										var idNameT = tercera[3];
									}
									if ((idAddT + '-' + idProT) == (idAdd + '-' + idPro)) {
										var obj3 = {};
										obj3['id'] = idAddT + '-' + idProT + '-' + idSubproT;
										//console.log(idAddT+'-'+idProT+'-'+idSubproT);
										obj3['text'] = idNameT;
										obj3['open'] = 0;
										//fourth---------------------------------------------------------------------
										var arrayFourth = [];
										fourthCatInd.forEach(function(fourthCate) {
											var cuarta = fourthCate.split('~');
											var obj4 = {};
											var idAddC = cuarta[0];
											var idProC = cuarta[1];
											var idSubproC = cuarta[2];
											var idTask = cuarta[3];
											var idTasKName = cuarta[4];

											//console.log ('fourthCate vale ' + fourthCate);
											//console.log ('idTasKName vale ' + idTasKName);
											if ((idAddT + '-' + idProT + '-' + idSubproT) == (idAddC + '-' + idProC + '-' + idSubproC)) {
												startValue = "";
												endValue = "";
												colorClass = "primary'";
												var separete = idTasKName.split('|');
												var titleFirst = separete[0];
												var dateInformation = separete[1].split(delimiterdates);;
												//var startDate 		= changeDateformat(dateInformation[0]); //call function changeDateformat
												//var dueDate 		= changeDateformat(dateInformation[1]); //call function changeDateformat

												var startDate = formatDate(dateInformation[0]); //call function changeDateformat
												var dueDate = formatDate(dateInformation[1]); //call function changeDateformat
												var cantDuration = dateInformation[2];
												var statusTask = dateInformation[3];
												var idDesTask = dateInformation[4];


												//console.log ('Tree Task View startDate es: ' + startDate);

												var RawStartDate = new Date(Number(separete[2]));
												var RawDueDate = new Date(Number(separete[3]));

												var today = new Date().setHours(0, 0, 0, 0);
												//console.log ('today es ' + today);

												if (RawStartDate <= today) {
													colorClass = "danger'";
												}

												if (statusTask <= 'Completed') {
													colorClass = "completed'";
												}

												if (statusTask == 'Yes' || statusTask == 'YesCancel') {
													startValue = "<s>";
													endValue = "</s>";
													var cancelMode = (statusTask == 'YesCancel') ? " style='background-color:#cccccc'" : "";
													colorClass = "success'" + cancelMode;
												}

												//										else if( idDesTask == 'Yes' ){
												//											colorClass		= "danger cuatrog'";
												//										}

												//***********************/
												dateFourthStart.push(dateInformation[0]);
												dateFourth.push(dateInformation[1]);
												//***********************/

												// var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
												// var ConstructedStartDate = RawStartDate.getDate()+'-'+monthNames[RawStartDate.getMonth()]+'-'+RawStartDate.getFullYear();
												//
												// var ConstructedDueDate = RawDueDate.getDate()+'-'+monthNames[RawDueDate.getMonth()]+'-'+RawDueDate.getFullYear();


												var ConstructedStartDate = startDate;
												var ConstructedDueDate = dueDate;

												var callFunction = startValue + "<a onclick='showTask(" + idTask + ",\"tree\");''>" + titleFirst + "</a>&nbsp<span class='label label-" + colorClass + ">" + ConstructedStartDate + " - " + ConstructedDueDate +
													"</span>&nbsp<span class='label label-warning'>" + cantDuration + "</span>" + endValue;

												var obj4 = {};
												obj4['id'] = idAddC + '-' + idProC + '-' + idSubproC + '-' + idTask;
												obj4['text'] = callFunction;
												arrayFourth.push(obj4);
											}
										}); //end fourthCatInd
										//---------------------------------------------------------------------------
										var startDatetitle = "";
										var dueDatetitle = "";
										//	console.log(dateFourthStart);
										if (dateFourthStart.length > 0) {
											var lastDates = sortDates(dateFourthStart, 'asc');
											//console.log(" >>>> Format Date :"+formatDate(lastDates[0]));
											startDatetitle = "&nbsp<span class='label label-default' style='font-weight: 400;'>" + formatDate(lastDates[0]);
											//***********************/
											dateThirdStart.push(lastDates[0]);
											//***********************/
										}
										if (dateFourth.length > 0) {
											var lastDates = sortDates(dateFourth, 'desc');
											dueDatetitle = " - " + formatDate(lastDates[0]) + "</span>";
											//***********************/
											//	dateThird.push(lastDates[0].ddmmyyyy());
											dateThird.push(lastDates[0]);
											//***********************/
										} else {
											if (dateFourthStart.length > 0) {
												startDatetitle = startDatetitle + "</span>";
											}
										}
										if (typeArr != 'P') {
											obj3['text'] = idNameT + startDatetitle + dueDatetitle; //re-assign text in category
										}
										obj3['items'] = arrayFourth;
										arrayThird.push(obj3);
									}
								}); //end third
								//thirdundependence
								thirdCatInd.forEach(function(thirdCate) {
									//console.info("thirdCatInd",thirdCate);
									var tercera = thirdCate.split('~');
									var obj3 = {};
									var idAddT = tercera[0];
									var idProT = tercera[1];
									var idTask = tercera[2];
									var idTasKName = tercera[3];

									//console.log ('thirdCate 2 vale ' + thirdCate);
									//console.log ('idTasKName vale ' + idTasKName);
									//console.log ('Aqui startDate contiene ' + startDate);
									if ((idAddT + '-' + idProT) == (idAdd + '-' + idPro)) {
										startValue = "";
										endValue = "";
										colorClass = "primary'";
										var separete = idTasKName.split('|');
										var titleFirst = separete[0];
										var dateInformation = separete[1].split(delimiterdates);
										//var startDate 		= changeDateformat(dateInformation[0]); //call function changeDateformat

										//var dueDate 		= changeDateformat(dateInformation[1]); //call function changeDateformat

										var startDate = formatDate(dateInformation[0]); //call function changeDateformat

										var dueDate = formatDate(dateInformation[1]); //call function changeDateformat

										//var dueDateZ 		= formatDateZ(dateInformation[1]);
										//console.log ('dueDateZ: '+ dueDateZ);

										var statusTask = dateInformation[3];
										//console.log ('statusTask tiene ' + statusTask);
										var idDesTask = dateInformation[4];
										if (statusTask == 'Yes' || statusTask == 'YesCancel') {
											startValue = "<s>";
											endValue = "</s>";
											var cancelMode = (statusTask == 'YesCancel') ? " style='background-color:#cccccc'" : "";
											colorClass = "success'" + cancelMode;
										}
										//								else if( idDesTask == 'Yes' ){
										//									colorClass		= "danger dosg'";
										//								}

										//console.log ('Tree Task View startDate es: ' + startDate);

										var RawStartDate = new Date(Number(separete[2]));
										var RawDueDate = new Date(Number(separete[3]));

										var today = new Date().setHours(0, 0, 0, 0);
										//console.log ('today es ' + today);

										if (RawStartDate <= today) {
											colorClass = "danger'";
										}

										if (statusTask <= 'Completed') {
											colorClass = "completed'";
										}

										//***********************/
										dateThirdStart.push(dateInformation[0]);
										dateThird.push(dateInformation[1]);
										//***********************/

										// var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
										// var ConstructedStartDate = RawStartDate.getDate()+'-'+monthNames[RawStartDate.getMonth()]+'-'+RawStartDate.getFullYear();
										//
										// var ConstructedDueDate = RawDueDate.getDate()+'-'+monthNames[RawDueDate.getMonth()]+'-'+RawDueDate.getFullYear();

										//		console.info("dateThirdPush",dateThird);
										var ConstructedStartDate = startDate;
										var ConstructedDueDate = dueDate;
										//console.log(ConstructedStartDate);


										var cantDuration = dateInformation[2];
										var callFunction = startValue + "<a onclick='showTask(" + idTask + ",\"tree\");''>" + titleFirst + "</a>&nbsp<span style='font-weight:400;' class='label label-" + colorClass + ">" + ConstructedStartDate + " - " +
											ConstructedDueDate + "</span>&nbsp<span class='label label-warning'>" + cantDuration + "</span>" + endValue;
										var obj3 = {};
										obj3['id'] = idAddT + '-' + idProT + '-' + idTask;
										obj3['text'] = callFunction;
										//obj3['open'] 	= 0;
										arrayThird.push(obj3);
									}
								}); //end thirdundependence
								//------------------------
								var startDatetitle = "";
								var dueDatetitle = "";
								if (dateThirdStart.length > 0) {
									var lastDates = sortDates(dateThirdStart, 'asc');
									//console.log(" >>>> Format Date :"+formatDate(lastDates[0]));
									startDatetitle = "&nbsp<span class='label label-default' style='font-weight: 400;'>" + formatDate(lastDates[0]);
									//***********************/
									dateSecondStart.push(lastDates[0]);
									//***********************/
								}
								if (dateThird.length > 0) {
									var lastDates = sortDates(dateThird, 'desc');
									//	console.info("last",lastDates);
									dueDatetitle = " - " + formatDate(lastDates[0]) + " </span>";
									//***********************/
									dateSecond.push(lastDates[0]);
									//***********************/
								} else {
									if (dateThirdStart.length > 0) {
										startDatetitle = startDatetitle + " </span>";
									}
								}
								obj2['text'] = idName + startDatetitle + dueDatetitle;
								obj2['items'] = arrayThird;
								//End Third---------------------------------------------------------------------------
								arraySec.push(obj2);
							}
						});
						//secondundependence
						secondCatInd.forEach(function(secondCate) {
							var segunda = secondCate.split('~');
							var idAssignTask = "";

							//console.log ('secondCate vale ' + secondCate);
							if (typeArr == 'P') {
								var idAdd = segunda[0]
								var idTasKName = segunda[2];
								idAssignTask = idAdd + '-' + segunda[1];
							} else {
								var idAdd = segunda[0];
								var idPro = segunda[1]; //is empty
								var idTask = segunda[2];
								var idTasKName = segunda[3];
								idAssignTask = idAdd + '-' + idTask;
							}
							if (idAdd == sepPro[0]) {
								startValue = "";
								endValue = "";
								colorClass = "primary'";
								var idTaskFuction = idAssignTask.split('-');
								var separete = idTasKName.split('|');
								var titleFirst = separete[0];
								var dateInformation = separete[1].split(delimiterdates);
								//var startDate 		= changeDateformat(dateInformation[0]); //call function changeDateformat
								//var dueDate 		= changeDateformat(dateInformation[1]); //call function changeDateformat
								// console.log("Date");
								// console.log(dateInformation);
								var startDate = formatDate(dateInformation[0]); //call function changeDateformat
								var dueDate = formatDate(dateInformation[1]); //call function changeDateformat

								var cantDuration = dateInformation[2];
								var statusTask = dateInformation[3];
								var idDesTask = dateInformation[4];
								if (statusTask == 'Yes' || statusTask == 'YesCancel') {
									startValue = "<s>";
									endValue = "</s>";
									var cancelMode = (statusTask == 'YesCancel') ? " style='background-color:#cccccc'" : "";
									colorClass = "success'" + cancelMode;
								}
								//						else if( idDesTask == 'Yes' ){
								//							colorClass		= "danger tresg'";
								//						}

								//console.log ('Tree Task View startDate es: ' + startDate);

								var RawStartDate = new Date(Number(separete[2]));
								var RawDueDate = new Date(Number(separete[3]));

								var today = new Date().setHours(0, 0, 0, 0);
								//console.log ('today es ' + today);

								if (RawStartDate <= today) {
									colorClass = "danger'";
								}

								if (statusTask <= 'Completed') {
									colorClass = "completed'";
								}

								//***********************/
								dateSecondStart.push(dateInformation[0]);
								// dateSecondStart.push(startDate);
								dateSecond.push(dateInformation[1]);
								//	dateSecond.push(dueDate);
								//***********************/

								// var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
								// var ConstructedStartDate = RawStartDate.getDate()+'-'+monthNames[RawStartDate.getMonth()]+'-'+RawStartDate.getFullYear();
								//
								// var ConstructedDueDate = RawDueDate.getDate()+'-'+monthNames[RawDueDate.getMonth()]+'-'+RawDueDate.getFullYear();


								var ConstructedStartDate = startDate;
								var ConstructedDueDate = dueDate;
								//console.log(ConstructedStartDate);
								var callFunction = startValue + "<a onclick='showTask(" + idTaskFuction[1] + ",\"tree\");''>" + titleFirst + "</a>&nbsp<span class='label label-" + colorClass + ">" + ConstructedStartDate + " - " + ConstructedDueDate +
									"</span>&nbsp<span class='label label-warning'>" + cantDuration + "</span>" + endValue;
								var obj2 = {};
								obj2['id'] = idAssignTask;
								obj2['text'] = callFunction;
								arraySec.push(obj2);
							}
						}); //End secondCatInd--
						var startDatetitle = "";
						var dueDatetitle = "";

						// console.log("Second", dateSecond);

						if (dateSecondStart.length > 0) {
							var lastDates = sortDates(dateSecondStart, 'asc');
							//console.log(" >>>> Format Date :"+formatDate(lastDates[0]));
							startDatetitle = "&nbsp<span class='label label-default' style='font-weight: 400;'>" + formatDate(lastDates[0]);
						}
						if (dateSecond.length > 0) {
							var lastDates = sortDates(dateSecond, 'desc');
							// console.log(lastDates);
							dueDatetitle = " - " + formatDate(lastDates[0]) + "</span>";
						} else {
							if (dateSecondStart.length > 0) {
								startDatetitle = startDatetitle + "</span>";
							}
						}
						obj['text'] = textName + startDatetitle + dueDatetitle; //+ "&nbsp<span class='label label-danger'>fecha</span>";
						obj['items'] = arraySec;
						resulFinal.push(obj);
						JSON.stringify(resulFinal);
					});
					return resulFinal;
				} //end createArray
//---createArray<




//---searchitemlocation>
			window.searchitemlocation = function searchitemlocation(WhichSalesOrder, itemLine) {
					if (WF_DEBUG)
						console.info("searchitemlocation(WhichSalesOrder, itemLine)", WhichSalesOrder, itemLine);
					var sepID = itemLine.split('-');
					var textName = '';
					//Get Item Text ----------------------------------------------
					$.ajax({
						//  url: getUrl().RT2,
						url: getUrl().BSL,
						data: {
							'action': 'searchItemLocation',
							'WhichSalesOrder': WhichSalesOrder,
							'WhichItem': sepID[0].slice(1),
							'WhichLine': sepID[1]
						},
						async: false,
						// dataType: 'json',
						dataType: 'text',
						success: function(data) {
							data = CleanResponseData(data);
							if (data.item != '') {
								textName = data.item;
							} else {
								//textName 	= sepPro[1] + ' (' + sepID[1]+ ')';
								textName = sepID[0] + ' (' + sepID[1] + ')';
							}
						},
						error: function(err) {
							console.log('err', err);
						}
					});
					return textName;
				}
//---searchitemlocation<




//Call first serach PM --------------------------------------------------




//---showSecondTable>
			window.showSecondTable = function showSecondTable(empPM) {
					if (WF_DEBUG)
						console.info("showSecondTable(empPM)", empPM);
					// Second Div -------------------------------------------------------
					if (WF_DEBUG_AJAX)
						console.info("ajax action: getAllTaskbyDpto", getUrl().RT3);
					$.ajax({
						url: getUrl().RT3,
						data: {
							'action': 'getAllTaskbyDpto',
							'WhichProjMan': empPM
						},
						async: false,
						// dataType: 'json',
						dataType: 'text',
						success: function(data) {
							data = CleanResponseData(data);
							var emp = data.emp;
							var results = data.results;
							$('#allSecondPanel').hide();
							$('#secondPanel_all').show();
							$('#secondPanel').show();
							var row = '';
							var howTask = '<span class="label label-warning">(TASKS NOT FOUND)</span>';
							results.forEach(function(result, index) {
								if (index == 0) {
									$('#allSecondPanel').show();
									$('allSecondPanel').show();
									$('#secondDiv').show();
									$('#thirdDiv').show();
									$('#ulListdpto').show();
									$('#secondPanle').show();
								}
								var deptoId = result.deptoId;
								var deptoText = result.deptoText;
								var countTask = result.countTask;
								row += '<li class="list-group-item">';
								row += '<span class="badge" style="background-color: #5bc0de">' + countTask + '</span>';
								row += '<strong>' + deptoText + '</strong>';
								row += '</li>';
								howTask = '';
							});
							$("#ulListdpto li").remove();
							$("#secondPanel div").remove();
							$("#secondPanel").append('<div>' + emp + ' ' + howTask + '</div>');
							$("#ulListdpto").append(row);
						},
						error: function(err) {
							console.log('err', err);
						}
					});
					// Third Div -------------------------------------------------------
					if (WF_DEBUG_AJAX)
						console.info("ajax action: getAllTaskbySO", getUrl().RT3);
					$.ajax({
						url: getUrl().RT3,
						data: {
							'action': 'getAllTaskbySO',
							'WhichProjMan': empPM
						},
						async: false,
						// dataType: 'json',
						dataType: 'text',
						success: function(data) {
							data = CleanResponseData(data);
							var UniqueSO = data.UniqueSO;
							var results = data.results;
							var resulFinal = [];
							//console.log(UniqueSO);
							UniqueSO.forEach(function(taskSO, index) {
								var obj = {};
								var itemsresulFinal = [];
								var primera = taskSO.split('~');
								obj['id'] = 'SO-' + primera[0];
								var npos = primera[1].indexOf("#") + 1; //('#')
								var text = primera[1].slice(npos);
								obj['open'] = 0;
								var separateTask = results.filter(function(indTask) {
									return (indTask.SoId + "~" + indTask.SoIdText == taskSO);
								});
								//console.log(separateTask);
								separateTask.forEach(function(oneTask, indice) {
									var objSec = {};
									objSec['id'] = 'TK-' + oneTask.internalId;
									var titleTask = oneTask.title;
									var titlehead;
									if (titleTask.indexOf(" - ") !== -1) {
										titlehead = titleTask.substring(titleTask.indexOf(" - ") + 3);
									} else {
										titlehead = titleTask;
									}
									objSec['text'] = titlehead;
									objSec['open'] = 0;
									itemsresulFinal.push(objSec);
								});
								obj['text'] = text + ' <span class="label label-info">' + separateTask.length + '</span>';
								obj['items'] = itemsresulFinal;
								resulFinal.push(obj);
								//console.log(JSON.stringify(separateTask));
							});
							//console.log(resulFinal);
							var myTree;
							myTreeView = new dhtmlXTreeView({
								parent: "treeTasksMyTeam",
								items: resulFinal
							});
							$('#thirdDiv').show();
						},
						error: function(err) {
							console.log('err', err);
						}
					});
				} //End Call first serach PM --------------------------------------------------
//---showSecondTable<






//---showTask>
			window.showTask = function showTask(idTaskFuction, fromClick) {
					if (WF_DEBUG)
						console.info("showTask(idTaskFuction, fromClick)", idTaskFuction, fromClick);
					//console.log('WhichSalesOrder: ' + WhichSalesOrder);
					$('.preimageTasks').hide();
					//	console.log('Task ID in Tree: ' + idTaskFuction + " - " + fromClick);
					//-----------------------------------------------------------
					if (WF_DEBUG_AJAX)
						console.info("ajax action: GetTaskTree", getUrl().RT);
					$.ajax({
						url: getUrl().RT,
						data: {
							'action': 'GetTaskTree',
							'WhichTask': idTaskFuction
						},
						// dataType: 'json',
						dataType: 'text',
						success: function(data) {
							var results = CleanResponseData(data);
							//console.log(results[0]);
							var counter = 0,
								count;
							var DrawResults = results[0];
							var loggedUserID = $('input#custpage_userid').val();
							if (loggedUserID == '') {
								alert('Undetermined user, please login');
							} else {
								// We collect the user ID which is current in the active session
								loggedUserID = Math.round(loggedUserID);
								//  This variable will set the ID's
								counter++;
								count = "TreeTask" + counter;
								if (results[0]) {
									var taskID = DrawResults.internalid;
									var titleTask = DrawResults.taskTitle;
									var assigned = DrawResults.assigned;
									var assignedID = DrawResults.assignedID;
									var status = DrawResults.status;
									var statusID = DrawResults.statusID;
									var taskAck = DrawResults.taskAck;
									var taskStartDate = DrawResults.taskStartDate;
									var taskDueDate = DrawResults.taskDueDate;
									var IsWorkOnWeekend = DrawResults.IsWorkOnWeekend;
									var taskDuration = DrawResults.taskDuration;
									var taskCDependency = DrawResults.taskCDependency;
									var taskCPredecessor = DrawResults.taskCPredecessor;
									var WhichSalesOrder = DrawResults.taskSalesOrder;
									var treePosition = DrawResults.treePosition;
									var WrikeID = DrawResults.WrikeID;
									//console.log(DrawResults);
									//Show table
									$("table#tableTask").show();
									$('table#tableTask thead th').remove();
									$('table#tablePreSucc thead th').remove();
									var headRow = '';
									//	var titleForTask = 'Task Details';
									var listofStatusSelect = $('input#custpage_selectstatustask').val();
									// headRow += '<tr>';
									// headRow += '<th colspan="1" align="center" valign="left"><strong>' + titleTaks + '</strong></th><th><div align="right"><input onclick="" id="dicoTreeTask1" class="filterButton" style="display: none" align="right" type="button" value="Save"/></th></div>';
									// headRow += '</tr>';
									$("table#tableTask > thead").append(headRow);
									//WORKWEEKEND--------------------------------------------------------------
									var WorkWeekendDisplay;
									// We save the Work on Weekend state here
									var WorkWeekend = IsWorkOnWeekend;
									// If the employee works on Weekends then make the check input to be marked
									if (WorkWeekend) {
										WorkWeekendDisplay = "<input type='checkbox' onchange='changeWorkOnWeekends.call(this)' id='WorkOnWeekends_" + count + "' name='check' class='check' checked /><p style='font-size:0px;position:absolute;'>true</p>"
											// This will input something like: $("input[id='WorkOnWeekends_7']").attr('checked', true)
									} else {
										WorkWeekendDisplay = "<input type='checkbox' onchange='changeWorkOnWeekends.call(this)' id='WorkOnWeekends_" + count + "' name='check' class='check' /><p style='font-size:0px;position:absolute;'>false</p>"
									}
									//ACK----------------------------------------------------------------------
									var BoolAck;
									if (taskAck) {
										BoolAck = "<input type='checkbox' onchange='changeAck.call(this)' id='Ack_" + count + "' name='check' disabled class='check' checked />"
									} else {
										BoolAck = "<input type='checkbox' onchange='changeAck.call(this)' id='Ack_" + count + "' name='check' class='check' />"
									}
									//EMPLOYEE SELECT AND STATUS TASK------------------------------------------
									var vFilteredEmployeesList = lstEmployeeSelect.replace(assignedID, assignedID + ' selected');

									var vFilteredStatusList = listofStatusSelect;
									if (statusID) {
										console.log("statusid" + statusID + "is");
										vFilteredStatusList = vFilteredStatusList.replace(statusID, statusID + ' selected');
									}

									//	console.log(listofStatusSelect);
									var vFilteredStatusList = vFilteredStatusList.replace('selTaskStatus', 'selTaskStatus'); //selTaskStatus
									var vFilteredStatusList = vFilteredStatusList.replace('class="selectTaskStatus"', 'class="selectTaskStatus" title="You won\'t be able to update this task once the status changes to "completed/cancelled"');
									var vFilteredStatusList = vFilteredStatusList.replace('id="selTaskStatus"', 'id="selTaskStatus' + count + '"');
									var vFilteredStatusList = vFilteredStatusList.replace('</select>', '</select><p  class="kiko" style="font-size:0px;position:absolute;">' + status + '</p>');
									var dtaskStartDate = taskStartDate;
									var dtaskDueDate = taskDueDate;
									//DURATION -----------------------------------------------------------------
									var dtaskDuration = "<input id='idTask_Duration_" + count + "' onblur='blurDuration.call()' onkeyup='changeDuration.call(this)' data-dependency='" + taskCDependency + "' data-predecessor='" + taskCPredecessor +
										"' type='text' size='3' value=" + taskDuration + " data-wrikeid='" + WrikeID + "' data-salesorder='" + WhichSalesOrder + "'>";
									//UPDATE-ICON --------------------------------------------------------------
									var dtaskUpdateIcon = "<div onclick='clickdico.call(this)' id='dico" + count + "' class='GoUpdateDisabled'></div>";
									//console.log(statusID);
									//console.log("PM Tree: "+Pm);
									if (Pm == false) {
										if ((loggedUserID != assignedID) || (statusID == 2) || (statusID == 4)) {
											BoolAck = BoolAck.replace('input type', 'input disabled type');
											WorkWeekendDisplay = WorkWeekendDisplay.replace('input type', 'input disabled type');
											vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="+++" disabled id');
											vFilteredStatusList = vFilteredStatusList.replace('select name', 'select disabled name'); //selTaskStatus
											vFilteredStartDate = dtaskStartDate.replace('input type', 'input disabled type');
											vFilteredDueDate = dtaskDueDate.replace('input type', 'input disabled type');
											dtaskDuration = dtaskDuration.replace('input id', 'input disabled id');
											dtaskUpdateIcon = "<div onclick='clickdico(this)' id='dico" + count + "' class='GoUpdateDisabled'></div>";
										} else {
											vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="***" id');
											vFilteredStartDate = taskStartDate;
											vFilteredDueDate = taskDueDate;
										}
									} else {
										if ((statusID == 2) || (statusID == 4)) {
											BoolAck = BoolAck.replace('input type', 'input disabled type');
											WorkWeekendDisplay = WorkWeekendDisplay.replace('input type', 'input disabled type');
											vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="+++" disabled id');
											vFilteredStatusList = vFilteredStatusList.replace('select name', 'select disabled name'); //selTaskStatus
											vFilteredStartDate = dtaskStartDate.replace('input type', 'input disabled type');
											vFilteredDueDate = dtaskDueDate.replace('input type', 'input disabled type');
											dtaskDuration = dtaskDuration.replace('input id', 'input disabled id');
											dtaskUpdateIcon = "<div onclick='clickdico(this)' id='dico" + count + "' class='GoUpdateDisabled'></div>";
										} else {
											vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="***" id');
											vFilteredStartDate = taskStartDate;
											vFilteredDueDate = taskDueDate;
										}
									}
									//AVAILABLE DATE FIELDS------------------------------------------------------
									if (taskCDependency == "startToStart") { // Si la dependencia es startToStart, se desabilita el picker StartDate
										vFilteredStartDate = dtaskStartDate.replace('input type', 'input disabled type');
									} else if (taskCDependency == "startToFinish" || taskCDependency == "finishToFinish") {
										vFilteredDueDate = dtaskDueDate.replace('input type', 'input disabled type');
									}
									vFilteredEmployeesList = vFilteredEmployeesList.replace('selectAsignee', 'selectAsignee' + count);
									vFilteredEmployeesList = vFilteredEmployeesList.replace('selected >', 'selected>');
									var fTx = vFilteredEmployeesList.split("selected>").pop();
									//console.log('Antes: ' + fTx[0]);
									fTx = fTx.substring(0, fTx.indexOf('<'));
									//console.log('Despues: ' + fTx);
									vFilteredEmployeesList = vFilteredEmployeesList.replace('</label>', '</label><p style="font-size:0px;position:absolute;">' + fTx + '</p>');
									var row = '';

									$('table#tableTask tbody tr').remove();

									row += "<tr>" +
										"  <th width='10%'><strong>Task</strong></th>" +
										"  <th class='styleToId'><span id='vtaskID" + count + "' style='display:none'>" + taskID + "</span><label data-taskid='" + taskID + "' data-wrikeid='" + WrikeID + "' href='#' style='font-size:16px;' target='_blank'> " +
										titleTask + "</label><input onclick='' id='dicoTreeTask1' class='filterButton' style='display: none' align='right' type='button' value='Save'/></th>" +
										"</tr>" +
										"<tr>" +
										"  <td><strong>Assigned</strong></td>" +
										"  <td>" + vFilteredEmployeesList + "</td>" +
										"</tr>" +
										"<tr>" +
										"  <td><strong>ACK</strong></td>" +
										"  <td id='TaskAck_" + count + "'>" + BoolAck + "</td>" +
										"</tr>" +
										"<tr>" +
										"  <td><strong>Status</strong></td>" +
										"  <td id='TaskStatus_" + count + "'>" + vFilteredStatusList + "</td>" +
										"</tr>" +
										"<tr>" +
										"  <td><strong>Start Date</strong></td>" +
										"  <td>" + vFilteredStartDate + "</td>" +
										"</tr>" +
										"<tr>" +
										"  <td ><strong>Due Date</strong></td>" +
										"  <td>" + vFilteredDueDate + "</td>" +
										"</tr>" +
										"<tr>" +
										"  <td><strong>Work On Weekends</strong></td>" +
										"  <td>" + WorkWeekendDisplay + "</td>" +
										"</tr>" +
										"<tr>" +
										"  <td><strong>Duration</strong></td>" +
										"  <td><p style='font-size:0px;position:absolute;'>" + taskDuration + "</p>" + dtaskDuration + "</td>" +
										"</tr>";
									//-----------------------------------------------------
									row += '<tr>' +
										'<td colspan="2">' +
										'	<div class="row">' +
										'		<div class="col-sm-6 col-md-6">' +
										'			<div class="panel panel-primary">' +
										'				<div class="panel-heading">' +
										'					<h4 class="panel-title">Predecessor</h4>' +
										'				</div>' +
										'				<div class="panel-body" id="tdPredecessor">' +
										' 					' +
										'				</div>' +
										'			</div>' +
										'		</div>' +
										'			<div class="col-sm-6 col-md-6">' +
										'			<div class="panel panel-primary">' +
										'				<div class="panel-heading">' +
										'					<h4 class="panel-title">Successor</h4>' +
										'				</div>' +
										'				<div class="panel-body" id="tdSucessor">' +
										'				</div>' +
										'			</div>' +
										'		</div>' +
										'	</div>' +
										'</td>' +
										'</tr>';
									//-----------------------------------------------------
									row += "<tr>" +
										"	<td colspan='2'>" +
										'	<iframe height="600px" width="100%" frameBorder="0" and scrolling="no" id="wrike_comment_iframe" src="" style="display:none;"></iframe>';
									"		" +
									"	</td>" +
									"</tr>";
									//-----------------------------------------------------

									/* row += "<td colspan='2' valign='left' style='background-color: white'>";
									row += "<div style='background-color: white'>";
									row += '<ul style="margin-left: 0px !important;"  class="nav nav-tabs">';
									row += '<li class="active"><a href="#pre" data-toggle="tab"><strong>Predecessor</strong></a></li>';
									row += '<li><a href="#succ" data-toggle="tab"><strong>Successor</strong></a></li>';
									row += '</ul>';
									row += '<div class="tab-content">';
									 */

									/* 	row += '<div class="tab-pane active" id="pre">';
										row += '<div id="preWO">No Task to Show</div>';
										row += '<table id="tablePre" class="table" style="display: none">';
										row += '<thead>';
										row += '<tr>';
										row += '<th width="25%">Title</th>';
										row += '<th width="20%">Assigned</th>';
										row += '<th width="15%">Start Date</th>';
										row += '<th width="15%">Due Date</th>';
										row += '<th width="10%">Duration</th>';
										row += '<th width="15%">Status</th>';
										row += '</tr>';
										row += '</thead>';
										row += '<tbody>';
										row += '</tbody>';
										row += '</table>';
										row += '</div>'; */


									/* 	row += '<div class="tab-pane" id="succ">';
										row += '<div id="succWO">No Task to Show</div>';
										row += '<table id="tableSucc" class="table" style="display: none">';
										row += '<thead>';
										row += '<tr>';
										row += '<th width="25%">Title</th>';
										row += '<th width="20%">Assigned</th>';
										row += '<th width="15%">Start Date</th>';
										row += '<th width="15%">Due Date</th>';
										row += '<th width="10%">Duration</th>';
										row += '<th width="15%">Status</th>';
										row += '</tr>';
										row += '</thead>';
										row += '<tbody>';
										row += '</tbody>';
										row += '</table>';
										row += '</div>'; */


									/* row += '</div>';
									row += '</div>';
									row += "</td>"; */

									//-----------------------------------------------------
									/*
									row += "<tr>";
									row += "<td><strong>Save</strong></td>";
									row += "<td>"+dtaskUpdateIcon+"</td>";
									row += "</tr>";
									*/
									//console.log(row);
									$("table#tableTask > tbody").append(row);
									showPress(taskID, 'customrecord_task_predecessor', 'custrecord_tp_parent', 'custrecord_tp_predecessor', "treePredecessor");
									showSucc(taskID, 'customrecord_task_successor', 'custrecord_ts_parent', 'custrecord_ts_successor', 'treeSuccessor');

									openWrikeComment(WrikeID, taskID, true);

									///5 showTaskDatePick
									flatpickr('.showTaskDatePick', {
										dateFormat: CalendarInputFormat
									}); // initialized picker


									if (fromClick == 'table') {
										//Select Item
										//Colapse all Tree Categories
										Global_collapseFirst.forEach(function(firstCat, index) {
											firstCat.forEach(function(valCat, index) {
												Global_myTreeViewTask.closeItem(valCat.split('~')[0]);
											});
										}); //End Colapse all Tree
										setTimeout(function() {

											//Open Nodes
											var type = treePosition.substring(0, 1);
											var countNode = [];
											switch (treePosition.substring(0, 1)) {
												case 'A':
													countNode = treePosition.split('-');
													var concaNode = [];
													countNode.forEach(function(node, index) {
														if (index != countNode.length - 1) {
															concaNode.push(node);
															Global_myTreeViewTask.openItem([concaNode.join('-')]);
														}
													});
													Global_myTreeViewTask.selectItem(treePosition);
													//Global_myTreeViewTask.focusItem(treePosition);
													break;
												case 'I':
													countNode = treePosition.split('-');

													var concaNode = [];
													countNode.forEach(function(node, index) {
														if (index != countNode.length - 1) {
															concaNode.push(node);
															// if (index != 0) {
															if (WF_DEBUG)
																console.info('Global_myTreeViewTask', Global_myTreeViewTask);
															Global_myTreeViewTask.openItem([concaNode.join('-')]);
															// }
														}
													});
													Global_myTreeViewTask.selectItem(treePosition);
													//Global_myTreeViewTask.focusItem(treePosition);
													break;
												case 'P':
													countNode = treePosition.split('-');
													var concaNode = [];
													countNode.forEach(function(node, index) {
														if (index != countNode.length - 1) {
															concaNode.push(node);
															Global_myTreeViewTask.openItem([concaNode.join('-')]);
														}
													});
													Global_myTreeViewTask.selectItem(treePosition);
													//Global_myTreeViewTask.focusItem(treePosition);
													break;
												default:
													if (WF_DEBUG)
														console.log('Nothing count Node');
													break;
											}
											//End Open Nodes
										}, 200);
									}
								};
							};
						},
						error: function(err) {
							console.log('err', err);
						}
					});
					//-----------------------------------------------------------
				}
//---showTask<




// Show Predecesor and Sucessor functions
//---showPress>
			window.showPress = function showPress(idTask, IDType, IdParent, IdField, parent, fromUpdate) {
					if (WF_DEBUG)
						console.info("showPress(idTask, IDType, IdParent, IdField, parent, fromUpdate)", idTask, IDType, IdParent, IdField, parent, fromUpdate);

					if (WF_DEBUG_AJAX)
						console.info("ajax action: showPress", getUrl().RT2);

					$.ajax({
						url: getUrl().RT2,
						data: {
							'action': 'showPress',
							'WhichTask': idTask,
							'IDType': IDType,
							'IdParent': IdParent,
							'IdField': IdField
						},
						async: false,
						// dataType: 'json',
						dataType: 'text',
						beforeSend: function(data) {
							if (fromUpdate) {
								$('#tdPredecessor').children().remove();
							}
						},
						success: function(data) {
							var results = CleanResponseData(data);
							//	$('#tdPredecessor').children().remove();
							var resulFinalPress = [];
							var resultChild = [];
							var obj = {};
							var rowpre = '';
							results.forEach(function(press, index) {
								$('#preWO').hide();
								console.log("Press");
								console.log(press);
								rowpre = '';
								/* $("table#tablePre").show();
								rowpre = '';
								rowpre += "<tr>";
								//rowpre += "<td width='25%'><a href='/app/common/custom/custrecordentry.nl?rectype=644&id="+ press.internalid + "&' target='_blank'> " + press.title + "</a></td>";
								rowpre += "<td width='25%'><a onclick='showTask("+ press.idTask +",\"table\");''>" + press.title + "</a></td>";
								rowpre += "<td width='20%'>"+ press.assigned + "</td>";
								rowpre += "<td width='15%'>"+ press.startdate +"</td>";
								rowpre += "<td width='15%'>"+ press.duedate +"</td>";
								rowpre += "<td width='10%'>"+ press.duration +"</td>";
								rowpre += "<td width='15%'>"+ press.status +"</td>";
								rowpre += "</tr>";
								$("table#tablePre > tbody").append(rowpre); */

								rowpre += " " +
									"<a onclick='showTask(" + press.idTask + ",\"table\");''>" + press.title + "</a>" +
									"<br>" +
									"<div>" +
									"	<div style='float: left'>" +
									"		<p>" + (press.startdate) + " - " + (press.duedate) + "</p>" +
									"		<p>" + press.assigned + "</p>" +
									"	</div>" +
									"	<div style='float: right'>" +
									"		<p align='rigth'>" + press.duration + " day(s) </p>" +
									"		<p align='rigth'>" + press.status + " </p>" +
									"	</div >" +
									"</div>";

								/* rowpre += "<br>";
								rowpre += "<div>";
								rowpre += "	<div style='float: left'>";
								rowpre += "		<p>"+press.assigned +"</p>";
								rowpre += "	</div>";
								rowpre += "	<div style='float: right'>";
								rowpre += "		<p align='rigth'>"+press.status+" </p>";
								rowpre += "	</div >";
								rowpre += "</div>";
								 */
								$("#tdPredecessor").append(rowpre);
							});
						},
						error: function(err) {
							console.log('err', err);
						}
					});
				} // End Succ-Press
//---showPress<




//---showSucc>
			window.showSucc = function showSucc(idTask, IDType, IdParent, IdField, parent, fromUpdate) {
					if (WF_DEBUG)
						console.info("showSucc(idTask, IDType, IdParent, IdField, parent, fromUpdate)", idTask, IDType, IdParent, IdField, parent, fromUpdate);

					var table = 'table';

					if (WF_DEBUG_AJAX)
						console.info("ajax action: showPress", getUrl().RT2);

					$.ajax({
						url: getUrl().RT2,
						data: {
							'action': 'showSucc',
							'WhichTask': idTask,
							'IDType': IDType,
							'IdParent': IdParent,
							'IdField': IdField
						},
						async: false,
						// dataType: 'json',
						dataType: 'text',
						beforeSend: function(data) {
							if (fromUpdate) {
								$('#tdSucessor').children().remove();
							}

						},
						success: function(data) {
							var results = CleanResponseData(data);
							var resulFinalPress = [];
							var resultChild = [];
							var obj = {};
							var rowpre = '';
							results.forEach(function(press, index) {
								//	$('#tdSucessor').children().delayed();
								//	$('#tdSucessor').children().remove();
								rowpre = '';
								$("#succWO").hide();
								//$("table#tableSucc").show();
								//rowpre += "<tr>";
								//rowpre += "<td width='25%'><a href='/app/common/custom/custrecordentry.nl?rectype=643&id="+ press.internalid + "&' target='_blank'> " + press.title + "</a></td>";
								/* rowpre += "<td width='25%'><a onclick='showTask("+ press.idTask +",\"table\");''>" + press.title + "</a></td>";
								rowpre += "<td width='20%'>"+ press.assigned + "</td>";
								rowpre += "<td width='15%'>"+ press.startdate +"</td>";
								rowpre += "<td width='15%'>"+ press.duedate +"</td>";
								rowpre += "<td width='10%'>"+ press.duration +"</td>";
								rowpre += "<td width='15%'>"+ press.status +"</td>";
								rowpre += "</tr>";
								$("table#tableSucc > tbody").append(rowpre); */

								rowpre += "" +
									"<a onclick='showTask(" + press.idTask + ",\"table\");''>" + press.title + "</a>" +
									"<br>" +
									"<div>" +
									"	<div style='float: left'>" +
									"		<p>" + (press.startdate) + " - " + (press.duedate) + "</p>" +
									"		<p>" + press.assigned + "</p>" +
									"	</div>" +
									"	<div style='float: right'>" +
									"		<p align='rigth'>" + press.duration + " day(s) </p>" +
									"		<p align='rigth'>" + press.status + " </p>" +
									"	</div >" +
									"</div>";

								/* rowpre += "<br>";
								rowpre += "<div>";
								rowpre += "	<div style='float: left'>";
								rowpre += "		<p>"+press.assigned +"</p>";
								rowpre += "	</div>";
								rowpre += "	<div style='float: right'>";
								rowpre += "		<p align='rigth'>"+press.status+" </p>";
								rowpre += "	</div >";
								rowpre += "</div>";
								 */
								$("#tdSucessor").append(rowpre);
							});
						},
						error: function(err) {
							console.log('err', err);
						}
					});
				} //End showSucc ---------------------------------------------------------
//---showSucc<




// End of pre and suce functions
// Task Tree End
// Function to get AllServices




//---ChangeTableAllServices>
			function ChangeTableAllServices(WhichSalesOrder) {
				if (WF_DEBUG)
					console.info("ChangeTableAllServices(WhichSalesOrder)", WhichSalesOrder);

				if (WF_DEBUG_AJAX)
					console.info("ajax action: getAllServices", getUrl().BSL);

				//console.log('WhichSalesOrder is now: ' + WhichSalesOrder);
				//headers = new Array();
				//headers["Content-Type"]="application/json";
				$.ajax({
					//url: 'https://rest.sandbox.netsuite.com/app/site/hosting/restlet.nl?script=1386&deploy=1'
					//url: '/app/site/hosting/restlet.nl?script=1386&deploy=1'
					url: getUrl().BSL,
					data: {
						'action': 'getAllServices',
						'SO': WhichSalesOrder
					}
					//,
					// beforeSend: function (xhr){
					//       xhr.setRequestHeader('Authorization', 'NLAuth nlauth_email="ibo2@transtelco.net", nlauth_signature="TTCO-ibo2013", nlauth_account="3461650", nlauth_role="3"');
					//   }
					// headers : {"Authorization" : 'NLAuth nlauth_email="alejandro@solutionseekers.xyz", nlauth_signature="Ordnajela14", nlauth_account="3461650", nlauth_role="18"'}


					// headers : {"Authorization" : 'NLAuth nlauth_email="ibo2@transtelco.net", nlauth_signature="TTCO-ibo2013", nlauth_account="3461650", nlauth_role="3"'}
					,
					async: false,
					// dataType: 'json',
					dataType: 'text',
					success: function(data) {
						var toSelect = '<option value=""> Select Services </option>';
						data = CleanResponseData(data);
						var row = '';
						var count = 0;
						//console.log('Data stream All Services: ' + data[0]);
						data.forEach(function(d) {
							toSelect += "<option value='" + d.line + "_" + d.itemid + "' >" + d.line + " - " + d.itemName + " </option>"
							row += "<tr data-line='" + d.line +
								"' data-item='" + d.itemid +
								"' data-toshow='" + d.line + "_" + d.itemid + "'>" +
								// "<td align='justify'><input type='checkbox' onchange='SetFilterToTasks.call(this)'/></td>" +
								"<td class='styleToId' style='vertical-align: middle;'>" + d.itemName + "</td>" +
								"<td align='center'>" + d.capacity + "</td>" + "<td align='center'>" + d.UoM + "</td>" +
								"<td>" + d.LocationA + "</td>" +
								"<td>" + d.AddressA + "</td>" +
								"<td>" + d.LocationZ + "</td>" +
								"<td>" + d.AddressZ + "</td>" +
								"<td>" + d.EstimatedDate + "</td>" +
								"<td>" + d.subscription + "</td>" +
								"</tr>";
							//console.log( d);
						});
						$("table#myUpdatedSA").find('tr:not(:first)').each(function() {
							$(this).remove();
						});
						$("table#myUpdatedSA > tbody").append(row);

						$("#selServices").children().remove();
						$("#selServices").append(toSelect);

					},
					error: function(err) {
						console.log('err', err);
					}
				});
			}
//---ChangeTableAllServices<




//---pageTasks>
			function pageTasks(thefunction) {
				//	var tamSlice = 20;

				var slice = parseInt($('#ButtonLoadMoreTasks').attr("data-slice"));

				var lastFunction = parseInt($('#ButtonLoadMoreTasks').attr("data-function"));

				var moreslice = slice + 1;
				//
				// if(moreOrAll == "all"){
				//
				// $("table#mytblTasks > tbody > tr ").remove();
				// 	slice = 0;
				// 	moreslice = 8000;
				//
				// }else if(!moreOrAll){
				// 	moreslice = parseInt(slice)+tamSlice;
				// }
				// else
				// {
				// 	$("table#mytblTasks > tbody > tr ").remove();
				// 	slice = 0;
				// }

				if (lastFunction != thefunction) {
					$('#ButtonLoadMoreTasks').attr("data-slice", -1);
					moreslice = 0;
				} else {
					$('#ButtonLoadMoreTasks').attr("data-slice", moreslice);
				}

				$('#ButtonLoadMoreTasks').attr("data-function", thefunction);

				return moreslice;

			}
//---pageTasks<





//---ResetFiltersCheckbox>
			function ResetFiltersCheckbox() {
				$(".myUpdatedSA").find('input[type=checkbox]').each(function() {
					$(this).prop('checked', false);
				});
				$(".myUpdatedServicesAddresses").find('input[type=checkbox]').each(function() {
					$(this).prop('checked', false);
				});
			}
//---ResetFiltersCheckbox<


//---ChangeTableTasks>
			function ChangeTableTasks(WhichSalesOrder, Pm, fromReload) {
				if (WF_DEBUG)
					console.info("ChangeTableTasks(WhichSalesOrder, Pm, fromReload)", WhichSalesOrder, Pm, fromReload);

				//$('table#mytblTasks tbody tr').remove();
				ResetFiltersCheckbox();
				//1111111
				$('.filtersBar').slideDown("7000");
				$('.div-selectassigned').css("display", "inline-block");
				$('.div-selectdepartment').css("display", "inline-block");
				$('.div-selecttaskstatus').css("display", "inline-block");
				$('.div-selectStartDate').css("display", "inline-block");
				$('.div-selectDueDate').css("display", "inline-block");
				$('.div-selectWoW').css("display", "inline-block");
				$('.div-selectDuration').css("display", "inline-block");
				//$('#filterStartDate').prop("disabled", true);
				//$('#filterDueDate').prop("disabled", true);
				$('#filterStartDate').val('');
				$('#filterDueDate').val('');

				//--Ariel buscando el selecyt dentro de aqui ... $('.div-selectassigned').css({'font-weight':'normal','height':'32px'});

				var currentSlice = pageTasks(1);
				var count = 0;

				if (WF_DEBUG_AJAX)
					console.info("ajax action: getTasksTable", getUrl().RT);

				$.ajax({
					"info": true,
					//url: '/app/site/hosting/restlet.nl?script=1386&deploy=1'
					url: getUrl().RT,
					data: {
						'action': 'getTasksTable',
						'WhichSalesOrder': WhichSalesOrder,
						'pm': Pm,
						'selectPage': currentSlice,
					},
					// dataType: 'json',
					dataType: 'text',
					async: true,
					beforeSend: function(data) {
						$('#mytblTasks').DataTable().destroy();
						//	if (fromReload) {
						$('#mytblTasks > tbody > tr').remove();
						//	}
					},
					complete: function(data) {

						// data = CleanResponseData(data);
						if (WF_DEBUG)
							console.info('datacomplete', data);
						setTimeout(function() {
							if ($.fn.dataTable.isDataTable('#mytblTasks')) {
								$('#mytblTasks').DataTable().destroy();
							}
							// else {
							table = $('#mytblTasks').DataTable({
								"scrollY": "600px",
								"scrollCollapse": true,
								"bInfo": false,
								"paging": false,
								"info": true,
								"info": true,
								"deferRender": true,
								// "order": [
								// 	[4, "asc"]
								// ]
							});
							//}
							$('input[type="search"]').attr("placeholder", " SO/Task/Date/Text");
							$('input[type="search"]').css('height', '50%');
							$('input[type="search"]').css('display', 'inline-block');
							$('.select2-search__field').attr("placeholder", " Filter by status of the Sales Orders by clicking on this field");

							if ($('.tabsalesorder-content img#mymicrophone').length < 1) {
								$('span.select2.select2-container.select2-container--default').after(
									'  <img id="mymicrophone" style="width:14px;height: 50%;" onclick="startDictation(\'salesorder\')" src="https://system.sandbox.netsuite.com/core/media/media.nl?id=6526112&c=3461650&h=270cf9836f9974d10a59">');
							}

							if ($('.tabsalesorder-content img#mymicrophone').length < 2) {

								//$('.tabsalesorder-content input[type="search"]').after('  <img id="mymicrophone" style="width:14px;height: 50%;" onclick="startDictation(\'salesorder\')" src="https://system.sandbox.netsuite.com/core/media/media.nl?id=6526112&c=3461650&h=270cf9836f9974d10a59">');
								$('#tableSOcount_filter input[type="search"]').after(
									'  <img id="mymicrophone" style="width:14px;height: 50%;" onclick="startDictation(\'salesorder\')" src="https://system.sandbox.netsuite.com/core/media/media.nl?id=6526112&c=3461650&h=270cf9836f9974d10a59">');

								$('#salesorder_filter input[type="search"]').after(
									'  <img id="mymicrophone" style="width:14px;height: 50%;" onclick="startDictation(\'salesorder\')" src="https://system.sandbox.netsuite.com/core/media/media.nl?id=6526112&c=3461650&h=270cf9836f9974d10a59">');
							}
							if ($('#mytblTasks_wrapper img#mymicrophone').length < 1) {
								$('#mytblTasks_wrapper input[type="search"]').after(
									'  <img id="mymicrophone" style="width:14px;height: 50%;" onclick="startDictation(\'mytblTasks\')" src="https://system.sandbox.netsuite.com/core/media/media.nl?id=6526112&c=3461650&h=270cf9836f9974d10a59">');
							}
							if ($('#Customsalesorder_wrapper img#mymicrophone').length < 1) {
								$('#Customsalesorder_wrapper input[type="search"]').after(
									'  <img id="mymicrophone" style="width:14px;height: 50%;" onclick="startDictation(\'Customsalesorder\')" src="https://system.sandbox.netsuite.com/core/media/media.nl?id=6526112&c=3461650&h=270cf9836f9974d10a59">');
							}
							webshims.setOptions('forms-ext', {
								types: 'date'
							});
							webshims.polyfill('forms forms-ext');
							$.webshims.formcfg = {
								en: {
									dFormat: '/',
									dateSigns: '/',
									patterns: {
										d: "mm/dd/yy"
									}
								}
							};
							webshims.activeLang('en');
							// Colouring in red the first task that is the earliest
							//$("#mytblTasks tr:nth-child(1) td").css('background-color','#FF8086');
						}, 1000);

						//--$(".loader").hide('fast');
						$('table#mytblTasks').css("display", "block");
						// console.log(data);
						// window.arrayalex = data;
						// window.alex = data.responseJSON;

					},
					success: function(data) {
						data = CleanResponseData(data);
						if (WF_DEBUG)
							console.log('success data:', data);
						//	window.arrayalex = data;
						var row;
						count = 0;


						data[1].forEach(function(d) {
							GlobalStartDate = d.GlobalStartDate;
							GlobarDueDate = d.GlobalDueDate;

							// We get the logged user ID
							var loggedUserID = Math.round($('input#custpage_userid').val());

							//  This variable will set the suffix for the iterative row on course.
							count++;
							WorkWeekend = d.taskWorkWeekend; // Assigment of Work on Weekend status for current task
							var WorkWeekendDisplay;
							// We save the Work on Weekend state here
							var WorkWeekend = d.taskWorkWeekend;
							// If the employee works on Weekends then make the check input to be marked
							if (WorkWeekend) {
								WorkWeekendDisplay = "<input type='checkbox' onchange='changeWorkOnWeekends.call(this)' id='WorkOnWeekends_" + count + "' name='check' class='check' checked /><p style='font-size:0px;position:absolute;'>true</p>"
									// This will input something like: $("input[id='WorkOnWeekends_7']").attr('checked', true)
							} else {
								WorkWeekendDisplay = "<input type='checkbox' onchange='changeWorkOnWeekends.call(this)' id='WorkOnWeekends_" + count + "' name='check' class='check' /><p style='font-size:0px;position:absolute;'>false</p>"
							}
							var BoolAck;
							if (d.taskAck) {
								BoolAck = "<input type='checkbox' onchange='changeAck.call(this)' id='Ack_" + count + "' name='check' disabled class='check' checked />"
							} else {
								BoolAck = "<input type='checkbox' onchange='changeAck.call(this)' id='Ack_" + count + "' name='check' class='check' />"
							}
							var vFilteredEmployeesList = lstEmployeeSelect.replace(d.taskAssignedID, d.taskAssignedID + ' selected');

							var vFilteredStatusList = lstStatusSelect;
							if (d.taskStatus) {
								vFilteredStatusList = lstStatusSelect.replace(d.taskStatus, d.taskStatus + " selected");
							}

							var vFilteredStatusList = vFilteredStatusList.replace('class="selectTaskStatus"', 'class="selectTaskStatus" title="You won\'t be able to update this task once the status changes to "completed/cancelled"');
							var vFilteredStatusList = vFilteredStatusList.replace('id="selTaskStatus"', 'id="selTaskStatus' + count + '"');
							var StatusTareaTexto = '';
							var StatusTaskLabel = ['', 'Active', 'Completed', 'Deferred', 'Cancelled'];
							StatusTareaTexto = StatusTaskLabel[d.taskStatus];

							var vFilteredStatusList = vFilteredStatusList.replace('</select>', '</select><p  class="kiko" style="font-size:0px;position:absolute;">' + StatusTareaTexto + '</p>');
							//console.log("Status "+count + " : "+d.taskStatus)
							// Impersoned Logged user
							//loggedUserID = 21562;
							// Disable Start Date and Due Date if user ID don't match for the current row
							dtaskStartDate = d.taskStartDate;
							dtaskDueDate = d.taskDueDate;
							dtaskDuration = "<input id='idTask_Duration_" + count + "' onblur='blurDuration.call()' onkeyup='changeDuration.call(this)' data-dependency='" + d.taskDependency + "' data-predecessor='" + d.taskPredecessor +
								"' type='text' size='3' value=" + d.taskDuration + " data-wrikeid='" + d.WrikeID + "' data-salesorder='" + WhichSalesOrder + "'>";
							//dtaskUpdateIcon = "<div id='dico" + count + "' class='GoUpdateDisabled'></div>";
							dtaskUpdateIcon = "<div onclick='clickdico.call(this)' id='dico" + count + "' class='GoUpdateDisabled'></div>";
							//console.log('count = ' + count + ' loggedUserID = ' + loggedUserID + ' d.taskAssignedID = ' +  d.taskAssignedID);
							//console.log('dtaskStarte: ' + dtaskStartDate);
							//console.log("PM : "+Pm);
							if (Pm == false) {
								if ((loggedUserID != d.taskAssignedID) || (d.taskStatus == 2) || (d.taskStatus == 4)) {
									//console.log(vFilteredEmployeesList);
									// Disable Asigned field if user ID don't match for the current row
									vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="+++" disabled id');
									vFilteredStartDate = dtaskStartDate.replace('input type', 'input disabled type');
									vFilteredDueDate = dtaskDueDate.replace('input type', 'input disabled type');
									WorkWeekendDisplay = WorkWeekendDisplay.replace('input type', 'input disabled type');
									BoolAck = BoolAck.replace('input type', 'input disabled type');
									vFilteredStatusList = vFilteredStatusList.replace('select name', 'select disabled name'); //selTaskStatus
									dtaskDuration = dtaskDuration.replace('input id', 'input disabled id');
									dtaskUpdateIcon = "<div onclick='clickdico(this)' id='dico" + count + "' class='GoUpdateDisabled'></div>";
									//dtaskUpdateIcon = "<div id='dico" + count + "' ><button onclick='clickdico()'>Go</button></div>";
								} else {
									vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="***" id');
									vFilteredStartDate = d.taskStartDate;
									vFilteredDueDate = d.taskDueDate;
								}
							} else {
								if ((d.taskStatus == 2) || (d.taskStatus == 4)) {
									//console.log(vFilteredEmployeesList);
									// Disable Asigned field if user ID don't match for the current row
									vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="+++" disabled id');
									vFilteredStartDate = dtaskStartDate.replace('input type', 'input disabled type');
									vFilteredDueDate = dtaskDueDate.replace('input type', 'input disabled type');
									WorkWeekendDisplay = WorkWeekendDisplay.replace('input type', 'input disabled type');
									BoolAck = BoolAck.replace('input type', 'input disabled type');
									vFilteredStatusList = vFilteredStatusList.replace('select name', 'select disabled name'); //selTaskStatus
									dtaskDuration = dtaskDuration.replace('input id', 'input disabled id');
									dtaskUpdateIcon = "<div onclick='clickdico(this)' id='dico" + count + "' class='GoUpdateDisabled'></div>";
									//dtaskUpdateIcon = "<div id='dico" + count + "' ><button onclick='clickdico()'>Go</button></div>";
								} else {
									vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="***" id');
									vFilteredStartDate = d.taskStartDate;
									vFilteredDueDate = d.taskDueDate;
								}
							}

							if (d.taskDependency == "startToStart") { // Si la dependencia es startToStart, se desabilita el picker StartDate
								vFilteredStartDate = dtaskStartDate.replace('input type', 'input disabled type');
							} else if (d.taskDependency == "startToFinish" || d.taskDependency == "finishToFinish") {
								vFilteredDueDate = dtaskDueDate.replace('input type', 'input disabled type');
							}
							vFilteredEmployeesList = vFilteredEmployeesList.replace('selectAsignee', 'selectAsignee' + count);
							vFilteredEmployeesList = vFilteredEmployeesList.replace('selected >', 'selected>');
							var fTx = vFilteredEmployeesList.split("selected>").pop();
							fTx = fTx.substring(0, fTx.indexOf('<'));

							flagColorRedRow = getColorTaskValidate(d.setColortoRedOutDated, d.yellow, d.taskStatus)


							vFilteredEmployeesList = vFilteredEmployeesList.replace('</label>', '</label><p style="font-size:0px;position:absolute;">' + fTx + '</p>');
							row += "<tr data-id=" + d.taskId + " data-userid=" + d.taskAssignedID + " data-toshow='" + d.taskKpiLine + "_" + d.taskKpiItem + "' data-toshowaddress='" + d.taskKpiAddress + "' >" +
								"<td class='styleToId' " + flagColorRedRow + "><span id='vtaskID" + count + "'  style='display:none'>" + d.taskId + "</span><a href='#' data-taskid='" + d.taskId + "' data-wrikeid='" + d.WrikeID + "' class='toOpenWrike'> <b>" + count +
								" - </b>" + d.taskTitle +
								"</a></td>" +
								"<td class='styleToEntity' title='" + loggedUserID + " vs " + d.taskAssignedID + "' " + flagColorRedRow + ">" + vFilteredEmployeesList + "</td>" +
								"<td align='center' id='TaskAck_" + count + "' " + flagColorRedRow + ">" + BoolAck + "</td>" +
								"<td id='TaskStatus_" + count + "' " + flagColorRedRow + ">" + vFilteredStatusList + "</td>" +
								"<td " + flagColorRedRow + ">" + vFilteredStartDate + "</td>" +
								"<td " + flagColorRedRow + ">" + vFilteredDueDate + "</td>" +
								"<td align='center'  " + flagColorRedRow + ">" + WorkWeekendDisplay + "</td>" +
								"<td align='center' " + flagColorRedRow + ">" + "<p style='font-size:0px;position:absolute;'>" + d.taskDuration + "</p>" + dtaskDuration + "</td>"
								// "<td align='center' " + flagColorRedRow + ">" + dtaskUpdateIcon + "</td>" +
							"</tr>";
							//return (count < 100);							//console.log(d.taskPredecessor);
						});
						//console.log(count);
						$("table.mytblTasks > tbody").append(row);

						flatpickr('.toDatePicker1', {
							dateFormat: CalendarInputFormat
						}); // initialized picker

						var AllRows = data[0];
						var moreslice = parseInt((currentSlice + 1) * 20); // add one because start in 0 and is multiply by 20 (registers)

						if (moreslice < AllRows) {
							$('#RegistersfromTaskTable1').text(moreslice + " / " + AllRows + " tasks");
							$('#RegistersfromTaskTable2').text(moreslice + " / " + AllRows + " tasks");
							$('#ButtonLoadMoreTasks').prop('disabled', false);
						} else {
							$('#RegistersfromTaskTable1').text(AllRows + " / " + AllRows + " tasks");
							$('#RegistersfromTaskTable2').text(AllRows + " / " + AllRows + " tasks");
							$('#ButtonLoadMoreTasks').prop('disabled', true);
						}



					},
					error: function(err) {
						//	alert("Ocurrio un error, vuelva a intentarlo! ");
						console.log('err', err);
					}
				}); // End of ChangeTableTasks function

			} // End ChangeTableTasks
//---ChangeTableTasks<




//---ChangeTableTasksParams>
			function ChangeTableTasksParams(arrayParams, Pm) {
				if (WF_DEBUG)
					console.info("ChangeTableTasksParams(arrayParams, Pm)", arrayParams, Pm);

				ResetFiltersCheckbox();
				// Loop the provided loop in array to get list parameters
				// Si FD.length = 0 || FD==0  :"-"	en FD y TD
				WhoFilterSO = arrayParams[0];
				WhoFilterAsignee = arrayParams[1];
				WhoFilterTask = arrayParams[2];
				WhoFilterSD = arrayParams[3];
				WhoFilterDD = arrayParams[4];
				WhoFilterWoW = arrayParams[5];
				WhoFilterDurationFrom = arrayParams[6];
				WhoFilterDurationTo = arrayParams[7];
				WhoFilterDepartment = arrayParams[8];
				whoFilterItemId = arrayParams[9];
				whoFilterIdAdress = arrayParams[10];

				if (WhoFilterDurationFrom.length == 0 || WhoFilterDurationFrom == 0) {
					WhoFilterDurationFrom = '-';
				}
				if (WhoFilterDurationTo == '' || WhoFilterDurationTo == 0) {
					WhoFilterDurationTo = '-';
				}
				$('table#mytblTasks tbody tr').remove();
				$('table#mytblTasks').css("display", "block");
				$('.filtersBar').slideDown("7000");
				$('.div-selectassigned').css("display", "inline-block");
				$('.div-selectdepartment').css("display", "inline-block");
				$('.div-selecttaskstatus').css("display", "inline-block");
				$('.div-selectStartDate').css("display", "inline-block");
				$('.div-selectDueDate').css("display", "inline-block");
				$('.div-selectWoW').css("display", "inline-block");
				$('.div-selectDuration').css("display", "inline-block");

				var currentPage = pageTasks(2);
				console.log(currentPage);

				if (WF_DEBUG_AJAX)
					console.info("ajax action: getTasksTablev2", getUrl().RT);

				$.ajax({
					"info": true,
					//url: '/app/site/hosting/restlet.nl?script=1386&deploy=1',
					url: getUrl().RT,
					data: {
						'action': 'getTasksTablev2',
						'WhichSalesOrder': WhoFilterSO,
						'assignedTo': WhoFilterAsignee,
						'DepartmentTo': WhoFilterDepartment,
						'StatusId': WhoFilterTask,
						'StartDate': WhoFilterSD,
						'DueDate': WhoFilterDD,
						'WoW': WhoFilterWoW,
						'FD': WhoFilterDurationFrom,
						'TD': WhoFilterDurationTo,
						'selectPage': currentPage,
						'itemId': whoFilterItemId,
						'idAdress': whoFilterIdAdress
					},
					// dataType: 'json',
					dataType: 'text',
					beforeSend: function(data) {
						$('#mytblTasks').DataTable().destroy();
						$('#mytblTasks tbody tr').remove();

					},
					success: function(data) {
						data = CleanResponseData(data);
						var row = '';
						var count = 0;
						//console.log(data);
						//console.log(data[0]);

						data[1].forEach(function(d) {
							//console.log(d);
							GlobarDueDate = d.GlobalDueDateRed;
							GlobalStartDate = d.GlobalStartDate;

							// We get the logged user ID
							var loggedUserID = $('input#custpage_userid').val();
							if (loggedUserID == '') {
								alert('Undetermined user, please login');
							}
							// We collect the user ID which is current in the active session
							loggedUserID = Math.round(loggedUserID);
							//  This variable will set the suffix for the iterative row on course.
							count++;
							WorkWeekend = d.taskWorkWeekend; // Assigment of Work on Weekend status for current task
							var WorkWeekendDisplay;
							// We save the Work on Weekend state here
							var WorkWeekend = d.taskWorkWeekend;
							// If the employee works on Weekends then make the check input to be marked
							if (WorkWeekend) {
								WorkWeekendDisplay = "<input type='checkbox' onchange='changeWorkOnWeekends.call(this)' id='WorkOnWeekends_" + count + "' name='check' class='check' checked />"
									// This will input something like: $("input[id='WorkOnWeekends_7']").attr('checked', true)
							} else {
								WorkWeekendDisplay = "<input type='checkbox' onchange='changeWorkOnWeekends.call(this)' id='WorkOnWeekends_" + count + "' name='check' class='check' />"
							}
							var BoolAck;
							if (d.taskAck) {
								BoolAck = "<input type='checkbox' onchange='changeAck.call(this)' id='Ack_" + count + "' name='check' disabled class='check' checked />"
							} else {
								BoolAck = "<input type='checkbox' onchange='changeAck.call(this)' id='Ack_" + count + "' name='check' class='check' />"
							}
							var vFilteredEmployeesList = lstEmployeeSelect.replace(d.taskAssignedID, d.taskAssignedID + ' selected');
							//var vFilteredStatusList = lstStatusSelect.replace(d.taskStatus + '"', d.taskStatus + '" selected');
							//console.log('lstStatusSelect: '+lstStatusSelect);
							var vFilteredStatusList = lstStatusSelect.replace(d.taskStatus, d.taskStatus + " selected");
							var vFilteredStatusList = vFilteredStatusList.replace('selTaskStatus', 'selTaskStatus' + count); //selTaskStatus
							var vFilteredStatusList = vFilteredStatusList.replace('id="selTaskStatus"', 'id="selTaskStatus' + count + '"');
							var StatusTareaTexto = '';
							var StatusTaskLabel = ['', 'Active', 'Completed', 'Deferred', 'Cancelled'];
							StatusTareaTexto = StatusTaskLabel[d.taskStatus];

							var vFilteredStatusList = vFilteredStatusList.replace('</select>', '</select><p  class="kiko" style="font-size:0px;position:absolute;">' + StatusTareaTexto + '</p>');
							//console.log("Status "+count + " : "+d.taskStatus)
							// Impersoned Logged user
							//loggedUserID = 21562;
							// Disable Start Date and Due Date if user ID don't match for the current row
							dtaskStartDate = d.taskStartDate;
							dtaskDueDate = d.taskDueDate;
							dtaskDuration = "<input id='idTask_Duration_" + count + "' onblur='blurDuration.call()' onkeyup='changeDuration.call(this)' data-dependency='" + d.taskDependency + "' data-predecessor='" + d.taskPredecessor +
								"' type='text' size='2' value=" + d.taskDuration + " data-wrikeid='" + d.WrikeID + "' data-salesorder='" + WhoFilterSO + "'>";
							//dtaskUpdateIcon = "<div id='dico" + count + "' class='GoUpdateDisabled'></div>";
							dtaskUpdateIcon = "<div onclick='clickdico.call(this)' id='dico" + count + "' class='GoUpdateDisabled'></div>";
							//console.log('count = ' + count + ' loggedUserID = ' + loggedUserID + ' d.taskAssignedID = ' +  d.taskAssignedID);
							//console.log('dtaskStarte: ' + dtaskStartDate);
							//console.log("PM : "+Pm);
							if (Pm == false) {
								if ((loggedUserID != d.taskAssignedID) || (d.taskStatus == 2) || (d.taskStatus == 4)) {
									//console.log(vFilteredEmployeesList);
									// Disable Asigned field if user ID don't match for the current row
									vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="+++" disabled id');
									vFilteredStartDate = dtaskStartDate.replace('input type', 'input disabled type');
									vFilteredDueDate = dtaskDueDate.replace('input type', 'input disabled type');
									WorkWeekendDisplay = WorkWeekendDisplay.replace('input type', 'input disabled type');
									BoolAck = BoolAck.replace('input type', 'input disabled type');
									vFilteredStatusList = vFilteredStatusList.replace('select name', 'select disabled name'); //selTaskStatus
									dtaskDuration = dtaskDuration.replace('input id', 'input disabled id');
									dtaskUpdateIcon = "<div onclick='clickdico(this)' id='dico" + count + "' class='GoUpdateDisabled'></div>";
									//dtaskUpdateIcon = "<div id='dico" + count + "' ><button onclick='clickdico()'>Go</button></div>";
								} else {
									vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="***" id');
									vFilteredStartDate = d.taskStartDate;
									vFilteredDueDate = d.taskDueDate;
								}
							} else {
								if ((d.taskStatus == 2) || (d.taskStatus == 4)) {
									//console.log(vFilteredEmployeesList);
									// Disable Asigned field if user ID don't match for the current row
									vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="+++" disabled id');
									vFilteredStartDate = dtaskStartDate.replace('input type', 'input disabled type');
									vFilteredDueDate = dtaskDueDate.replace('input type', 'input disabled type');
									WorkWeekendDisplay = WorkWeekendDisplay.replace('input type', 'input disabled type');
									BoolAck = BoolAck.replace('input type', 'input disabled type');
									vFilteredStatusList = vFilteredStatusList.replace('select name', 'select disabled name'); //selTaskStatus
									dtaskDuration = dtaskDuration.replace('input id', 'input disabled id');
									dtaskUpdateIcon = "<div onclick='clickdico(this)' id='dico" + count + "' class='GoUpdateDisabled'></div>";
									//dtaskUpdateIcon = "<div id='dico" + count + "' ><button onclick='clickdico()'>Go</button></div>";
								} else {
									vFilteredEmployeesList = vFilteredEmployeesList.replace('select id', 'select mytag="***" id');
									vFilteredStartDate = d.taskStartDate;
									vFilteredDueDate = d.taskDueDate;
								}
							}
							if (d.taskDependency == "startToStart") { // Si la dependencia es startToStart, se desabilita el picker StartDate
								vFilteredStartDate = dtaskStartDate.replace('input type', 'input disabled type');
							} else if (d.taskDependency == "startToFinish" || d.taskDependency == "finishToFinish") {
								vFilteredDueDate = dtaskDueDate.replace('input type', 'input disabled type');
							}
							vFilteredEmployeesList = vFilteredEmployeesList.replace('selectAsignee', 'selectAsignee' + count);
							vFilteredEmployeesList = vFilteredEmployeesList.replace('selected >', 'selected>');
							var fTx = vFilteredEmployeesList.split("selected>").pop();
							fTx = fTx.substring(0, fTx.indexOf('<'));

							flagColorRedRow = getColorTaskValidate(d.setColortoRedOutDated, d.yellow, d.taskStatus);

							vFilteredEmployeesList = vFilteredEmployeesList.replace('</label>', '</label><p style="font-size:0px;position:absolute;">' + fTx + '</p>');

							row += "<tr data-id=" + d.taskId + " data-userid=" + d.taskAssignedID + " data-toshow='" + d.taskKpiLine + "_" + d.taskKpiItem + "' data-toshowaddress='" + d.taskKpiAddress + "' >" +
								// "<td align='center' " + flagColorRedRow + ">" + d.taskCompany + "</td>" +
								"<td class='styleToId' " + flagColorRedRow + "><span id='vtaskID" + count + "' style='display:none'>" + d.taskId + "</span><a href='#' data-taskid='" + d.taskId + "' data-wrikeid='" + d.WrikeID + "' class='toOpenWrike'> <b>" + count +
								" - </b>" + d.taskTitle +
								"</a></td>" +
								"<td class='styleToEntity' title='" + loggedUserID + " vs " + d.taskAssignedID + "' " + flagColorRedRow + ">" + vFilteredEmployeesList + "</td>" +
								"<td align='center' id='TaskAck_" + count + "' " + flagColorRedRow + ">" + BoolAck + "</td>" +
								"<td id='TaskStatus_" + count + "' " + flagColorRedRow + ">" + vFilteredStatusList + "</td>" +
								//"<td id='TaskPredecessor_"+count+"'>" + d.taskPredecessor + "</td>" +
								//"<td id='TaskDependency_"+count+"'>" + d.taskDependency + "</td>" +
								"<td " + flagColorRedRow + ">" + vFilteredStartDate + "</td>" +
								"<td " + flagColorRedRow + ">" + vFilteredDueDate + "</td>" +
								"<td align='center'  " + flagColorRedRow + ">" + WorkWeekendDisplay + "</td>" +
								"<td align='center' " + flagColorRedRow + ">" + "<p style='font-size:0px;position:absolute;'>" + d.taskDuration + "</p>" + dtaskDuration + "</td>"
								// "<td align='center' " + flagColorRedRow + ">" + dtaskUpdateIcon + "</td>" +
							"</tr>";

							//console.log(d.taskPredecessor);
						});
						//console.log(count);
						$("table.mytblTasks > tbody").append(row);

						var AllRows = data[0];
						var moreslice = parseInt((currentPage + 1) * 20); // add one because start in 0 and is multiply by 20 (registers)

						if (moreslice < AllRows) {
							$('#RegistersfromTaskTable1').text(moreslice + " / " + AllRows + " tasks");
							$('#RegistersfromTaskTable2').text(moreslice + " / " + AllRows + " tasks");
							$('#ButtonLoadMoreTasks').prop('disabled', false);
						} else {
							$('#RegistersfromTaskTable1').text(AllRows + " / " + AllRows + " tasks");
							$('#RegistersfromTaskTable2').text(AllRows + " / " + AllRows + " tasks");
							$('#ButtonLoadMoreTasks').prop('disabled', true);
						}

						flatpickr('.toDatePicker2', {
							dateFormat: CalendarInputFormat
						}); // initialized picke
					},
					complete: function(data) {

						setTimeout(function() {
							if ($.fn.dataTable.isDataTable('#mytblTasks')) {
								$('#mytblTasks').DataTable().destroy();
							}
							// else {
							table = $('#mytblTasks').DataTable({
								"scrollY": "600px",
								"scrollCollapse": true,
								"bInfo": false,
								"paging": false,
								"info": true,
								// "order": [
								// 	[4, "asc"]
								// ]
							});

						}, 1000);
					},
					error: function(err) {
						console.log("Ocurrio un error, vuelva a intentarlo! ", err);
					}
				});
				return false;
			} // End ChangeTableTasksParams
//---ChangeTableTasksParams<


//ChangeTableTasks (WhichSalesOrder); // Function to Change in each row Click of Sales Order's Table


//---hideAllNoneAssignedRows>
			function hideAllNoneAssignedRows() {
				//console.log('Function to hide all none assigned tasks rows to user');
			}
//---hideAllNoneAssignedRows<




//---findEmployeesOfProject>
			window.findEmployeesOfProject = function findEmployeesOfProject(idSO) {
					if (WF_DEBUG)
						console.info("findEmployeesOfProject(idSO)", idSO);

					if (WF_DEBUG_AJAX)
						console.info("ajax action: getEmployeesOfProject", getUrl().RT);

					var ReturnedData = {};
					//console.log('The ID for Select is '+idSO)
					//return true;
					$.ajax({
						//url: '/app/site/hosting/restlet.nl?script=1386&deploy=1'
						url: getUrl().RT,
						async: false,
						data: {
							'action': 'getEmployeesOfProject',
							'idSO': idSO
						},
						// dataType: 'json',
						dataType: 'text',
						success: function(data) {
							data = CleanResponseData(data);
							//console.log(data);
							var optionSelectConstructor = '';
							data.forEach(function(d) {
								//console.log(d.assignedId);
								//console.log(d.assignedName);
								optionSelectConstructor = optionSelectConstructor + '<option value=' + d.assignedId + '>' + d.assignedName + '</option>';
							});
							ReturnedData = optionSelectConstructor;
						},
						error: function(data) {
							console.log("Someting happend! ");
						}
					});
					return ReturnedData;
				}
//---findEmployeesOfProject<




//---getDepartmentOfProject>
			window.getDepartmentOfProject = function getDepartmentOfProject(idSO) {
					if (WF_DEBUG)
						console.info("getDepartmentOfProject(idSO)", idSO);

					if (WF_DEBUG_AJAX)
						console.info("ajax action: getDepartmentOfProject", getUrl().RT);

					var ReturnedData = {};
					//console.log('The ID for Select is '+idSO)
					//return true;
					$.ajax({
						//url: '/app/site/hosting/restlet.nl?script=1386&deploy=1'
						url: getUrl().RT,
						async: false,
						data: {
							'action': 'getDepartmentOfProject',
							'idSO': idSO
						},
						// dataType: 'json',
						dataType: 'text',
						success: function(data) {
							data = CleanResponseData(data);
							//console.log(data);
							var optionSelectConstructor = '';
							data.forEach(function(d) {
								//console.log(d.assignedId);
								//console.log(d.assignedName);
								optionSelectConstructor = optionSelectConstructor + '<option value=' + d.DepartmentdId + '>' + d.DepartmentName + '</option>';
							});
							ReturnedData = optionSelectConstructor;
						},
						error: function(data) {
							console.log("Someting happend! ");
						}
					});
					return ReturnedData;
				}
//---getDepartmentOfProject<




//---UpdateEndByDuration>
			window.UpdateEndByDuration = function UpdateEndByDuration(idInput) {
					var num = String(idInput).split('_').pop();
					//console.log("IN Num :"+ num);
					/* var p1 = arrayString[1];
					var num = arrayString[2]; */
					var idDueDate = '#idPicker_DueDate_' + num;
					var idStartDate = '#idPicker_StartDate_' + num;
					var idDuration = '#idTask_Duration_' + num;
					var isChecked = $('#WorkOnWeekends_' + num).is(':checked');
					var due = StringNetsuiteDateToDate($(idDueDate).val());
					var Start = StringNetsuiteDateToDate($(idStartDate).val());
					var Duration = $(idDuration).val();
					var DueDate = new Date(computeEndByDuration(Start.getTime(), Duration, isChecked, 0));
					$(idDueDate).val(dateToStringNetsuite(DueDate));
				}
//---UpdateEndByDuration<




//---UpdateStartByDuration>
			window.UpdateStartByDuration = function UpdateStartByDuration(idInput) {
					var num = String(idInput).split('_').pop();
					/* var p1 = arrayString[1];
					var num = arrayString[2]; */
					var idDueDate = '#idPicker_DueDate_' + num;
					var idStartDate = '#idPicker_StartDate_' + num;
					var idDuration = '#idTask_Duration_' + num;
					var isChecked = $('#WorkOnWeekends_' + num).is(':checked');
					var due = StringNetsuiteDateToDate($(idDueDate).val());
					var Start = StringNetsuiteDateToDate($(idStartDate).val());
					var Duration = $(idDuration).val();
					var StartDate = new Date(computeStartByDuration(due.getTime(), Duration, isChecked, 0));

					$(idStartDate).val(dateToStringNetsuite(StartDate));
					// $(idStartDate).children().eq(0).val(formatDate(StartDate));
				}
//---UpdateStartByDuration>




//---dhm>
			window.dhm = function dhm(t) {
					var cd = 24 * 60 * 60 * 1000,
						ch = 60 * 60 * 1000,
						d = Math.floor(t / cd),
						h = Math.floor((t - d * cd) / ch),
						m = Math.round((t - d * cd - h * ch) / 60000),
						pad = function(n) {
							return n < 10 ? '0' + n : n;
						};
					if (m === 60) {
						h++;
						m = 0;
					}
					if (h === 24) {
						d++;
						h = 0;
					}
					return d + 1;
				}
//---dhm<



//---getSelectText>
			window.getSelectText = function getSelectText(selId) {
					var sel = document.getElementById(selId);
					var i = sel.selectedIndex;
					var selected_text = sel.options[i].text;
					return selected_text;
				}
//---getSelectText<




//---formatDate>
			window.formatDate = function formatDate(date) {
					var d = new Date(date),
						month = '' + (d.getMonth() + 1),
						day = '' + d.getDate(),
						year = d.getFullYear();
					if (month.length < 2) month = '0' + month;
					if (day.length < 2) day = '0' + day;
					return [year, month, day].join('-');
				}
//---formatDate<




//---formatDatebyNetsuiteDate>
			window.formatDatebyNetsuiteDate = function formatDatebyNetsuiteDate(date) {

					if (typeof date === 'string') {
						var d = new Date(StringNetsuiteDateToDate(date));
					} else {
						var d = new Date(date);
					}

					var d = new Date(date),
						month = '' + (d.getMonth() + 1),
						day = '' + d.getDate(),
						year = d.getFullYear();
					if (month.length < 2) month = '0' + month;
					if (day.length < 2) day = '0' + day;
					return [year, month, day].join('-');
				}
//---formatDatebyNetsuiteDate<




//---Datemasuno>
			window.Datemasuno = function Datemasuno(date) {
					return new Date(date);
					// derogate date and calender is working ok now
					var d = new Date(date).getTime();
					d = d + (86400 * 1000); // Add one Day to Current Date
					d = new Date(d);
					return d;
				}
//---Datemasuno<




//---isHoliday>
			window.isHoliday = function isHoliday(date, weekend) {
					var friIsHoly = false;
					var satIsHoly = !weekend;
					var sunIsHoly = !weekend;
					pad = function(val) {
						val = "0" + val;
						return val.substr(val.length - 2);
					};
					var holidays = "#01_01#12_25#";
					var ymd = "#" + date.getFullYear() + "_" + pad(date.getMonth() + 1) + "_" + pad(date.getDate()) + "#";
					var md = "#" + pad(date.getMonth() + 1) + "_" + pad(date.getDate()) + "#";
					var day = date.getDay();
					return (day == 5 && friIsHoly) || (day == 6 && satIsHoly) || (day == 0 && sunIsHoly) || holidays.indexOf(ymd) > -1 || holidays.indexOf(md) > -1;
				}
//---isHoliday<



//---recomputeDuration>
			//Metodo para Obtener los dias de duracion, dependiendo de la fecha de inicio, fecha de termino y si fin de semana (False, True)
			window.recomputeDuration = function recomputeDuration(start, end, weekend) {
					Date.prototype.distanceInWorkingDays = function(toDate) {
						var pos = new Date(this.getTime());
						pos.setHours(23, 59, 59, 999);
						var days = 0;
						var nd = new Date(toDate.getTime());
						nd.setHours(23, 59, 59, 999);
						var end = nd.getTime();
						while (pos.getTime() <= end) {
							days = days + (isHoliday(pos, weekend) ? 0 : 1);
							pos.setDate(pos.getDate() + 1);
						}
						return days;
					};
					//console.debug("recomputeDuration");
					return new Date(start).distanceInWorkingDays(new Date(end));
				}
//---recomputeDuration<




//---computeStartByDuration>
			//Componer fecha Inicio
			window.computeStartByDuration = function computeStartByDuration(end, duration, weekend) {
					weekend = (typeof weekend === 'undefined') ? false : weekend;
					var d = new Date(end);
					//console.debug("computeStartByDuration start ",d,duration)
					var q = duration - 1;
					while (q > 0) {
						d.setDate(d.getDate() - 1);
						if (!isHoliday(d, weekend)) q--;
					}
					d.setHours(23, 59, 59, 999);
					return d.getTime();
				}
//---computeStartByDuration<




//---computeStartDate>
			window.computeStartDate = function computeStartDate(start, weekend, plus) {
					var d = new Date(start + 3600000 * plus);
					d.setHours(0, 0, 0, 0);
					//move to next working day
					/*
					while (isHoliday(d)) {
						d.setDate(d.getDate() + 1);
					}*/
					for (; isHoliday(d, weekend) != false;) {
						d.setDate(d.getDate() + 1);
					}
					d.setHours(0, 0, 0, 0);
					return d;
				}
//---computeStartDate<




//---computeStart>
			//Verificar Fecha de inicio, con WEEKEND, para determinar que dia recorrerla
			window.computeStart = function computeStart(start, weekend, plus) {
					weekend = weekend || false;
					plus = plus || 12;
					return computeStartDate(start, weekend, plus).getTime();
				}
//---computeStart<




//---computeEndByDuration>
			// Metodo para Obtener la fecha de Termino apartir de la fecha de inicio, Duracion y Trabaja fin de semana (false, true)
			window.computeEndByDuration = function computeEndByDuration(start, duration, weekend, n) {
					weekend = (typeof weekend === 'undefined') ? false : weekend;
					var d = new Date(start);
					//console.debug("computeEndByDuration start ",d,duration)
					var q = duration - 1;
					while (q > 0) {
						d.setDate(d.getDate() + 1);
						if (!isHoliday(d, weekend)) q--;
					}
					d.setHours(23, 59, 59, 999);
					return d.getTime();
				}
//---computeEndByDuration<

			//var dates;
			// window.UpdateStartByDependency = function UpdateStartByDependency(idInput) {
			// 	//First step : Get values from predecessor object
			// 	var arrayString = String(idInput).split('_');
			// 	var p1 = arrayString[1];
			// 	var num = arrayString[2];
			// 	var idStartDate = '#idPicker_StartDate_' + num;
			// 	var idDuration = '#idTask_Duration_' + num;
			// 	var dependency = $(idDuration).attr("data-dependency");
			// 	var predecessor = $(idDuration).attr("data-predecessor");
			// 	var Start = new Date($(idStartDate).children().eq(0).val());
			// 	if (dependency == 'finishToStart') {
			// 		//	console.log("El predecesor no debe ser menor a la fecha seleccionada");
			// 		var p = getDatafromPredecessor(predecessor);
			// 		if (p[0].duedate >= Start.getTime()) {
			// 			//	console.log("Alcanzo a predecesor");
			// 			alert("The following task is preventing you to update the stardate \n" + p[0].title + " \nDue date : " + formatDate(p[0].duedate));
			// 			return false;
			// 		}
			// 		else {
			// 			console.log("Didn't catch the predecesor")
			// 		}
			// 	}
			// 	else if (dependency == 'startToStart') {
			// 		console.log("Start date can not be modified");
			// 	}else{
			// 		// alert("no dependency");
			// 	}
			// 	//console.log("Duedate : "+new Date(p[0].duedate) + " : " + Start);
			// }

//---getDatafromPredecessor>
			window.getDatafromPredecessor = function getDatafromPredecessor(predecessor) {
					if (WF_DEBUG)
						console.info("getDatafromPredecessor(predecessor)", predecessor);

					if (WF_DEBUG_AJAX)
						console.info("ajax action: getTaskPredecessor", getUrl().RT);

					var ReturnedData = {};
					$.ajax({
						//url: '/app/site/hosting/restlet.nl?script=1386&deploy=1'
						url: getUrl().RT,
						async: false,
						data: {
							'action': 'getTaskPredecessor',
							'id': predecessor
						},
						// dataType: 'json',
						dataType: 'text',
						success: function(data) {
							data = CleanResponseData(data);
							//console.log(data);
							ReturnedData = data;
						},
						error: function(err) {
							console.log("Ocurrio un error, vuelva a intentarlo! ", err);
						}
					});
					//console.log(ReturnedData);
					return ReturnedData;
				}
//---getDatafromPredecessor<




//---UpdatewithDurationbyDependency>
			window.UpdatewithDurationbyDependency = function UpdatewithDurationbyDependency(Input) {
					//First step : Get values from predecessor object
					var arrayString = String(Input).split('_');
					var p1 = arrayString[1];
					var num = arrayString[2];
					var idDuration = '#idTask_Duration_' + num;
					var dependency = $(idDuration).attr("data-dependency");
					var predecessor = $(idDuration).attr("data-predecessor");
					if (dependency == "finishToStart" || dependency == "startToStart") {
						UpdateEndByDuration(Input);
					} else if (dependency == "finishToFinish" || dependency == "startToFinish") {
						UpdateStartByDuration(Input);
					} else {
						UpdateEndByDuration(Input);
					}
				}
//---UpdatewithDurationbyDependency<




//---UpdateDurationbyStart>
			window.UpdateDurationbyStart = function UpdateDurationbyStart(idInput, WorkWeekend) {
					var arrayString = String(idInput).split('_');
					var p1 = arrayString[1];
					var num = arrayString[2];
					var idDueDate = '#idPicker_DueDate_' + num;
					var idStartDate = '#idPicker_StartDate_' + num;
					var idDuration = '#idTask_Duration_' + num;
					var isChecked = $('input[id=WorkOnWeekends_' + num + ']').is(':checked');
					var Start = new Date($(idStartDate).children().eq(0).val());
					//	var Duration = $(idDuration).children().eq(0).val();
					var Duration = $(idDuration).val();
					var due = new Date($(idDueDate).children().eq(0).val());
					//alert($(idWorkWeekend).val());
					var StarDateWithcWeekend = computeStart(Start.getTime(), isChecked);
					$(idStartDate).children().eq(0).val(formatDate(StarDateWithcWeekend));
					//var Start2 = new Date($(idStartDate).children().eq(0).val());
					//console.log('Change Start Date : ' + formatDate(StarDateWithcWeekend) + " : " + StarDateWithcWeekend);
					var Totalduration = recomputeDuration(StarDateWithcWeekend, due.getTime(), isChecked);
					//$(idDuration).children().eq(0).val(Totalduration);
					$(idDuration).val(Totalduration);
					//console.log('Change Duration : ' + Totalduration);
				}
//---UpdateDurationbyStart<




//---UpdateDuration>
			window.UpdateDuration = function UpdateDuration(idInput, WorkWeekend) {
					// Takes index contents from idInput
					var arrayString = String(idInput).split('_');
					var p1 = arrayString[1];
					var num = arrayString[2];
					if (p1 == 'StartDate') {
						var idDueDate = '#idPicker_DueDate_' + num;
						var idStartDate = '#idPicker_StartDate_' + num;
						var idDuration = '#idTask_Duration_' + num;
						var isChecked = $('input[id=WorkOnWeekends_' + num + ']').is(':checked');
						// -	var Start = new Date($(idStartDate).children().eq(0).val());
						var Start = StringNetsuiteDateToDate( $(idStartDate).val() );
						//var Duration = $(idDuration).children().eq(0).val();
						var Duration = $(idDuration).val();
						var StarDateWithcWeekend = computeStart(Start.getTime(), isChecked);
						var DueDate = new Date(computeEndByDuration(StarDateWithcWeekend, Duration, isChecked, 1));
						//alert(formatDate(DueDate));
						//	$(idDueDate).val(DueDate.toString());
						//$(idStartDate).val(StarDateWithcWeekend.toString());
						// -	$(idDueDate).children().eq(0).val(formatDate(DueDate));
						if(WF_DEBUG)
							console.info('UpdateDuration()','StarDateWithcWeekend:',StarDateWithcWeekend,'DueDate:',DueDate,'Start:',Start);

						$(idDueDate).val(dateToStringNetsuite(DueDate));
						// -	$(idStartDate).children().eq(0).val(formatDate(StarDateWithcWeekend));
						$(idStartDate).val(dateToStringNetsuite(new Date(StarDateWithcWeekend)));
						//alert(	computeStartByDuration(due.getTime(),Duration,WorkWeekend) );
						return 0;
					} else if (p1 == 'DueDate') {
						var idDueDate = '#idPicker_DueDate_' + num;
						var idStartDate = '#idPicker_StartDate_' + num;
						var idDuration = '#idTask_Duration_' + num;
						var isChecked = $('input[id=WorkOnWeekends_' + num + ']').is(':checked');
						// var due = new Date($(idDueDate).children().eq(0).val());
						// var Start = new Date($(idStartDate).children().eq(0).val());

						var due = StringNetsuiteDateToDate($(idDueDate).val());
						var Start = StringNetsuiteDateToDate($(idStartDate).val());
						if (WF_DEBUG)
							console.info("Start StringNetsuiteDateToDate", Start);
						if (WF_DEBUG)
							console.info("Due StringNetsuiteDateToDate", due);
						// var due = new Date($(idDueDate).val());
						// var Start = new Date($(idStartDate).val());
						var Duration = $(idDuration).val();
						//var Duration = $(idDuration).children().eq(0).val();
						var Totalduration = recomputeDuration(Start.getTime(), due.getTime(), isChecked);
						var DueDateWithcWeekend = computeStart(due.getTime(), isChecked);
						//alert(Totalduration);
						if (Totalduration > 0) {
							$(idDuration).val(Totalduration);
							//$(idDuration).children().eq(0).val(Totalduration);
							// $(idDueDate).children().eq(0).val(formatDate(DueDateWithcWeekend));
							$(idDueDate).val(dateToStringNetsuite(new Date(DueDateWithcWeekend)));
						}
						return Totalduration;
					}
				} // function close - UpdateDuration
//---UpdateDuration<

			window.Myfun = function Myfun() {
				//console.log("Param "+JSON.stringify (parameter));
				//console.log($(this)[0].value);
				//console.log($(this));
			}

//---changeSelectAsignee>
			window.changeSelectAsignee = function changeSelectAsignee() {
					//var vExtract = $(this).attr('data-rowid');
					// var dataTr = $(this).parent().parent().parent(); // parent(label).parent(TD).Parent(Row)
					//
					// var vExtract = $(this).parent().parent().parent()[0].id; // parent(label).parent(TD).Parent(Row)
					// console.log(vExtract);
					// console.log($('#'+vExtract+' > td .selectAsignee'));
					// window.alex2 = $('#'+vExtract+' > td .selectAsignee');
					// window.alex = vExtract;

					var idparent = $(this)[0].id;
					var vExtract = idparent.split("Asignee").pop();
					changeDico(vExtract);
					return false;
					//	changeDico(vExtract);
				}
//---changeSelectAsignee<




//---changeLoadAsigneeTasksW>
			window.changeLoadAsigneeTasksW = function changeLoadAsigneeTasksW() {
					//console.log("Value :"+ $(this)[0].value);
					//console.log("Id :"+ $(this)[0].id);
					var SelectIndex = $(this)[0].value;
					//console.log(SelectIndex);
					//console.log($(this)[0].id);
					var vExtract = ($(this)[0].id).split("_").pop();
					ChangeTableTasks(vExtract, SelectIndex, 'notask', Pm);
					//console.log(vExtract);
					return false;
				}
//---changeLoadAsigneeTasksW<




//---changeLoadStatusTasks>
			window.changeLoadStatusTasks = function changeLoadStatusTasks() {
					fldId = $(this)[0].id;
					var WhatStatusIs = $("#" + fldId + " option:selected").text();
					//console.log(WhatStatusIs);
					if (WhatStatusIs == 'Active') {
						$("p.kiko:contains('Active')").closest("tr").show();
						$("p.kiko:contains('Completed')").closest("tr").hide();
						$("p.kiko:contains('Deferred')").closest("tr").hide();
						$("p.kiko:contains('Cancelled')").closest("tr").hide();
					} else if (WhatStatusIs == 'Completed') {
						$("p.kiko:contains('Active')").closest("tr").hide();
						$("p.kiko:contains('Completed')").closest("tr").show();
						$("p.kiko:contains('Deferred')").closest("tr").hide();
						$("p.kiko:contains('Cancelled')").closest("tr").hide();
					} else if (WhatStatusIs == 'Deferred') {
						$("p.kiko:contains('Active')").closest("tr").hide();
						$("p.kiko:contains('Completed')").closest("tr").hide();
						$("p.kiko:contains('Deferred')").closest("tr").show();
						$("p.kiko:contains('Cancelled')").closest("tr").hide();
					} else if (WhatStatusIs == 'Cancelled') {
						$("p.kiko:contains('Active')").closest("tr").hide();
						$("p.kiko:contains('Completed')").closest("tr").hide();
						$("p.kiko:contains('Deferred')").closest("tr").hide();
						$("p.kiko:contains('Cancelled')").closest("tr").show();
					}
					return false;
				}
//---changeLoadStatusTasks<




//---changeDico>
			window.changeDico = function changeDico(vExt) {
					$('#ButtonLoadMoreTasks').attr("data-slice", -1);

					//ooooo
					setTimeout(function() {
						// $("#dico" + vExt).click();
						clickdico(vExt);
					}, 500);

					//  $("#dico" + vExt).removeClass('GoUpdateDisabled');
					// if (vExt == "TreeTask1"){
					// 	$("#dico" + vExt).show();
					// }else{
					// 	$("#dico" + vExt).addClass('GoUpdateEnable');
					// }
				}
//---changeDico<




//---getLastStatus>
			window.getLastStatus = function getLastStatus(e) {
					/* console.log($(this)[0].value);
					//console.log(e.target.);
					e = e || window.event;
					e = e.target || e.srcElement;
					console.log(e.value); */
					GlobalLastStatus = $(this)[0].value;
				}
//---getLastStatus<




//---changeselTaskStatus>
			window.changeselTaskStatus = function changeselTaskStatus() {
					var idparent = $(this)[0].id;
					var StatusID = $(this)[0].value;
					//console.log($(this));
					var StatusName = $("#" + idparent + " option:selected").text();
					//console.log("Global StartDate :"+GlobalStartDate);
					//console.log("Global DueDate :"+GlobalDueDate);
					//console.log(StatusName + " "+ StatusID);
					var vExtract = idparent.split("lTaskStatus").pop();

					if ((StatusName == "Completed" || StatusID == 2) || (StatusName == "Cancelled" || StatusID == 4)) {
						if (confirm("You won\'t be able to update this task once the status changes to 'completed/cancelled'")) {
							//console.log(vExtract);
							RuleToStatus(vExtract);
							//console.log(vExtract);
							$('#idPicker_StartDate_' + vExtract).children().eq(0).prop('disabled', true);
							$('#idPicker_DueDate_' + vExtract).children().eq(0).prop('disabled', true);
							$('#idTask_Duration_' + vExtract).prop('disabled', true);
							$('#WorkOnWeekends_' + vExtract).prop('disabled', true);
						} else {
							$(this).val(GlobalLastStatus);
							//return false;
						}
					} else {
						$('#idPicker_StartDate_' + vExtract).children().eq(0).prop('disabled', false);
						$('#idPicker_DueDate_' + vExtract).children().eq(0).prop('disabled', false);
						$('#idTask_Duration_' + vExtract).prop('disabled', false);
						$('#WorkOnWeekends_' + vExtract).prop('disabled', false);
					}
					changeDico(vExtract);
					return false;
					s
				}
//---changeselTaskStatus>




//---RuleToStatus>
			window.RuleToStatus = function RuleToStatus(num) {
					var idDueDate = '#idPicker_DueDate_' + num;
					var idStartDate = '#idPicker_StartDate_' + num;
					var idDuration = '#idTask_Duration_' + num;
					var isChecked = $('input[id=WorkOnWeekends_' + num + ']').is(':checked');
					var due = new Date($(idDueDate + " 00:00").val());
					var Start = new Date($(idStartDate + " 00:00").val());
					// var due = new Date($(idDueDate).children().eq(0).val());
					// var Start = new Date($(idStartDate).children().eq(0).val());
					var Duration = $(idDuration).val();
					if (Start > new Date().setHours(0, 0, 0, 0)) {
						//console.log(GlobalStartDate);
						var StarDateWithcWeekend = computeStart(new Date(GlobalStartDate).getTime(), isChecked);
						$(idStartDate).val(dateToStringNetsuite(new Date(StarDateWithcWeekend)));
						// $(idStartDate).children().eq(0).val(formatDate(StarDateWithcWeekend));
						$(idDuration).val(1); // Duration se iguala a 1
						var DueDateWithcWeekend = computeEndByDuration(StarDateWithcWeekend, 1, isChecked, 1);
						$(idDueDate).val(dateToStringNetsuite(new Date(DueDateWithcWeekend)));
						// $(idDueDate).children().eq(0).val(formatDate(DueDateWithcWeekend));
					} else if ((Start < new Date().setHours(0, 0, 0, 0)) && (due >= new Date().setHours(0, 0, 0, 0))) {
						var StarDateWithcWeekend = computeStart(new Date(GlobalStartDate).getTime(), isChecked);
						var Totalduration = recomputeDuration(StarDateWithcWeekend, new Date().setHours(0, 0, 0, 0), isChecked);
						var DueDateWithcWeekend = computeEndByDuration(StarDateWithcWeekend, Totalduration, isChecked, 1);
						$(idDuration).val(Totalduration);
						$(idDueDate).val(dateToStringNetsuite(new Date(DueDateWithcWeekend)));
						// $(idDueDate).children().eq(0).val(formatDate(DueDateWithcWeekend));
					}
				}
//---RuleToStatus<




//---changeidPickerStartDate>
			window.changeidPickerStartDate = function changeidPickerStartDate() {
					if (WF_DEBUG)
						console.log("Startdefault " + $(this)[0].defaultValue);
					var PrevStartDate = $(this)[0].defaultValue;
					var idparent = $(this)[0].id;
					var vExtract = idparent.split("_").pop();
					var StartDateCurrVal = new Date($(this).val() + " 00:00");
					var today = new Date().setHours(0, 0, 0, 0);
					var PrevStartDateMM = new Date(PrevStartDate + " 00:00");
					var canDoIt = UpdateStartByDependency(idparent);
					//	alert('StartDate ' + vExtract);
					//return false;
					//Si la fecha selecciondada es menor a la anterior :
					if (PrevStartDateMM > StartDateCurrVal) {
						//if (new Date(CurrentStartDate).getTime() > new Date($(this).val()).getTime()) {
						// si retorna False , cancelara el proceso y pondra la fecha que estaba anteriormente
						if (!canDoIt) {
							// $(this).val(dateToStringNetsuite(new Date(PrevStartDateMM))); // Se restablece la fecha anterior
							// Se restablece la fecha anterior
							$(this).val(dateToStringNetsuite(PrevStartDateMM));
							// $(this).setDate(dateToStringNetsuite(new Date(PrevStartDateMM)), false);
							// Second param are not trigger event...

							return false;
							// Si la fecha seleccionada es menor a Hoy
						} else if (canDoIt && StartDateCurrVal < today) {
							window.datem = this;
							if(WF_DEBUG)
								console.log('datem', datem, 'PrevStartDateMM', PrevStartDateMM, PrevStartDate);
							// Se restablece la fecha anterior
							//-- $(this).val( dateToStringNetsuite(new Date(PrevStartDateMM)) );
							$(this).val(dateToStringNetsuite(new Date(PrevStartDate + ' 00:00')));
							// Second param are not trigger event...

							/* var Now = new Date().setHours(0,0,0,0);
							console.log("La fecha Es menor A Hoy : "+Now + " > "+new Date($(this).val()).setHours(0,0,0,0)); */
							alert("The selected date is less than current day");

							//--$(this).val(dateToStringNetsuite(new Date(PrevStartDateMM))); // Se restablece la fecha anterior

							return false;
						}
						//UpdateDurationbyStart(idparent, WorkWeekend);// Esto se pondra en el metodo de UpdateStartByDependency
						// Si la fecha seleccionada es mayor a la fecha inicial
					} else {
						//var idparent = event.target.id;
						//alert('avanzo');
						UpdateDuration(idparent, WorkWeekend);
					}

					changeDico(vExtract); // si hay cambios se habilita el boton de guardado
					return false;
				}
//---changeidPickerStartDate<




//---changeidPickerDueDate>
			window.changeidPickerDueDate = function changeidPickerDueDate() {
					//console.log("Due "+$(this)[0].defaultValue);
					var ExDate = $(this)[0].defaultValue + " 00:00";
					if (WF_DEBUG) console.info("ExDate", ExDate);
					var idparent = $(this)[0].id;
					//alert(UpdateDuration(idparent));
					var vExtract = idparent.split("_").pop();
					//alert("Due Date " + $(this).val());

					var ud = UpdateDuration(idparent, WorkWeekend);
					if (WF_DEBUG)
						console.info("UpdateDuration", ud);
					if (ud == 0) {
						alert("The Due Data must not be less to Start Date");
						$(this).val(dateToStringNetsuite(new Date(ExDate))); // DefaultValue ever is YYYY / mm / dd
						var isChecked = $('input[id=WorkOnWeekends_' + vExtract + ']').is(':checked');
						var dur = recomputeDuration(StringNetsuiteDateToDate($("#idPicker_StartDate_" + vExtract).val()).getTime(), new Date(ExDate).getTime(), isChecked);
						// var dur = recomputeDuration($("#idPicker_StartDate_" + vExtract).children().eq(0).val(),new Date(ExDate).getTime(),isChecked);
						$("#idTask_Duration_" + vExtract).val(dur);
						return false;
					}

					changeDico(vExtract);
					return false;
				}
//---changeidPickerDueDate<




//---changeWorkOnWeekends>
			window.changeWorkOnWeekends = function changeWorkOnWeekends() {
					var idCheck = $(this)[0].id;
					var vExtract = idCheck.split("_").pop();
					var isChecked = $('#WorkOnWeekends_' + vExtract).is(':checked');
					if (WF_DEBUG)
						console.info("WorkOnWeekend", isChecked);
					//If the field WorkWeeken is Checked the Dates should be Update to beyond date
					var idDueDate = '#idPicker_DueDate_' + vExtract;
					var idStartDate = '#idPicker_StartDate_' + vExtract;
					var idDuration = '#idTask_Duration_' + vExtract;
					var due = StringNetsuiteDateToDate($(idDueDate).val());
					var Start = StringNetsuiteDateToDate($(idStartDate).val());
					//var Duration = $(idDuration).children().eq(0).val();
					var Duration = $(idDuration).val();
					var StarDateWithcWeekend = computeStart(Start.getTime(), isChecked); //

					$(idStartDate).val(dateToStringNetsuite(new Date(StarDateWithcWeekend)));
					var dependency = $(idDuration).attr("data-dependency");
					var predecessor = $(idDuration).attr("data-predecessor");
					/* if(dependency=="finishToStart" || dependency=="startToStart"){
						var Start2 = new Date($(idStartDate).children().eq(0).val());
						var DueDateWithcWeekend = computeEndByDuration(Start2.getTime(), Duration, isChecked, 0);
						$(idDueDate).children().eq(0).val(formatDate(DueDateWithcWeekend));
					}else if (dependency=="finishToFinish" || dependency=="startToFinish"){
					} */
					if (dependency == "finishToStart" || dependency == "startToStart") { //5
						UpdateEndByDuration(idCheck);
						//console.log("Arrive! " + idCheck);
					} else if (dependency == "finishToFinish" || dependency == "startToFinish") {
						UpdateStartByDuration(idCheck);
					} else { // En caso de no tener DEPENDENCY
						UpdateEndByDuration(idCheck); // Actualiza Fecha Final con la duracion
					}
					changeDico(vExtract);
					return false;
				}
//---changeWorkOnWeekends<




//---changeAck>
			window.changeAck = function changeAck() {
					var idCheck = $(this)[0].id;
					var vExtract = idCheck.split("_").pop();

					$(this).prop('disabled', true);

					clickdico(vExtract, true);



					return false;
				}
//---changeAck<




//---SetFilterToTasks>
			window.SetFilterToTasks = function SetFilterToTasks() {
					$(".mytblTasks").find('tr:not(:first)').each(function() {
						$(this).hide();
					});
					var filter = [];
					$(".myUpdatedSA").find('input[type=checkbox]').each(function() {
						var toshow = "-";
						if ($(this).is(':checked')) {
							toshow = $(this).parent().parent().attr("data-toshow");
							//line = $(this).parent().parent().attr("data-line");
							if (WF_DEBUG)
								console.info("toshow", toshow);
							filter.push({
								"type": "Services",
								"toshow": toshow
							});
						}
					});
					$(".myUpdatedServicesAddresses").find('input[type=checkbox]').each(function() {
						var Address = "-";
						if ($(this).is(':checked')) {
							Address = $(this).parent().parent().attr("data-toshow");
							if (WF_DEBUG)
								console.info("Address", Address);
							filter.push({
								"type": "ServicesAddress",
								"toshow": Address
							});
						}
					});
					var toShow = "-"
					for (var i = 0; i < filter.length; i++) {
						if (filter[i].type == "Services") {
							toShow = filter[i].toshow;
							$(".mytblTasks tr[data-toshow='" + toShow + "']").show();
						} else if (filter[i].type == "ServicesAddress") {
							toShow = filter[i].toshow;
							$(".mytblTasks tr[data-toshowaddress='" + toShow + "']").show();
						}
						//	console.log(toShow);
					}
					if (filter[0] == undefined) {
						$(".mytblTasks").find('tr:not(:first)').each(function() {
							$(this).show();
						});
					}
				}
//---SetFilterToTasks>

			var DurationValue;
			var field;

//---changeDuration>
			window.changeDuration = function changeDuration() {
					field = $(this)[0].id;
					// console.log($(this)[0].id);
					DurationValue = $(this)[0].defaultValue;
					var idparent = $(this)[0].id;
					var vExtract = idparent.split("_").pop();
					var CurrentDurationValue = $(this).val();
					// console.log("Last Duration : "+ DurationValue + " New Duration :"+CurrentDurationValue);
					if (CurrentDurationValue.length > 0 && CurrentDurationValue < 1) {
						$(this).val(DurationValue);
					} else if (CurrentDurationValue >= 100) {
						$(this).val(DurationValue);
					} else if (CurrentDurationValue.length == 0) {} else {
						//console.log('else '+ idparent);
						UpdatewithDurationbyDependency(idparent);
						//UpdateEndByDuration(e.target.id);
						//console.log(e.target.id);
					}
					//console.log('change : ' + CurrentDurationValue);
				}
//---changeDuration<




//---blurDuration>
			window.blurDuration = function blurDuration() {
					//console.log(DurationValue);
					//var DurationValue = $(this)[0].defaultValue;
					if (!field)
						return false;
					console.log("Fiel " + field);
					var vExtract = field.split("_").pop();
					//console.log($("#"+field).val());
					if ($("#" + field).val().length <= 0) $("#" + field).val(DurationValue);
					UpdateEndByDuration(field);

					changeDico(vExtract);
				}
				//---blurDuration<

			//---clickimageContainer>
			window.clickimageContainer = function clickimageContainer() {
					$('#play').trigger('click');
				}
				//---clickimageContainer<

			//---ChangeStatus>
			window.ChangeStatus = function ChangeStatus() {
					var CurrentStatus = $(this);
					//console.log(CurrentStatus);
				}
//---ChangeStatus<




//---clickdico>
			window.clickdico = function clickdico(vExtract, isACK) {
					if (WF_DEBUG)
						console.info("clickdico(vExtract, isACK)", vExtract, isACK);

					var Agree = false;
					$(".myUpdatedTasks").fadeIn(4000);
					//$(".loader").show();
					//	$(".image-container1").show();
					/*
					$(".myUpdatedTasks").find('tr:not(:first)').each(function() {
						$(this).remove();
					});
					*/
					var TotalRows = false;
					//var idUpdate = $(this)[0].id;
					var myworktaskBoolean = $('#idTask_Duration_' + vExtract).attr('data-task');
					if (WF_DEBUG)
						console.info('Tasksboolean', myworktaskBoolean);
					//console.log(myworktaskBoolean);
					//	var vExtract = idUpdate.split("co").pop();
					var post_taskstatus = $("#selTaskStatus" + vExtract).val();
					var check_Duration = $("#idTask_Duration_" + vExtract).val();
					var SalesOrderId = $("#idTask_Duration_" + vExtract).attr("data-salesorder");

					function isInteger(x) {
						return x % 1 === 0;
					}

					if (!isInteger(check_Duration)) {
						if(WF_DEBUG)
							console.info('check_Duration',check_Duration);
						alert('The provided duration is not an integer/digit(s).');
						return false;
					}

					if (WF_DEBUG)
						console.info("beforeAgre", Agree);

					Agree = UpdateStartByDependency(vExtract, true);

					if (WF_DEBUG)
						console.info("AfterAgree", Agree);

					if (Agree) {
						// if (post_taskstatus == 2 || post_taskstatus == 4) {
						// 	if (confirm("You won\'t be able to update this task once the status changes to 'completed/cancelled'")) {
						// 		Agree = true;
						// 	} else {
						// 		Agree = false;
						// 		return false;
						// 	}
						// } else {
						// 	Agree = true;
						// }
					} else {

						if (WF_DEBUG)
							console.info("myworktaskBoolean", myworktaskBoolean);

						if (myworktaskBoolean == 'true') {
							// var slice = $('#ButtonLoadMoreAllWork').attr("data-slice");
							// slice = parseInt(slice-50);
							// getAllMyWork(0,whichStatusFilters,true);
							getAllMyWork(0, String(whichStatusFilters), true);
							if (WF_DEBUG)
								console.log("when is Updated ", whichStatusFilters);
						} else {
							clickinSO(SalesOrderId, true); // MERGE
						}
					}


					if (WF_DEBUG)
						console.info("AssignedExctrac", vExtract);
					//88888
					if (Agree) {
						var post_taskid = $("#vtaskID" + vExtract).html();
						var post_id = $("#selectAsignee" + vExtract).val();
						var post_ack = $("#Ack_" + vExtract).is(':checked');
						post_ack = !post_ack;
						// var post_name = getSelectText("#selectAsignee" + vExtract);
						//var post_startDate = $("#idPicker_StartDate_" + vExtract).children().eq(0).val();
						var stringDate = String($("#idPicker_StartDate_" + vExtract).val());
						//	var post_startDate = Datemasuno($("#idPicker_StartDate_" + vExtract).children().eq(0).val()).setHours(0, 0, 0, 0);
						var post_startDate = StringNetsuiteDateToDate($("#idPicker_StartDate_" + vExtract).val()).getTime();
						//var post_dueDate = Datemasuno($("#idPicker_DueDate_" + vExtract).children().eq(0).val()).setHours(23, 59, 59, 999);
						var post_dueDate = StringNetsuiteDateToDate($("#idPicker_DueDate_" + vExtract).val()).getTime();
						//var post_dueDate = Datemasuno($("#idPicker_DueDate_" + vExtract).children().eq(0).val()).setHours(0, 0, 0, 0);
						var post_WorkOnWeekends = $("#WorkOnWeekends_" + vExtract).is(':checked');
						var post_Duration = $("#idTask_Duration_" + vExtract).val();
						var wrikeid = $("#idTask_Duration_" + vExtract).attr("data-wrikeid");

						data = {
							'action': "task.change", //'salesorder': 329071,
							'salesorder': SalesOrderId,
							"assigned": post_id,
							"ack": post_ack,
							"status": post_taskstatus,
							"id": post_taskid,
							"duration": post_Duration,
							"weekend": post_WorkOnWeekends,
							"startdate": post_startDate,
							"duedate": post_dueDate,
							"wrikeid": wrikeid,
							"workspace": true
						};
						if (WF_DEBUG)
							console.info("Send Data:", data);

						if (WORKFORCE_MODE == WF_MODE_TESTING) {
							//if(WF_DEBUG)
							console.info('WORKFORCE_MODE is TESTING');
							return false; // Dont Save changes...
						}

						if (WF_DEBUG_AJAX)
							console.info("ajax action: task.change", getUrl().Common);

						$.ajax({
							url: getUrl().Common,
							type: 'POST',
							data: data,
							success: function(data) {

								if (isACK) {
									return false;
								}

								// console.log('*************************************');
								console.log(JSON.parse(data));
								// console.log('*************************************');
								var elParsed = JSON.parse(data);
								var size = Object.keys(elParsed).length;
								//console.log('Size: ' + size);
								//$(".loader").fadeOut();
								$('[id^=dico]').removeClass('GoUpdateEnable');
								$('[id^=dico]').addClass('GoUpdateDisabled');
								var WhichTasksWillChange = [];
								//if (size > 1) {
								for (var key in elParsed) {
									// Protect against inherited properties.
									if (elParsed.hasOwnProperty(key)) {
										if (elParsed[key].updated) {
											//console.log("Cambio StartDate :"+new Date(elParsed[key].odStartDate) + " -> "+ new Date(elParsed[key].startDate));
											// var toWoW = true;
											// if(elParsed[key].weekend == true){
											// 	toWoW = "<input disabled='disabled' type='checkbox' checked = 'checked'/>";
											// }else{
											// 	toWoW = "<input disabled='disabled' type='checkbox' />";
											// }
											// var toAck = true;
											// if(elParsed[key].ack == true){
											// 	toAck = "<input disabled='disabled' type='checkbox' checked = 'checked'/>";
											// }else{
											// 	toAck = "<input disabled='disabled' type='checkbox' />";
											// }
											// TotalRows = true;
											// //console.log(elParsed[key]);
											// var UpdateRow = $('tr[data-id=' + elParsed[key].id + ']');
											// var NewRow = '';
											// NewRow += '<tr>';
											// NewRow += '<td align="left">'+elParsed[key].name+'</td>';
											// NewRow += '<td align="center">' + elParsed[key].assigned+ '</td>';
											// NewRow += '<td align="center">' + toAck +'</td>';
											// NewRow += '<td align="center">' + elParsed[key].status+ '</td>';
											// NewRow += '<td align="center">' + formatDate(elParsed[key].odStartDate) + '</td>';
											// NewRow += '<td align="center">' + formatDate(elParsed[key].odDueDate) + '</td>';
											// NewRow += '<td align="center">' + formatDate(elParsed[key].startDate) + '</td>';
											// NewRow += '<td align="center">' + formatDate(elParsed[key].dueDate) + '</td>';
											// NewRow += '<td align="center">' + toWoW + '</td>';
											// NewRow += '<td align="center">' + elParsed[key].duration + '</td>';
											// NewRow += '</tr>';
											// $("table.myUpdatedTasks > tbody").append(NewRow);
											otherData = {
												'action': "update",
												"id": elParsed[key].id,
												"duration": elParsed[key].duration,
												"startdate": elParsed[key].startDate,
												"duedate": elParsed[key].dueDate,
												"currentpredecessor": elParsed[key].currentPredecessor,
												"currentdependency": elParsed[key].currentDependency,
												"updatedbytask": post_taskid,
												"pdstartdate": elParsed[key].pdStartDate,
												"pdduedate": elParsed[key].pdDueDate,
											};

											if (WF_DEBUG)
												console.info("ToUpdate", otherData);

											if (WF_DEBUG_AJAX)
												console.info("ajax action: update", getUrl().Common);

											$.ajax({
												url: getUrl().Common,
												type: 'POST',
												data: otherData,
												success: function(data) {
													if (WF_DEBUG)
														console.log("Returned Data 2 :" + data);
												}
											});

										}
									}
								}
								/* if (($("#selTaskStatus" + vExtract).val() == 4) || ($("#selTaskStatus" + vExtract).val() == 2)) {
							$("#selectAsignee" + vExtract).prop('disabled', true);
							$("#Ack_" + vExtract).prop('disabled', true);
							$("#selTaskStatus" + vExtract).prop('disabled', true);
							$("#idPicker_StartDate_" + vExtract).prop('disabled', true);
							$("#idPicker_DueDate_" + vExtract).prop('disabled', true);
							$("#WorkOnWeekends_" + vExtract).prop('disabled', true);
							$("#idTask_Duration_" + vExtract).prop('disabled', true);
						}
						if (!TotalRows) {
							//$(".myUpdatedTasks").show();
							$(".myUpdatedTasks").find('tr:not(:first)').each(function () {
								$(this).remove();
							});
							var thisRow = "<tr><td align='center' colspan ='10'>No successor(s) found</td></tr>";
							$("table.myUpdatedTasks > tbody").append(thisRow);
							//$('.image-container1').fadeOut(3000);
//							$(".myUpdatedTasks").fadeOut(3000);
						} */
								if (WF_DEBUG) console.info('myworktaskBoolean', myworktaskBoolean);
								if (myworktaskBoolean == 'true') {
									// var slice = $('#ButtonLoadMoreAllWork').attr("data-slice");
									// slice = parseInt(slice-50);
									// getAllMyWork(0,whichStatusFilters,true);
									getAllMyWork(0, String(whichStatusFilters), true);
									if (WF_DEBUG)
										console.log("when is Updated " + whichStatusFilters);
								} else {
									clickinSO(SalesOrderId, true); // MERGE
								}
								//$( "#play" ).trigger('click');
							},
							error: function(err) {
									console.log(err);
								} // success
						});
						return false;
					}
				}
//---clickdico<




//---clickinSO>
			window.clickinSO = function clickinSO(id, Reload) {
					
					if (WF_DEBUG)
						console.info("clickinSO(id, Reload)", id, Reload);

					if (!Reload) {
						$('#ButtonLoadMoreTasks').attr("data-slice", -1);
						setLevelLoader(3);
						$('span#msgSalesOrdersClick').fadeOut(9000); // Clears the Sales Order Message text
						ShowHideSaleOrderDetail(true); //New way todo this...
						//Para Obtener lista de los Departamentos disponibles en la SALES ORDER
						var constructorSelect4Department = '<label><select id="filterDepartment_' + id +
							'" name="filterDepartment" class="filterDepartment" style="height:32px"><option value="notuser0">- Filter by Deparment -</option><option value="notuser">All Departments</option>';
						constructorSelect4Department = constructorSelect4Department + getDepartmentOfProject(id);
						constructorSelect4Department = constructorSelect4Department + '</select></label>';
						$('.div-selectdepartment').html(constructorSelect4Department);
						ChangeTableAllServices(id);
						ChangeTableServiceAddresses(id);
						flatpickr('.toDatePickerFilter', {
							dateFormat: CalendarInputFormat
						}); // initialized picker
						//	NumberOfServiceAddresses(id);
						ChangeTableTasks(id, Pm, true);

					} else {
						setLevelLoader(3);
						if (arrayFilters.length)
							ChangeTableTasksParams(arrayFilters, Pm);
						else
							ChangeTableTasks(id, Pm, true);
					}

					var constructorSelect4Employees = '<label><select id="filterAsignee_' + id +
						'" name="filterAsignee" class="filterAsignee" style="height:32px"><option value="notuser0">- Filter by Assigned -</option><option value="notuser">All tasks</option><option value="onlymytasks">Only my tasks</option>';
					constructorSelect4Employees = constructorSelect4Employees + findEmployeesOfProject(id);
					constructorSelect4Employees = constructorSelect4Employees + '</select></label>';
					$('.div-selectassigned').html(constructorSelect4Employees);

					GetTaskTree(id);

					$('a#tabtogant3').attr('href', "/core/media/media.nl?id=6363364&c=3461650&h=d436a287ff7d831452fd&_xt=.html&so=" + id);
					$("html, body").animate({
						scrollTop: $('#NameSalesorderBySpan').offset().top
					}, 1000);


				}
//---clickinSO<

//---RESTCODE>
			window.setTimeout(function() {

				//$('#tabsalesord4').click();

				$('body').on('change', '.toggle-vis', function(e) {
					e.preventDefault();
					var selectColumn = $(this).attr('data-column');
					//console.log(selectColumn);
					var val = $(this)[0].checked;
					//console.log(table);
					if (selectColumn == "all") {
						for (var i = 2; i < 15; i++) {
							var column = table.column(i);
							column.visible(val);
							if (val) {
								$('.toggle-vis').prop('checked', true);
							} else {
								$('.toggle-vis').removeAttr('checked');
							}

						}
					} else {
						var column = table.column(selectColumn);
						//console.log(column);
						column.visible(val);
					}
					//return false;
				});
				// $('a.toggle-vis').on( 'click', function (e) {
				//        e.preventDefault();

				//        // Get the column API object
				//        var column = table.column( $(this).attr('data-column') );

				//        // Toggle the visibility
				//        column.visible( ! column.visible() );
				//    } );
				$('body').on('click', '.idClickToSalesOrder', function(e) {
					//$('.loader').fadein();
					//setTimeout(function() {
					//..setLevelLoader(6);
					var idSO = $(this).attr('data-salesorderID');
					//console.log("Data SO "+idSO);
					$('#tabtwo2').trigger('click');
					GetSalesOrdersbyID('salesorder', 'CurrentUser', 'OnPageLoad',true); // Obtener Mis Sales orders (CurrentUser);
					clickinSO(idSO);
					//},80);
				});
				//
				// $('body').on('click','#ButtonLoadAllMyWork',function(e){
				// 	getAllMyWork('all');
				// });

				// $('body').on('click', '#ButtonLoadMore', function(e) {
				// 	//console.log("D Slice "+$(this).attr("data-slice"));
				// 	var slice = $(this).attr("data-slice");
				// 	GetSalesOrdersbyID('allsalesorder', 'NotUser', 'SomeSOStatus', slice); // Obtener Todas las Sales Orders;
				// 	slice = (parseInt(slice) + 50);
				// 	$('#ButtonLoadMore').attr("data-slice", slice);
				// });

				$('body').on('click', '#ButtonLoadMoreAllWork', function(e) {
					console.log("D Slice " + $(this).attr("data-slice"));
					var slice = $(this).attr("data-slice");
					getAllMyWork(slice);
					slice = (parseInt(slice) + 50);
					$('#ButtonLoadMoreAllWork').attr("data-slice", slice);
				});

				$('body').on('click', '#ButtonLoadMoreTasks', function(e) {
					var lastFunction = $(this).attr("data-function");
					var So = $('[id^=filterAsignee_]').attr("id").split("filterAsignee_").pop();
					console.log(So);
					if (lastFunction == 1) {
						ChangeTableTasks(So, Pm);
					} else {
						SetTableTasksByFilters(true);
					}
				});

				$('body').on('click', '#ButtonLoadMore_salesorder', function(e) {
					GetSalesOrdersbyID('salesorder', 'CurrentUser', whichSOFilters,false);
				});

				$('body').on('click', '#ButtonLoadMore_Customsalesorder', function(e) {

				});

				$('body').on('click', '#ButtonLoadMore_allsalesorder', function(e) {
					GetSalesOrdersbyID('allsalesorder', 'NotUser', whichSOFilters2,false);
				});


				$('body').on('change', 'input[type="date"]', function(e) {
					//	console.log($(this));
					var id = $(this)[0].id;
					var vExtract = id.split("_").pop();
					var currentDate = $(this)[0].value;
					if (currentDate.length == 0) {
						var post_WorkOnWeekends = $("#WorkOnWeekends_" + vExtract).is(':checked');
						//console.log($("#WorkOnWeekends_" + vExtract));
						var startDate = ($("#idPicker_StartDate_" + vExtract).children().eq(0))[0].defaultValue;
						$("#idPicker_StartDate_" + vExtract).children().eq(0).val(formatDate(computeStart(new Date(startDate).getTime(), post_WorkOnWeekends)));
						var dueDate = $("#idPicker_DueDate_" + vExtract).children().eq(0).val();
						//$("#idPicker_DueDate_" + vExtract).children().eq(0).val(dueDate);
						//var duration = $("#idTask_Duration_" + vExtract)[0].defaultValue;
						//var post_Duration = $("#idTask_Duration_" + vExtract).val(duration);
						//UpdateEndByDuration(id);
						// var dur = recomputeDuration($("#idPicker_StartDate_" + vExtract).children().eq(0).val(),new Date(dueDate).getTime(),post_WorkOnWeekends);
						// $("#idTask_Duration_" + vExtract).val(dur);
					}
				});

				$('#filterButtonG').click(function(e) {
					e.preventDefault();
					SetTableTasksByFilters();
				});

				$('#filterButtonSO').click(function(e) {
					e.preventDefault();
					//var SOSelectionCurrUser = $('#multipleSelectSalesOrders').val();
					if (WF_DEBUG)
						console.log('whichSOFilters = ' + String(whichSOFilters));
					GetSalesOrdersbyID('salesorder', 'CurrentUser', whichSOFilters,true);
				});

				$('#filterButtonALLSO2').click(function(e) {
					e.preventDefault();
					//var SOSelectionCurrUser = $('#multipleSelectSalesOrders').val();
					if (WF_DEBUG)
						console.log('whichSOFilters2 = ' + String(whichSOFilters2));
					GetSalesOrdersbyID('allsalesorder', 'NotUser', whichSOFilters2,true);
				});

				$('#filterTaskStatus').click(function(e) {
					e.preventDefault();
					//var SOSelectionCurrUser = $('#multipleSelectSalesOrders').val();
					if (WF_DEBUG)
						console.log('whichStatusFilters = ' + String(whichStatusFilters));
					getAllMyWork(0, String(whichStatusFilters), true);
				});

				// Premium
				$('body').on('click', '#salesorder.table td', function(e) {
						var classNm = $(this)[0].className;
						if (WF_DEBUG)
							console.info( 'salesorder.table click detected in classNm:', classNm );
						if (classNm == 'styleToId') return false;
						var rowz = $(this).closest("tr");

						if ($(rowz).is(':first') != true) {
							GlobalEditing = true;
							// console.log($(this).attr('data-id'));
							var td0 = $(rowz).find('td:eq(0)').text();
							var td1 = $(rowz).find('td:eq(1)').text();
							var id = $(rowz).attr('data-id');
							//console.log(td0 + " " + td1);
							td0 = td0.replace(/\s+/g, '');
							$('#NameSalesorderBySpan').html("<span class='badge' style='font-size: 150%; text-align: left; font-weight: bold;  padding: 9px 12px; margin-right:4px;+'>" + td0.replace('&nbsp;&nbsp;', '') + "</span> " + td1);
							$('#IdSalesorderBySpan').text(id);
							clickinSO(id);
						}

					});

					$('body').on('click', '#Customsalesorder.table td', function(e) {
						var classNm = $(this)[0].className;
						//if (WF_DEBUG)
							console.info( 'Customsalesorder.table click detected in classNm:', classNm );
						if (classNm == 'styleToId') return false;
						var rowz = $(this).closest("tr");

						GlobalEditing = true;
						if ($(rowz).is(':first') != true) {
							var td0 = $(rowz).find('td:eq(0)').text();
							var td1 = $(rowz).find('td:eq(1)').text();
							var id = $(rowz).attr('data-id');
							//console.log(td0 + " " + td1);
							td0 = td0.replace(/\s+/g, '');
							$('#NameSalesorderBySpan').html("<span class='badge' style='font-size: 150%; text-align: left; font-weight: bold;  padding: 9px 12px; margin-right:4px;+'>" + td0.replace('&nbsp;&nbsp;', '') + "</span> " + td1);
							$('#IdSalesorderBySpan').text(id);
							clickinSO(id);
						}
					});

					$('body').on('click', '#allsalesorder.table td', function(e) {
						var classNm = $(this)[0].className;
						if (WF_DEBUG)
							console.info( 'allsalesorder.table click detected in classNm:', classNm );
						if (classNm == 'styleToId') return false;
						var rowz = $(this).closest("tr");
						if (WF_DEBUG)
							console.info( 'rowz detected', rowz );
						GlobalEditing = true;
						if ($(rowz).is(':first') != true) {
							var td0 = $(rowz).find('td:eq(0)').text();
							var td1 = $(rowz).find('td:eq(1)').text();
							var id = $(rowz).attr('data-id');
							//console.log(td0 + " " + td1);
							td0 = td0.replace(/\s+/g, '');
							$('#NameSalesorderBySpan').html("<span class='badge' style='font-size: 150%; text-align: left; font-weight: bold;  padding: 9px 12px; margin-right:4px;+'>" + td0.replace('&nbsp;&nbsp;', '') + "</span> " + td1);
							$('#IdSalesorderBySpan').text(id);
							clickinSO(id);
						}
					 });

					/* Original con Clic en ROW

					--------------------------------------
					$('body').on('click', '#salesorder.table > tbody > tr', function(e) {
						if ($(this).is(':first') != true) {
							GlobalEditing = true;
							// console.log($(this).attr('data-id'));
							var td0 = $(this).find('td:eq(0)').text();
							var td1 = $(this).find('td:eq(1)').text();
							var id = $(this).attr('data-id');
							//console.log(td0 + " " + td1);
							td0 = td0.replace(/\s+/g, '');
							$('#NameSalesorderBySpan').html("<span class='badge' style='font-size: 150%; text-align: left; font-weight: bold;  padding: 9px 12px; margin-right:4px;+'>" + td0.replace('&nbsp;&nbsp;', '') + "</span> " + td1);
							$('#IdSalesorderBySpan').text(id);
							clickinSO(id);
						}
					});

					--------------------------------------
					$('body').on('click', '#Customsalesorder.table > tbody > tr', function(e) {
						GlobalEditing = true;
						if ($(this).is(':first') != true) {
							var td0 = $(this).find('td:eq(0)').text();
							var td1 = $(this).find('td:eq(1)').text();
							var id = $(this).attr('data-id');
							//console.log(td0 + " " + td1);
							td0 = td0.replace(/\s+/g, '');
							$('#NameSalesorderBySpan').html("<span class='badge' style='font-size: 150%; text-align: left; font-weight: bold;  padding: 9px 12px; margin-right:4px;+'>" + td0.replace('&nbsp;&nbsp;', '') + "</span> " + td1);
							$('#IdSalesorderBySpan').text(id);
							clickinSO(id);
						}
					});

					--------------------------------------

					$('body').on('click', '#allsalesorder.table > tbody > tr', function(e) {
						GlobalEditing = true;
						if ($(this).is(':first') != true) {
							var td0 = $(this).find('td:eq(0)').text();
							var td1 = $(this).find('td:eq(1)').text();
							var id = $(this).attr('data-id');
							//console.log(td0 + " " + td1);
							td0 = td0.replace(/\s+/g, '');
							$('#NameSalesorderBySpan').html("<span class='badge' style='font-size: 150%; text-align: left; font-weight: bold;  padding: 9px 12px; margin-right:4px;+'>" + td0.replace('&nbsp;&nbsp;', '') + "</span> " + td1);
							$('#IdSalesorderBySpan').text(id);
							clickinSO(id);
						}
					 });

					*/

				$('body').on('click', '#tabone', function(e) {
					if (!($.fn.dataTable.isDataTable('#AllMyWork'))) {
						getAllMyWork(0, 1);
					}
					/* Hide all tables of task information */
					ShowHideSaleOrderDetail(false); //New way todo this...
				});

				$('body').on('click', '#tabtwo', function(e) {

					if (!($.fn.dataTable.isDataTable('#allsalesorder'))) {
						GetSalesOrdersbyID('salesorder', 'CurrentUser', 'OnPageLoad',false);
						// Obtener Mis Sales orders (CurrentUser);
					}

					if (GlobalEditing) {
						/*Show all tables of task information */
						ShowHideSaleOrderDetail(true); //New way todo this...
					}

				});
				$('body').on('click', '#tabfour', function(e) {
					if (GlobalEditing) {
						/*Show all tables of task information */
						ShowHideSaleOrderDetail(false); //New way todo this...
					}
				});

				$('body').on('click', '#tabfive', function(e) {
					if (!($.fn.dataTable.isDataTable('#allsalesorder'))) {
						whichSOFilters2
						GetSalesOrdersbyID('allsalesorder', 'NotUser', String(whichSOFilters2),false); // Obtener Todas las Sales Orders;
					}
				});

				$('body').on('click', '.tabso3', function(e) {
					/* Hide all tables of task information */
					ShowHideSaleOrderDetail(false); //New way todo this...
					// Start of My Team Tab //
					var counSO = 0;
					var counSA = 0;
					var counADD = 0;
					var counPLA = 0;
					if (!($.fn.dataTable.isDataTable('#tableSOcount'))) {
						var tablaPint = $('#tableSOcount').DataTable({
							"searching": true,
							"scrollCollapse": true,
							"bInfo": false,
							"paging": false,
							"order": [
								[1, 'asc']
							],
							"footerCallback": function(row, data, start, end, display) {
								var apiSoMyTeam = this.api(),
									data;
								// Remove the formatting to get integer data for summation
								var intVal = function(i) {
									return typeof i === 'string' ?
										i.replace(/[\$,]/g, '') * 1 :
										typeof i === 'number' ?
										i : 0;
								};
								pageTotal = apiSoMyTeam.column(4, {
									page: 'current'
								}).data().reduce(function(a, b) {
									return intVal(a) + intVal(b);
								}, 0);
								$(apiSoMyTeam.column(4).footer()).html('<span class="badge">' + pageTotal + '</span>');
								pageTotal = apiSoMyTeam.column(3, {
									page: 'current'
								}).data().reduce(function(a, b) {
									return intVal(a) + intVal(b);
								}, 0);
								$(apiSoMyTeam.column(3).footer()).html('<span class="badge">' + pageTotal + '</span>');
								pageTotal = apiSoMyTeam.column(2, {
									page: 'current'
								}).data().reduce(function(a, b) {
									return intVal(a) + intVal(b);
								}, 0);
								$(apiSoMyTeam.column(2).footer()).html('<span class="badge">' + pageTotal + '</span>');
								pageTotal = apiSoMyTeam.column(1, {
									page: 'current'
								}).data().reduce(function(a, b) {
									return intVal(a) + intVal(b);
								}, 0);
								$(apiSoMyTeam.column(1).footer()).html('<span class="badge">' + pageTotal + '</span>');
							}
						}); // END of My Team Tab ( tablaPint )

						if (WF_DEBUG_AJAX)
							console.info("ajax action: getAllSalesOrder", getUrl().RT3);

						//Call first serach PM ----------------------------------------
						$.ajax({
							url: getUrl().RT3,
							data: {
								'action': 'getAllSalesOrder'
							},
							async: true,
							// dataType: 'json',
							dataType: 'text',
							success: function(data) {
								data = CleanResponseData(data);
								var row = '';
								var counter = 0;
								data.forEach(function(result) {
									var empPM = result.empPM;
									var empPMText = result.empPMText;
									var countSO = result.countSO;
									var add = result.add;
									var items = result.items;
									var plan = result.plan;
									var callFunction = "<a class='myTeamLink' onclick='showSecondTable(" + empPM + ");''>" + empPMText + "</a>";
									var row = tablaPint.row.add([callFunction, countSO, add, items, plan]).draw(false);
									//SUM ALL Quantites
									counSO += parseInt(result.countSO);
									counSA += parseInt(result.add);
									counADD += parseInt(result.items);
									counPLA += parseInt(result.plan);
								});
								$('#tableSOcount').show();
							},
							error: function(err) {
								console.log('err', err);
							},
							complete: function() {
								$("#tableSOcount tbody tr").addClass("firstTdSoCount");
							}
						});
					}
				});

				$('body').on('click', '#dicoTreeTask1', function(e) {
					//$(".image-container1").show();
					var TotalRows = false;
					var idUpdate = $(this)[0].id;
					var vExtract = idUpdate.split("co").pop();
					var post_taskid = $("#vtaskID" + vExtract).html();
					var post_id = $("#selectAsignee" + vExtract).val();
					var post_ack = $("#Ack_" + vExtract).is(':checked');
					var post_taskstatus = $("#selTaskStatus" + vExtract).val();
					// var post_name = getSelectText("#selectAsignee" + vExtract);
					var stringDate = String($("#idPicker_StartDate_" + vExtract).children().eq(0).val());
					var post_startDate = Datemasuno($("#idPicker_StartDate_" + vExtract).children().eq(0).val()).setHours(0, 0, 0, 0);
					var post_dueDate = Datemasuno($("#idPicker_DueDate_" + vExtract).children().eq(0).val()).setHours(0, 0, 0, 0);
					var post_WorkOnWeekends = $("#WorkOnWeekends_" + vExtract).is(':checked');
					var post_Duration = $("#idTask_Duration_" + vExtract).val();
					var SalesOrderId = $("#idTask_Duration_" + vExtract).attr("data-salesorder");
					var wrikeid = $("#idTask_Duration_" + vExtract).attr("data-wrikeid");
					//console.log("Wrikeid "+wrikeid)
					data = {
						'action': "task.change",
						'salesorder': SalesOrderId,
						"assigned": post_id,
						"ack": post_ack,
						"status": post_taskstatus,
						"id": post_taskid,
						"duration": post_Duration,
						"weekend": post_WorkOnWeekends,
						"startdate": post_startDate,
						"duedate": post_dueDate,
						"wrikeid": wrikeid,
						"workspace": true
					};

					if (WF_DEBUG)
						console.info("sending data", data);

					if (WF_DEBUG_AJAX)
						console.info("ajax action: task.change", getUrl().Common);

					$.ajax({
						url: getUrl().Common,
						type: 'POST',
						data: data,
						success: function(data) {
							GetTaskTree(SalesOrderId);
							showPress(post_taskid, 'customrecord_task_predecessor', 'custrecord_tp_parent', 'custrecord_tp_predecessor', "treePredecessor", true);
							showSucc(post_taskid, 'customrecord_task_successor', 'custrecord_ts_parent', 'custrecord_ts_successor', 'treeSuccessor', true);
							var elParsed = JSON.parse(data);
							var size = Object.keys(elParsed).length;
							$('[id^=dico]').removeClass('GoUpdateEnable');
							$('[id^=dico]').removeClass('GoUpdateDisabled');
							//	var elParsed = JSON.parse(data);
							var TotalRows = false;
							var size = Object.keys(elParsed).length;
							//console.log('Size: ' + size);
							//$(".loader").fadeOut();
							$('[id^=dico]').removeClass('GoUpdateEnable');
							$('[id^=dico]').removeClass('GoUpdateDisabled');
							var WhichTasksWillChange = [];
							//if (size > 1) {
							for (var key in elParsed) {
								// Protect against inherited properties.
								if (elParsed.hasOwnProperty(key)) {
									if (elParsed[key].updated) {
										otherData = {
											'action': "update",
											"id": elParsed[key].id,
											"duration": elParsed[key].duration,
											"startdate": elParsed[key].startDate,
											"duedate": elParsed[key].dueDate,
											"currentpredecessor": elParsed[key].currentPredecessor,
											"currentdependency": elParsed[key].currentDependency,
											"updatedbytask": post_taskid,
											"pdstartdate": elParsed[key].pdStartDate,
											"pdduedate": elParsed[key].pdDueDate,
										};

										if (WF_DEBUG_AJAX)
											console.info("ajax action: update", getUrl().Common);

										$.ajax({
											url: getUrl().Common,
											type: 'POST',
											data: otherData,
											success: function(data) {
												if (WF_DEBUG_AJAX)
													console.log("Returned Data 2 :" + data);
											}
										});
									}
								}
							}
						},
						error: function(e) {
							console.info("Can Not Update Data", e);
						}
					});
					// $("#dicoTreeTask1").removeClass('GoUpdateEnable'); // MERGE
					// $("#dicoTreeTask1").addClass('filterButton'); 	// MERGE
					// $("#dicoTreeTask1").hide(); // MERGE
					//		GetTaskTree(SalesOrderId);
				});
				
				$('body').on('click', 'a.toOpenWrike', function(e) {
					e.preventDefault();
					var url = ""
					var wrikeid = $(this).attr('data-wrikeid');
					var Taskid = $(this).attr('data-taskid');

					openWrikeComment(wrikeid, Taskid);

					return false;
				});

				window.openWrikeComment = function(wrikeid, Taskid, fromtree) {
					if (!wrikeid) {
						if (!fromtree) {
							url = '/app/crm/calendar/task.nl?id=' + Taskid + '&whence=';
							var win = window.open(url, '_blank');
							win.focus();
						}

					} else {
						//	url = '/app/site/hosting/scriptlet.nl?script=1393&deploy=1&pop=T&taskid='+wrikeid+'&ifrmcntnr=T&folder=F';
						//	url = getUrl().wrike+'&pop=T&taskid=IEAABMCWKQDM736U&ifrmcntnr=T&folder=F';
						console.log()
						url = getUrl().wrike + '&deploy=1&pop=T&taskid=' + wrikeid + '&ifrmcntnr=T&folder=F';
						var foundSinc = false;
						var datos = {
							'action': 'getSincronWithWrike'
						};

						if (WF_DEBUG_AJAX)
							console.info("ajax action: getSincronWithWrike", url);

						$.ajax({
							url: getUrl().BSL,
							type: 'POST',
							data: datos,
							success: function(data) {
								console.log("Wrikesin" + data);
								foundSinc = data;
							}
						});

						if (fromtree) {
							url += '&workforce=T';
							$("#wrike_comment_iframe").attr("src", url).show();
						} else {
							nlExtOpenWindow(url, 'Comment', 700, 350);
							$('.x-shadow').css('top', '150px');
						}
					}
				}

				$('#selMyTeam').css('height', '32px'); // Work OK
				$('#selMyTeam').css('width', '320px'); // Work OK
				$('#multipleSelectSalesOrders').parent().css('width', '70%'); // Work OK
				$('#multipleSelectSalesOrders2').parent().css('width', '70%'); // Work OK
				$('#multipleSelectStatus').parent().css('width', '70%'); // Work OK

				$('body').on('change', '#selMyTeam', function(e) {
					var id = $(this)[0].value;
					$('.dataTables_scrollFoot').hide();
					//console.log("ID selected from list is: " + id);
					//GetSalesOrdersbyID('Customsalesorder',id);
					GetSalesOrdersbyID('Customsalesorder', id, 'SomeSOStatus',true);
					//Alex 75404   Jesus  75408
				});

				function UpdateStartByDuration(idInput) {
					var num = String(idInput).split('_').pop();
					/* var p1 = arrayString[1];
					var num = arrayString[2]; */
					var idDueDate = '#idPicker_DueDate_' + num;
					var idStartDate = '#idPicker_StartDate_' + num;
					var idDuration = '#idTask_Duration_' + num;
					var isChecked = $('input[id=WorkOnWeekends_' + num + ']').is(':checked');
					var due = new Date($(idDueDate).children().eq(0).val());
					var Start = new Date($(idStartDate).children().eq(0).val());
					var Duration = $(idDuration).val();
					var StartDate = new Date(computeStartByDuration(due.getTime(), Duration, isChecked, 0));
					$(idStartDate).children().eq(0).val(formatDate(StartDate));
				}

				/* function dhm(t) {
					var cd = 24 * 60 * 60 * 1000,
						ch = 60 * 60 * 1000,
						d = Math.floor(t / cd),
						h = Math.floor((t - d * cd) / ch),
						m = Math.round((t - d * cd - h * ch) / 60000),
						pad = function(n) {
							return n < 10 ? '0' + n : n;
						};
					if (m === 60) {
						h++;
						m = 0;
					}
					if (h === 24) {
						d++;
						h = 0;
					}
					return d + 1;
				}

				function getSelectText(selId) {
					var sel = document.getElementById(selId);
					var i = sel.selectedIndex;
					var selected_text = sel.options[i].text;
					return selected_text;
				}

				function formatDate(date) {
					var d = new Date(date),
						month = '' + (d.getMonth() + 1),
						day = '' + d.getDate(),
						year = d.getFullYear();
					if (month.length < 2) month = '0' + month;
					if (day.length < 2) day = '0' + day;
					return [year, month, day].join('-');
				}

				function isHoliday(date, weekend) {
					var friIsHoly = false;
					var satIsHoly = !weekend;
					var sunIsHoly = !weekend;
					pad = function(val) {
						val = "0" + val;
						return val.substr(val.length - 2);
					};
					var holidays = "#01_01#12_25#";
					var ymd = "#" + date.getFullYear() + "_" + pad(date.getMonth() + 1) + "_" + pad(date.getDate()) + "#";
					var md = "#" + pad(date.getMonth() + 1) + "_" + pad(date.getDate()) + "#";
					var day = date.getDay();
					return (day == 5 && friIsHoly) || (day == 6 && satIsHoly) || (day == 0 && sunIsHoly) || holidays.indexOf(ymd) > -1 || holidays.indexOf(md) > -1;
				}
				*/
				
				//Metodo para Obtener los dias de duracion, dependiendo de la fecha de inicio, fecha de termino y si fin de semana (False, True)
				function recomputeDuration(start, end, weekend) {
					Date.prototype.distanceInWorkingDays = function(toDate) {
						var pos = new Date(this.getTime());
						pos.setHours(23, 59, 59, 999);
						var days = 0;
						var nd = new Date(toDate.getTime());
						nd.setHours(23, 59, 59, 999);
						var end = nd.getTime();
						while (pos.getTime() <= end) {
							days = days + (isHoliday(pos, weekend) ? 0 : 1);
							pos.setDate(pos.getDate() + 1);
						}
						return days;
					};
					//console.debug("recomputeDuration");
					return new Date(start).distanceInWorkingDays(new Date(end));
				}
				//Componer fecha Inicio
				function computeStartByDuration(end, duration, weekend) {
					weekend = (typeof weekend === 'undefined') ? false : weekend;
					var d = new Date(end);
					//console.debug("computeStartByDuration start ",d,duration)
					var q = duration - 1;
					while (q > 0) {
						d.setDate(d.getDate() - 1);
						if (!isHoliday(d, weekend)) q--;
					}
					d.setHours(23, 59, 59, 999);
					return d.getTime();
				}

				function computeStartDate(start, weekend, plus) {
					var d = new Date(start + 3600000 * plus);
					d.setHours(0, 0, 0, 0);
					//move to next working day
					/*
					while (isHoliday(d)) {
						d.setDate(d.getDate() + 1);
					}*/
					for (; isHoliday(d, weekend) != false;) {
						d.setDate(d.getDate() + 1);
					}
					d.setHours(0, 0, 0, 0);
					return d;
				}
				//Verificar Fecha de inicio, con WEEKEND, para determinar que dia recorrerla
				function computeStart(start, weekend, plus) {
					weekend = weekend || false;
					plus = plus || 12;
					return computeStartDate(start, weekend, plus).getTime();
				}

//---UpdateStartByDependency>
				window.UpdateStartByDependency = function(idInput, doSplit) {
					//First step : Get values from predecessor object
					if (WF_DEBUG)
						console.info("IdInput ", idInput);

					var p1 = "";
					var num = idInput;

					if (!doSplit) {
						arrayString = String(idInput).split('_');
						p1 = arrayString[1];
						num = arrayString[2];
					}

					var idStartDate = '#idPicker_StartDate_' + num;
					var idDuration = '#idTask_Duration_' + num;
					if (WF_DEBUG)
						console.info("idDuration", idDuration);

					var dependency = $(idDuration).attr("data-dependency");
					var predecessor = $(idDuration).attr("data-predecessor");
					//	var Start = new Date($(idStartDate).children().eq(0).val());
					var Start = StringNetsuiteDateToDate($(idStartDate).val());
					if(WF_DEBUG)
					 	console.info('dependency =', dependency);

					if (dependency == 'finishToStart') {
						//	console.log("El predecesor no debe ser menor a la fecha seleccionada");
						var p = getDatafromPredecessor(predecessor);
						if (p[0].duedate >= Start.getTime()) {
							if (WF_DEBUG)
								console.log('UpdateStartByDependency',"Alcanzo a predecesor");
							alert("The following task is preventing you to update the stardate \n" + p[0].title + " \nDue date : " + formatDate(p[0].duedate));
							return false;
						} else {
							if (WF_DEBUG)
								console.log('UpdateStartByDependency',"No alcanzo a predecesor");
							return true;
						}
					} else if (dependency == 'startToStart') {
						if (WF_DEBUG)
							console.log("Start date was not be able to be modified");
						return false;
					} else {
						// alert("This Task has not dependency -"+idInput);
						return true;
					}
					//console.log("Duedate : "+new Date(p[0].duedate) + " : " + Start);
				}
//---UpdateStartByDependency>


				function UpdatewithDurationbyDependency(Input) {
					//First step : Get values from predecessor object
					var arrayString = String(Input).split('_');
					var p1 = arrayString[1];
					var num = arrayString[2];
					var idDuration = '#idTask_Duration_' + num;
					var dependency = $(idDuration).attr("data-dependency");
					var predecessor = $(idDuration).attr("data-predecessor");
					if (dependency == "finishToStart" || dependency == "startToStart") {
						UpdateEndByDuration(Input);
					} else if (dependency == "finishToFinish" || dependency == "startToFinish") {
						UpdateStartByDuration(Input);
					} else {
						UpdateEndByDuration(Input);
					}
				}
				////////////////////////////////
				function UpdateDurationbyStart(idInput, WorkWeekend) {
					var arrayString = String(idInput).split('_');
					var p1 = arrayString[1];
					var num = arrayString[2];
					var idDueDate = '#idPicker_DueDate_' + num;
					var idStartDate = '#idPicker_StartDate_' + num;
					var idDuration = '#idTask_Duration_' + num;
					var isChecked = $('input[id=WorkOnWeekends_' + num + ']').is(':checked');
					var Start = new Date($(idStartDate).children().eq(0).val());
					//	var Duration = $(idDuration).children().eq(0).val();
					var Duration = $(idDuration).val();
					var due = new Date($(idDueDate).children().eq(0).val());
					//alert($(idWorkWeekend).val());
					var StarDateWithcWeekend = computeStart(Start.getTime(), isChecked);
					$(idStartDate).children().eq(0).val(formatDate(StarDateWithcWeekend));
					//var Start2 = new Date($(idStartDate).children().eq(0).val());
					//console.log('Change Start Date : ' + formatDate(StarDateWithcWeekend) + " : " + StarDateWithcWeekend);
					var Totalduration = recomputeDuration(StarDateWithcWeekend, due.getTime(), isChecked);
					//$(idDuration).children().eq(0).val(Totalduration);
					$(idDuration).val(Totalduration);
					//console.log('Change Duration : ' + Totalduration);
				}

				var CurrentDueDate, CurrentStartDate, DurationValue;
				$('[id^=selectAsignee]').on("change", function(e) {
					var idparent = e.target.id;
					var vExtract = idparent.split("Asignee").pop();
					changeDico(vExtract);
					return false;
				});
				$('[id^=selTaskStatus]').on("change", function(e) {
					var idparent = e.target.id;
					var vExtract = idparent.split("lTaskStatus").pop();
					changeDico(vExtract);
					return false;
				});
				$('[id^=idPicker_DueDate]').on("focus", function(e) {
					CurrentDueDate = $(this).val();
				});
				$('[id^=idPicker_StartDate]').on("focus", function(e) {
					CurrentStartDate = $(this).val();
					//console.log(CurrentStartDate);
				});
				$('[id^=idPicker_DueDate]').on("change", function(e) {
					var idparent = e.target.id;
					//alert(UpdateDuration(idparent));
					var vExtract = idparent.split("_").pop();
					if (UpdateDuration(idparent, WorkWeekend) == 0) {
						alert("La fecha final no puede ser menor a la fecha de inicio");
						$(this).val(CurrentDueDate);
						return false;
					}
					changeDico(vExtract);
					return false;
				});
				$('[id^=WorkOnWeekends_]').on("change", function(e) {
					var idCheck = e.target.id;
					var vExtract = idCheck.split("_").pop();
					var isChecked = $('input[id=WorkOnWeekends_' + vExtract + ']').is(':checked');
					//If the field WorkWeeken is Checked the Dates should be Update to beyond date
					var idDueDate = '#idPicker_DueDate_' + vExtract;
					var idStartDate = '#idPicker_StartDate_' + vExtract;
					var idDuration = '#idTask_Duration_' + vExtract;
					var due = new Date($(idDueDate).children().eq(0).val());
					var Start = new Date($(idStartDate).children().eq(0).val());
					//var Duration = $(idDuration).children().eq(0).val();
					var Duration = $(idDuration).val();
					var StarDateWithcWeekend = computeStart(Start.getTime(), isChecked);

					$(idStartDate).children().eq(0).val(formatDate(StarDateWithcWeekend));
					var dependency = $(idDuration).attr("data-dependency");
					var predecessor = $(idDuration).attr("data-predecessor");
					/* if(dependency=="finishToStart" || dependency=="startToStart"){
						var Start2 = new Date($(idStartDate).children().eq(0).val());
						var DueDateWithcWeekend = computeEndByDuration(Start2.getTime(), Duration, isChecked, 0);
						$(idDueDate).children().eq(0).val(formatDate(DueDateWithcWeekend));
					}else if (dependency=="finishToFinish" || dependency=="startToFinish"){
					} */
					if (dependency == "finishToStart" || dependency == "startToStart") {
						UpdateEndByDuration(idCheck);
						//console.log("Llego" + idCheck);
					} else if (dependency == "finishToFinish" || dependency == "startToFinish") {
						UpdateStartByDuration(idCheck);
					}
					changeDico(vExtract);
					return false;
				});
				$('[id^=Ack_]').on("change", function(e) {
						var idCheck = e.target.id;
						var vExtract = idCheck.split("_").pop();
						changeDico(vExtract);
						return false;
					})
					
				$('[idTask_Duration_]').on("focus", function(e) {
					DurationValue = $(this).val();
					//console.log("Se obtuvo :" + DurationValue);
				});
				$('[id^=idTask_Duration_]').bind('keyup', function(e) {
					var idparent = e.target.id;
					var vExtract = idparent.split("_").pop();

					var CurrentDurationValue = $(this).val();
					//console.log("Last Duration : "+ DurationValue + " New Duration :"+CurrentDurationValue);
					if (CurrentDurationValue.length > 0 && CurrentDurationValue < 1) {
						$(this).val(DurationValue);
					} else if (CurrentDurationValue >= 100) {
						$(this).val(DurationValue);
					} else if (CurrentDurationValue.length == 0) {} else {
						UpdatewithDurationbyDependency(e.target.id);
						//UpdateEndByDuration(e.target.id);
						//console.log(e.target.id);
					}
					changeDico(vExtract);
					//console.log('change : ' + CurrentDurationValue);
				});
				$('[id^=idTask_Duration_]').on('blur', function(event) {
					if ($(this).val().length <= 0) $(this).val(DurationValue);
				});
				
				window.EnabledAndDisabledDateFilter = function EnabledAndDisabledDateFilter() {
					var DatesEnabled = $(this).is(':checked');
					//console.log(DatesEnabled);
					if (!DatesEnabled) {
						$('#filterStartDate').prop("disabled", true);
						$('#filterDueDate').prop("disabled", true);
					} else {
						$('#filterStartDate').prop("disabled", false);
						$('#filterDueDate').prop("disabled", true);
					}
				}
				window.getIp = function getIp() {
					$.getJSON("https://api.ipify.org?format=json", function(data) {
						//console.log(data.ip);
						var userIP = data.ip;
					});
					return userIP;
				}
				window.SetTableTasksByFilters = function SetTableTasksByFilters(bybutton) {
					if (WF_DEBUG)
						console.info('SetTableTasksByFilters(bybutton)', bybutton);
					//alert('Calling function...');
					arrayFilters = [];
					if (!bybutton) {
						$('#mytblTasks tbody tr').remove();
						$('#ButtonLoadMoreTasks').attr("data-slice", -1);
					}
					var WhoFilterSO = $('[id^=filterAsignee_]').attr("id").split("filterAsignee_").pop();
					//console.log('Your SO selected to filter is '+WhoFilterSO);
					var WhoFilterAsignee = $("[id^=filterAsignee_]").val();
					var WhoFilterDepartment = $("[id^=filterDepartment_]").val();
					//console.log('Your asigneed person to filter is '+WhoFilterAsignee);
					var WhoFilterTask = $("#filterTask").val();
					//console.log('Your task status  to filter is '+WhoFilterTask);
					var regex = new RegExp("-", "g");
					var WhoFilterSD = ($('#filterStartDate').val() != '') ? formatDate(StringNetsuiteDateToDate($('#filterStartDate').val()).getTime()) : '';
					//console.log('Your start date to filter is '+WhoFilterSD);
					var WhoFilterDD = ($('#filterDueDate').val() != '') ? formatDate(StringNetsuiteDateToDate($('#filterDueDate').val()).getTime()) : '';
					//console.log('Your due date to filter is '+WhoFilterDD);
					var WhoFilterWoW = $('#filterWoW').is(':checked');
					//console.log('Your WoW to filter is '+WhoFilterWoW);
					var WhoFilterDurationFrom = $("[id^=filterDurationStart]").val();
					//console.log('Your duration from to filter is '+WhoFilterDurationFrom);
					var WhoFilterDurationTo = $("[id^=filterDurationEnd]").val();

					var whoFilterItemId = $("#selServices").val();

					var whoFilterIdAdress = $("#selAdresses").val();
					//console.log('Your duration until, to filter is '+WhoFilterDurationTo);
					arrayFilters.push(WhoFilterSO);
					arrayFilters.push(WhoFilterAsignee);
					arrayFilters.push(WhoFilterTask);
					if (WF_DEBUG)
						console.log('WhoFilterTask:', WhoFilterTask);
					arrayFilters.push(WhoFilterSD);
					arrayFilters.push(WhoFilterDD);
					arrayFilters.push(WhoFilterWoW);
					arrayFilters.push(WhoFilterDurationFrom);
					arrayFilters.push(WhoFilterDurationTo);
					arrayFilters.push(WhoFilterDepartment);
					arrayFilters.push(whoFilterItemId);
					arrayFilters.push(whoFilterIdAdress);
					//console.log(arrayFilters);

					ChangeTableTasksParams(arrayFilters, Pm);
					return false;
				}
				window.Reset = function Reset() {
					$('[id^=filterAsignee_]').val("notuser0");
					$('[id^=filterDepartment]').val("notuser0");
					$('[id^=filterTask]').val("notstatus");
					$('#filterStartDate').val('');
					$('#filterDueDate').val('');
					$("#filterWoW").attr('checked', false);
					$("#filterDurationStart").val('');
					$("#filterDurationEnd").val('');
					$("#selServices").val('');
					$("#selAdresses").val('');
					return false;
				}
				var formatter = new Intl.NumberFormat('en-US', {
					style: 'currency',
					currency: 'USD',
					minimumFractionDigits: 2,
				});
				$('.thetabsalesorders .tabtogsales-links a').on('click', function(e) {
					var currentAttrValue = $(this).attr('href');
					// Show/Hide thetabsalesorders
					//  jQuery('.thetabsalesorders ' + currentAttrValue).show().siblings().hide();
					// Show/Hide Tabs
					$('.thetabsalesorders ' + currentAttrValue).slideDown(400).siblings().slideUp(400);
					// Change/remove current tabtogant to active
					$(this).parent('li').addClass('active').siblings().removeClass('active');
					e.preventDefault();
				});
				$('.thetabtogants .tabtogant-links a').on('click', function(e) {
					var currentAttrValue = $(this).attr('href');
					$('.thetabtogants ' + currentAttrValue).slideDown(400).siblings().slideUp(400);
					// Change/remove current tabtogant to active
					$(this).parent('li').addClass('active').siblings().removeClass('active');
					e.preventDefault();
				});
				// No borrar $('[id^=dico'+Xs+'].GoUpdateEnable').show();
				//
				$("ul .dtab2").click(function() {
					$(".dhxtreeview_cont").css('width', '100%');
					$(".dhxtreeview_cont").css('height', '100%');
				});
				$('.dataTables_scrollBody').css('overflow-x', 'hidden');

				$('.select2-search__field').attr("placeholder", " * Filter by status of the Sales Orders by clicking on this field");

				$('#tableSOcount_filter input[type="search"]').after(
					'  <img id="mymicrophone" style="width:14px;height: 50%;" onclick="startDictation(\'salesorder\')" src="https://system.sandbox.netsuite.com/core/media/media.nl?id=6526112&c=3461650&h=270cf9836f9974d10a59">');

				$('#salesorder_filter input[type="search"]').after(
					'  <img id="mymicrophone" style="width:14px;height: 50%;" onclick="startDictation(\'salesorder\')" src="https://system.sandbox.netsuite.com/core/media/media.nl?id=6526112&c=3461650&h=270cf9836f9974d10a59">');
				var DoWeHaveRecords = $("#salesorder td.dataTables_empty").html();
				if (DoWeHaveRecords == 'No data available in table') {
					$("#salesorder td.dataTables_empty").html('<span style="font-size: 16px;">  Not found recordswith this filter, try with another...   </span>');
				}

				// Language strings update on load
				$('#msgSalesOrdersClick').html(messages.click_any_os);
				$('.talknow').html(messages.talk_now);

				window.getFields = function(vExtract) {
					var post_taskid = $("#vtaskID" + vExtract).html();
					var post_id = $("#selectAsignee" + vExtract).val();
					var post_ack = $("#Ack_" + vExtract).is(':checked');
					var post_name = getSelectText("#selectAsignee" + vExtract);
					//var post_startDate = $("#idPicker_StartDate_" + vExtract).children().eq(0).val();
					var stringDate = String($("#idPicker_StartDate_" + vExtract).children().eq(0).val());
					//console.log("Fecha desde String "+ new Date(stringDate));
					var post_startDate = Datemasuno($("#idPicker_StartDate_" + vExtract).children().eq(0).val()).setHours(0, 0, 0, 0);
					//var post_dueDate = Datemasuno($("#idPicker_DueDate_" + vExtract).children().eq(0).val()).setHours(23, 59, 59, 999);
					var post_dueDate = Datemasuno($("#idPicker_DueDate_" + vExtract).children().eq(0).val()).setHours(0, 0, 0, 0);
					var post_WorkOnWeekends = $("#WorkOnWeekends_" + vExtract).is(':checked');
					var post_Duration = $("#idTask_Duration_" + vExtract).val();
					var SalesOrderId = $("#idTask_Duration_" + vExtract).attr("data-salesorder");
					var wrikeid = $("#idTask_Duration_" + vExtract).attr("data-wrikeid");

					return {
						'post_taskid': post_taskid,
						'post_id': post_id,
						'post_ack': post_ack,
						'post_name': post_name,
						'stringDate': stringDate,
						'post_startDate': post_startDate,
						'post_dueDate': post_dueDate,
						'post_WorkOnWeekends': post_WorkOnWeekends,
						'post_Duration': post_Duration,
						'SalesOrderId': SalesOrderId,
						'wrikeid': wrikeid,
					}
				}

			}, 2800);
//---RESTCODE>

		});
	</script>
	<!-- Review: 2017-Feb-05 01:58AM -->
	<!-- Review: 2017-Feb-09 05:59PM -->
	<!-- Review: 2017-Feb-09 11:47PM -->
	<!-- Review: 2017-Feb-14 09:02PM -->
</body>

</html>
